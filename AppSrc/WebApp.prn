Compiling Program: C:\VDF programs\timer\AppSrc\WebApp.src
Memory Available: 1913901056
1>Use AllWebAppClasses.pkg
Using pre-compiled package ALLWEBAPPCLASSES.PKG
Including file: AllWebAppClasses.pkd    (C:\Program Files\Visual DataFlex 16.0\Pkg\AllWebAppClasses.pkd)
13081>Use cWebApp.pkg
13081>
13081>Object oApplication is a cApplication
13083>End_Object
13084>
13084>Object oWebApp is a cWebApp
13086>    Use UserTest.wo
Including file: UserTest.wo    (C:\VDF programs\timer\AppSrc\UserTest.wo)
13086>>>// C:\VDF programs\Timesag\AppSrc\UserTest.wo
13086>>>// UserTest
13086>>>//
13086>>>
13086>>>Use cAjaxWebBusinessProcess.pkg
Including file: cAjaxWebBusinessProcess.pkg    (C:\Program Files\Visual DataFlex AJAX Library 2.2\AppSrc\cAjaxWebBusinessProcess.pkg)
13086>>>>>//
13086>>>>>//  Contains the cAjaxWebBusinessProcess class that extends the original 
13086>>>>>//  cWebBusinessProcess class. Contains methods that allow external access 
13086>>>>>//  using structs & arrays (usualy coming from the webservice 
13086>>>>>//  cApplicationDataService). This class is created to be an extra layer in 
13086>>>>>//  webobjects for external access from the webservice used in the AJAX 
13086>>>>>//  framework.
13086>>>>>//
13086>>>>>//  Since:
13086>>>>>//      11/06/2006
13086>>>>>//  Changed:
13086>>>>>//      --
13086>>>>>//  Version:
13086>>>>>//      0.9
13086>>>>>//  Created:
13086>>>>>//      Data Access Europe (Harm Wibier)
13086>>>>>//
13086>>>>>Use WebAppBase.pkg          // standard windows classes
13086>>>>>Use HelpSystemConstants.pkg // constants used by help system (not used byt needed by cApplication)
13086>>>>>Use cApplication.pkg        // cApplication class
13086>>>>>Use cWebBusinessProcess.pkg
13086>>>>>Use cWebApp.pkg
13086>>>>>Use cWebReport.pkg
13086>>>>>Use Flexml.pkg              // this adds XML class support to server classes
13086>>>>>
13086>>>>>Use AjaxDataStructures.pkg
Including file: AjaxDataStructures.pkg    (C:\Program Files\Visual DataFlex AJAX Library 2.2\AppSrc\AjaxDataStructures.pkg)
13086>>>>>>>
13086>>>>>>>//
13086>>>>>>>// E R R O R
13086>>>>>>>//
13086>>>>>>>Struct TAjaxError
13086>>>>>>>    // Structure represents a VDF error that occurred while handling the request (set). 
13086>>>>>>>        
13086>>>>>>>    Integer                 iNumber                 // VDF error number
13086>>>>>>>    Integer                 iLine                   // Instruction line at which the error occured
13086>>>>>>>    String                  sTableName              // Table name on valiation errors
13086>>>>>>>    String                  sColumnName             // Name of the column on validation errors
13086>>>>>>>    String                  sErrorText              // Error text
13086>>>>>>>End_Struct
13086>>>>>>>
13086>>>>>>>//
13086>>>>>>>// U S E R   D A T A
13086>>>>>>>//
13086>>>>>>>Struct TAjaxUserData
13086>>>>>>>    // Structure represents a user variable that is send with a request (set) or response (set). 
13086>>>>>>>
13086>>>>>>>    String                  sName                   // Name of the variable
13086>>>>>>>    String                  sValue                  // Value of the variable
13086>>>>>>>End_Struct
13086>>>>>>>
13086>>>>>>>//
13086>>>>>>>// S N A P S H O T
13086>>>>>>>//
13086>>>>>>>
13086>>>>>>>Struct TAjaxField
13086>>>>>>>    String                  sBinding
13086>>>>>>>    String                  sType       // (D)atabase, (E)xpression, (R)owId
13086>>>>>>>    String                  sValue
13086>>>>>>>    Boolean                 bChanged
13086>>>>>>>End_Struct
13086>>>>>>>
13086>>>>>>>Struct TAjaxDD
13086>>>>>>>    String                  sName
13086>>>>>>>    TAjaxField              tStatus
13086>>>>>>>    TAjaxField              tStatus
13086>>>>>>>    Boolean                 bLight
13086>>>>>>>    TAjaxField[]            aFields
13086>>>>>>>    TAjaxField[]            aFields
13086>>>>>>>End_Struct
13086>>>>>>>
13086>>>>>>>Struct TAjaxSnapShot
13086>>>>>>>    TAjaxDD[]               aDDs
13086>>>>>>>    TAjaxDD[]               aDDs
13086>>>>>>>End_Struct
13086>>>>>>>
13086>>>>>>>
13086>>>>>>>
13086>>>>>>>Struct TAjaxRequestSet
13086>>>>>>>    // Structure represents an action that should be performed on the server. There can be more of them in one request.
13086>>>>>>>    // It contains specific request information.
13086>>>>>>>    
13086>>>>>>>    String                  sName           // Main table for the request
13086>>>>>>>    String                  sRequestType    // Type of the request (find, save, delete or clear)
13086>>>>>>>    
13086>>>>>>>    String                  sMethod         
13086>>>>>>>    String[]                asParams
13086>>>>>>>
13086>>>>>>>    Integer                 iMaxRows        // Maximum number of rows returns (with find action) 1 = Single row, > 1 = Multi row
13086>>>>>>>    String                  sTable          // Name of the table to perform the action on
13086>>>>>>>    String                  sColumn         // Name of the column to perform the action on
13086>>>>>>>    String                  sIndex          // Index used (with find action)
13086>>>>>>>    String                  sFindMode       // Find mode to be used (with find action), ussually the numeric value but textual also works
13086>>>>>>>    String                  sFindValue      // Find value to be used (with findByRowId)
13086>>>>>>>    Boolean                 bReturnCurrent  // When true the buffer value is also returned on find (buffers are not cleared between request sets but between requests)
13086>>>>>>>    Boolean                 bLoadStatus        // If false the status is not loaded before the action is performed
13086>>>>>>>
13086>>>>>>>    TAjaxSnapShot[]         aRows           // Array of TAjaxRequestRow structures with data row(s) used for the request
13086>>>>>>>    TAjaxSnapShot[]         aRows           // Array of TAjaxRequestRow structures with data row(s) used for the request
13086>>>>>>>    TAjaxUserData[]         aUserData       // Array of TAjaxUserData structures with extra application infromation for the request set
13086>>>>>>>    TAjaxUserData[]         aUserData       // Array of TAjaxUserData structures with extra application infromation for the request set
13086>>>>>>>End_Struct
13086>>>>>>>
13086>>>>>>>Struct TAjaxRequestData
13086>>>>>>>    // This structure represents a request that is sent by the client to execute one or more actions on the server.
13086>>>>>>>    // The request contains one or more request sets which all represent an action.
13086>>>>>>>    
13086>>>>>>>    String                  sSessionKey     // Unique key that indicates the session to which the request belongs
13086>>>>>>>    String                  sWebObject      // Name of the web object that should handle the request
13086>>>>>>>    TAjaxRequestSet[]       aDataSets       // Array of TAjaxRequestSet structures representing the request sets
13086>>>>>>>    TAjaxRequestSet[]       aDataSets       // Array of TAjaxRequestSet structures representing the request sets
13086>>>>>>>    TAjaxUserData[]         aUserData       // Array of TAjaxUserDate structures
13086>>>>>>>    TAjaxUserData[]         aUserData       // Array of TAjaxUserDate structures
13086>>>>>>>End_Struct
13086>>>>>>>
13086>>>>>>>//
13086>>>>>>>// R E S P O N S E
13086>>>>>>>//
13086>>>>>>>Struct TAjaxResponseSet
13086>>>>>>>    // Is the response that belongs to a request set; it contains the results of the action that the request set describes.
13086>>>>>>>    
13086>>>>>>>    String                  sName               // Name of the request set to which it belongs
13086>>>>>>>    String                  sResponseType       // Type of the request set to which it belongs
13086>>>>>>>    
13086>>>>>>>    String                  sReturnValue
13086>>>>>>>    
13086>>>>>>>    String                  sTable              // Name of the request table
13086>>>>>>>    String                  sColumn             // Name of the main table
13086>>>>>>>    Integer                 iRows               // Number of rows in the request set
13086>>>>>>>    Boolean                 bFound              // True if the find was successful
13086>>>>>>>    TAjaxSnapShot[]         aRows               // Array with TAjaxResponseRow structures
13086>>>>>>>    TAjaxSnapShot[]         aRows               // Array with TAjaxResponseRow structures
13086>>>>>>>    TAjaxUserData[]         aUserData           // Array with TAjaxUserDate structures
13086>>>>>>>    TAjaxUserData[]         aUserData           // Array with TAjaxUserDate structures
13086>>>>>>>End_Struct
13086>>>>>>>
13086>>>>>>>Struct TAjaxResponseData
13086>>>>>>>    // Structure contains the response to a request, it contains response sets for each request set in the request.
13086>>>>>>>    
13086>>>>>>>    TAjaxResponseSet[]       aDataSets          // Array with TAjaxResponseSet structures with response data for each request set
13086>>>>>>>    TAjaxResponseSet[]       aDataSets          // Array with TAjaxResponseSet structures with response data for each request set
13086>>>>>>>    TAjaxUserData[]          aUserData          // Array with TAjaxUserDate structures with extra application user data. Also contains the data (unless changed) that has been sent with the request
13086>>>>>>>    TAjaxUserData[]          aUserData          // Array with TAjaxUserDate structures with extra application user data. Also contains the data (unless changed) that has been sent with the request
13086>>>>>>>    TAjaxError[]             aErrors            // Array with TAjaxError structures containing information about errors that occured during the request
13086>>>>>>>    TAjaxError[]             aErrors            // Array with TAjaxError structures containing information about errors that occured during the request
13086>>>>>>>End_Struct
13086>>>>>>>
13086>>>>>>>//
13086>>>>>>>// F I E L D   V A L I D A T I O N
13086>>>>>>>//
13086>>>>>>>Struct TAjaxValidationRequest
13086>>>>>>>    // Structure represents a request that contains data for server side validation.
13086>>>>>>>    
13086>>>>>>>    String                  sSessionKey     // Unique key that indicates the session to which the request belongs
13086>>>>>>>    String                  sWebObject      // Name of the webobject that should handle the request
13086>>>>>>>    String                  sFieldName      // Name of the field to be validated
13086>>>>>>>    TAjaxSnapShot           tRow            // Array of TAjaxRequestRow structures
13086>>>>>>>    TAjaxSnapShot           tRow            // Array of TAjaxRequestRow structures
13086>>>>>>>End_Struct
13086>>>>>>>
13086>>>>>>>Struct TAjaxValidationResponse
13086>>>>>>>    // Response to a request for server side validation
13086>>>>>>>    
13086>>>>>>>    String                  sFieldName      // Name of the field validated
13086>>>>>>>    String                  sFieldValue     // Value of the field validated
13086>>>>>>>    Integer                 iError          // 0 if no errors occured
13086>>>>>>>    TAjaxError[]            aErrors         // Array of TAjaxError strcutures containing information about occured errors
13086>>>>>>>    TAjaxError[]            aErrors         // Array of TAjaxError strcutures containing information about occured errors
13086>>>>>>>End_Struct
13086>>>>>>>
13086>>>>>>>//
13086>>>>>>>// M E T A   D A T A
13086>>>>>>>//
13086>>>>>>>
13086>>>>>>>Struct TAjaxMetaDD
13086>>>>>>>    // Structure contains information about a table and an array with column information.
13086>>>>>>>    String                  sName                           // Name of the table
13086>>>>>>>    String                  sDriverName                     // Name of the driver (ussually dataflex)
13086>>>>>>>    String[]                aServers                        // Array with the names of parent tables
13086>>>>>>>    String                  sConstrainFile                  // Name of the table which the table is constrained to
13086>>>>>>>    Boolean                 bValidate_Foreign_File_State    // If true the table columns will not be validated if they are foreign
13086>>>>>>>End_Struct
13086>>>>>>>
13086>>>>>>>Struct TAjaxMetaWO
13086>>>>>>>    String                  sName
13086>>>>>>>    String                  sDateFormat         // Mask used for displaying and formatting the date
13086>>>>>>>    String                  sDateSeparator      // Separator used for displaying and formatting the date
13086>>>>>>>    String                  sDecimalSeparator   // Separator used with numeric values (, or .)
13086>>>>>>>    String                  sThousandsSeparator // Separator used with numeric values (, or .)
13086>>>>>>>    String                  sCurrencySymbol
13086>>>>>>>    Integer                 iDate4_State        // Controls whether entries of dates with two-digit years are converted to and from dates with four-digit years
13086>>>>>>>    Integer                 iEpoch              // Two-digit year value above which dates are considered to be in the 1900s    
13086>>>>>>>    
13086>>>>>>>    TAjaxMetaDD[]           aDDs
13086>>>>>>>    TAjaxMetaDD[]           aDDs
13086>>>>>>>    TAjaxError[]            aErrors
13086>>>>>>>    TAjaxError[]            aErrors
13086>>>>>>>End_Struct
13086>>>>>>>
13086>>>>>>>Struct TAjaxMetaField
13086>>>>>>>    String                  sName                   // Name of the field
13086>>>>>>>    String                  sTable                  // Name of the table to which the field belongs
13086>>>>>>>
13086>>>>>>>    Boolean                 bAutoFind               // If true a find EQ should be executed when tabbing out of this column
13086>>>>>>>    Boolean                 bAutoFindGE             // If true a find GE should be executed when tabbing out of this column
13086>>>>>>>    Boolean                 bCapslock               // If true only uppercased characters are allowed
13086>>>>>>>    Boolean                 bDisplayOnly            // If true the value can not be edited
13086>>>>>>>    Boolean                 bFindReq                // If true the colum requires to be found before it is saved
13086>>>>>>>    Boolean                 bNoEnter                // If true the user can not edit the data in the form
13086>>>>>>>    Boolean                 bNoPut                  // If true the user can edit the data in the form but it won't be saved
13086>>>>>>>    Boolean                 bRequired               // If true the field must be filled on save
13086>>>>>>>    Boolean                 bSkipFound              // If true the field value may not be edited while a record is in the buffer
13086>>>>>>>    Boolean                 bZeroSuppress           // If true the field value is not shown when it is 0
13086>>>>>>>    Boolean                 bForeign_AutoFind       // If true and the field is foreign it should behave like bAutoFind is true
13086>>>>>>>    Boolean                 bForeign_AutoFindGE     // If true and the field is foreign it should behave like bAutoFind_GE is true
13086>>>>>>>    Boolean                 bForeign_DisplayOnly    // If true and the field is foreign it should behave like bDisplayOnly is true
13086>>>>>>>    Boolean                 bForeign_FindReq        // If true and the field is foreign it should behave like bFindReq is true
13086>>>>>>>    Boolean                 bForeign_NoEnter        // If true and the field is foreign it should behave like bNoEnter is true
13086>>>>>>>    Boolean                 bForeign_NoPut          // If true and the field is foreign it should behave like bNoPut is true
13086>>>>>>>    Boolean                 bForeign_SkipFound      // If true and the field is foreign it should behave like bSkipFound is true
13086>>>>>>>    Boolean                 bValidateServer         // If true there is a custom Field_Validate_msg for this field
13086>>>>>>>    
13086>>>>>>>    String                  iDataLength             // Maximum length
13086>>>>>>>    String                  iIndex                  // Main index
13086>>>>>>>    String                  iPrecision              // Number of decimals placed in numeric column
13086>>>>>>>    String                  sCheck                  // String with possible column values seperated by the | character
13086>>>>>>>    String                  sDataType               // Datatype ("bcd", "ascii", "date", ...)
13086>>>>>>>    String                  sDefaultValue           // The value to use as default value\
13086>>>>>>>    String                  sMaskType               // Mask type ("win", "num", "cur", "dat", "dt")
13086>>>>>>>    String                  sMask                   // Mask that should be applied to the field data
13086>>>>>>>    String                  sMaxValue               // Minimal value
13086>>>>>>>    String                  sMinValue               // Maximal value
13086>>>>>>>    String                  sChecked                // Value for checkbox if checked
13086>>>>>>>    String                  sUnchecked              // Value for checkbox if unchecked
13086>>>>>>>    String                  sShortLabel             // Short label
13086>>>>>>>    String                  sLongLabel              // Long label
13086>>>>>>>    String                  sStatusHelp             // Help text
13086>>>>>>>End_Struct
13086>>>>>>>
13086>>>>>>>Struct TAjaxMetaFields
13086>>>>>>>    
13086>>>>>>>    TAjaxMetaField[]        aFields    
13086>>>>>>>    TAjaxMetaField[]        aFields    
13086>>>>>>>    TAjaxError[]            aErrors
13086>>>>>>>    TAjaxError[]            aErrors
13086>>>>>>>End_Struct
13086>>>>>>>
13086>>>>>>>Struct TAjaxMetaProperty
13086>>>>>>>    String                  sProperty
13086>>>>>>>    String                  sValue
13086>>>>>>>End_Struct
13086>>>>>>>
13086>>>>>>>Struct TAjaxMetaPropField
13086>>>>>>>    String                  sTable
13086>>>>>>>    String                  sField
13086>>>>>>>    TAjaxMetaProperty[]     aProperties
13086>>>>>>>    TAjaxMetaProperty[]     aProperties
13086>>>>>>>End_Struct
13086>>>>>>>
13086>>>>>>>Struct TAjaxMetaProperties
13086>>>>>>>    TAjaxMetaPropField[]    aFields
13086>>>>>>>    TAjaxMetaPropField[]    aFields
13086>>>>>>>    TAjaxError[]            aErrors
13086>>>>>>>    TAjaxError[]            aErrors
13086>>>>>>>End_Struct
13086>>>>>>>
13086>>>>>>>Struct TAjaxDescriptionValue
13086>>>>>>>    String                  sValue
13086>>>>>>>    String                  sDescription
13086>>>>>>>End_Struct
13086>>>>>>>
13086>>>>>>>Struct TAjaxMetaDescriptionValues
13086>>>>>>>    String                  sTable
13086>>>>>>>    String                  sField
13086>>>>>>>    TAjaxDescriptionValue[] aValues
13086>>>>>>>    TAjaxDescriptionValue[] aValues
13086>>>>>>>    TAjaxError[]            aErrors
13086>>>>>>>    TAjaxError[]            aErrors
13086>>>>>>>End_Struct
13086>>>>>>>
13086>>>>>>>//
13086>>>>>>>// R E M O T E   M E T H O D   I N V O C A T I O N
13086>>>>>>>//
13086>>>>>>>Struct TAjaxRMIResponse
13086>>>>>>>    // Contains the response and error information when accessing methods using the RMI functions.
13086>>>>>>>    
13086>>>>>>>    String                  sReturnValue        // Value returned by the method that was called
13086>>>>>>>    TAjaxError[]            aErrors             // Array of TAjaxError structures containing information about errors that occured
13086>>>>>>>    TAjaxError[]            aErrors             // Array of TAjaxError structures containing information about errors that occured
13086>>>>>>>End_Struct
13086>>>>>>>
13086>>>>>>>//
13086>>>>>>>// A J A X   T R E E   V I E W
13086>>>>>>>//
13086>>>>>>>Struct TAjaxTreeNode
13086>>>>>>>    String              sName
13086>>>>>>>    String              sAltText
13086>>>>>>>    
13086>>>>>>>    String              sId
13086>>>>>>>    String              sValue
13086>>>>>>>    String              sIconClass
13086>>>>>>>    String              sParentId
13086>>>>>>>    
13086>>>>>>>    Boolean             bHasChildren
13086>>>>>>>    Boolean             bExpanded
13086>>>>>>>End_Struct
13086>>>>>>>
13086>>>>>>>Struct TAjaxTreeNodeResponse
13086>>>>>>>    String              sParentId
13086>>>>>>>    TAjaxTreeNode[]     aNodes
13086>>>>>>>    TAjaxTreeNode[]     aNodes
13086>>>>>>>    TAjaxError[]        aErrors
13086>>>>>>>    TAjaxError[]        aErrors
13086>>>>>>>End_Struct
13086>>>>>
13086>>>>>Class cAjaxWebBusinessProcess is a cWebBusinessProcess
13087>>>>>
13087>>>>>    // Construct_Object: Object constructor.
13087>>>>>    Procedure Construct_Object
13089>>>>>        Forward Send Construct_Object
13091>>>>>        
13091>>>>>        // Set property values:
13091>>>>>        Set pbQueueErrors         to True  //
13092>>>>>        Set pbVerboseErrors       to True  // Show linenumber or not.
13093>>>>>        Set pbReportErrors        to True
13094>>>>>        Set pbClearAfterSave      to False
13095>>>>>        Set pbAllErrorsToEventLog to True    
13096>>>>>        
13096>>>>>        Property TAjaxUserData[] ptaRequestUserData
13097>>>>>        Property TAjaxUserData[] ptaRequestSetUserData
13098>>>>>    End_Procedure
13099>>>>>
13099>>>>>    //
13099>>>>>    //  Used to check if WO is instance of AjaxWebBusinessProcess. (InstanceOf 
13099>>>>>    //  workaround)
13099>>>>>    //
13099>>>>>    //  Returns:
13099>>>>>    //      1
13099>>>>>    //
13099>>>>>    Function IsAjaxSupported Returns Integer
13101>>>>>        Function_Return 1
13102>>>>>    End_Function
13103>>>>>    
13103>>>>>    //
13103>>>>>    //  Should be overriden by the developer in the Web Object to return nodes 
13103>>>>>    //  for the vdf.gui.AjaxTreeView component.
13103>>>>>    //
13103>>>>>    //  Params:
13103>>>>>    //      sObjectName Name of the client tree.
13103>>>>>    //      sParentId   Identifyer of the parent node.
13103>>>>>    //      sParentValue    Value of the parent node.
13103>>>>>    //      iLevel          Level of the parent node.
13103>>>>>    //  Returns:
13103>>>>>    //      Array of TAjaxTreeNode structs.
13103>>>>>    //
13103>>>>>    Function AjaxLoadTreeNodes String sObjectName String sParentId String sParentValue Integer iLevel Returns TAjaxTreeNode[]
13105>>>>>        TAjaxTreeNode[] aResult
13105>>>>>        TAjaxTreeNode[] aResult
13106>>>>>        
13106>>>>>        Error 919 "AjaxLoadTreeNodes not implemented for this web object"
13107>>>>>>
13107>>>>>        
13107>>>>>        Function_Return aResult
13108>>>>>    End_Function
13109>>>>>
13109>>>>>    //
13109>>>>>    //  Validates a field using the File_Field_Validate_Field call after 
13109>>>>>    //  loading the given data into the buffer. Returns the fieldname, value,
13109>>>>>    //  validation error code in the response structure.
13109>>>>>    //
13109>>>>>    //  Params:
13109>>>>>    //      tAjaxValidationRequest   The validation request data
13109>>>>>    //  Returns:
13109>>>>>    //      Structure with the results
13109>>>>>    //
13109>>>>>    Function AjaxValidateField TAjaxValidationRequest ByRef tRequest Returns TAjaxValidationResponse
13111>>>>>        TAjaxValidationResponse tResponse
13111>>>>>        TAjaxValidationResponse tResponse
13111>>>>>        String sFile sField sFieldName
13111>>>>>        Integer iFile iField
13111>>>>>        Handle hoMainDD hoDD
13111>>>>>        Boolean bLoaded
13111>>>>> 
13111>>>>>        Move tRequest.sFieldName to sFieldName
13112>>>>>        
13112>>>>>        //  Split name into file and field name
13112>>>>>        Move (left(sFieldName, (pos(".", sFieldName) - 1))) to sFile
13113>>>>>        Move (mid(sFieldName, length(sFieldName),(pos(".", sFieldName) + 1))) to sField
13114>>>>>        
13114>>>>>        //  Get MainDD
13114>>>>>        Get Main_DD to hoMainDD
13115>>>>>        If (hoMainDD > 0) Begin
13117>>>>>            
13117>>>>>            //  Map names to numbers
13117>>>>>            Get Search_File_Name sFile to iFile
13118>>>>>            If (iFile > -1) Begin
13120>>>>>                Get FieldMap iFile sField to iField
13121>>>>>                If (iField <> -1) Begin
13123>>>>>                
13123>>>>>                    //  Get request DD
13123>>>>>                    Get Data_Set of hoMainDD iFile to hoDD
13124>>>>>                    If (hoDD > 0) Begin                        
13126>>>>>                        
13126>>>>>                        //  Load the status
13126>>>>>                        Get AjaxLoadSnapShot tRequest.tRow hoDD to bLoaded
13127>>>>>                       
13127>>>>>                        //  Get the field value
13127>>>>>                        Get Field_Current_Value of hoDD iField to tResponse.sFieldValue
13128>>>>>                        
13128>>>>>                        //  Validate the field
13128>>>>>                        Get File_Field_Validate_Field of hoDD iFile iField to tResponse.iError                                               
13129>>>>>                    
13129>>>>>                    End
13129>>>>>>
13129>>>>>                    Else Error 5633 (SFormat("Data dictionary not found for table: %1 (%2)", sFile, iFile))
13131>>>>>                End    
13131>>>>>>
13131>>>>>                Else Error 5641 ("Field not found: " * sField * "(File:" * sFile * ")")
13133>>>>>            End
13133>>>>>>
13133>>>>>            Else Error 5632 ("File not found: " * sFile)
13135>>>>>        End
13135>>>>>>
13135>>>>>        Else Error 5631 "Main_DD not set"
13137>>>>>        
13137>>>>>        Move tRequest.sFieldName to tResponse.sFieldName
13138>>>>>
13138>>>>>        Function_Return tResponse
13139>>>>>    End_Function
13140>>>>>
13140>>>>>
13140>>>>>    //
13140>>>>>    //  Collects the metadata of this webobject and its datadictionaries. It 
13140>>>>>    //  calls the recursive AjaxMetaDataDDs method starting with the maintable 
13140>>>>>    //  of this webobject.
13140>>>>>    //
13140>>>>>    //  Returns:
13140>>>>>    //      TAjaxServiceMetaData struct filled with information about this 
13140>>>>>    //      webobject.
13140>>>>>    //
13140>>>>>    Function AjaxMetaData Returns TAjaxMetaWO
13142>>>>>        TAjaxMetaWO tResponse
13142>>>>>        TAjaxMetaWO tResponse
13142>>>>>        Handle hoMainDD
13142>>>>>        Handle[] haDone
13143>>>>>        
13143>>>>>        Get Main_DD to hoMainDD
13144>>>>>        If (hoMainDD <> 0) Begin
13146>>>>>            Send AjaxMetaDDs (&tResponse) hoMainDD (&haDone)
13147>>>>>        End
13147>>>>>>
13147>>>>>        Else Begin
13148>>>>>            Error 5631 "Main_DD not set"
13149>>>>>>
13149>>>>>        End
13149>>>>>>
13149>>>>>        
13149>>>>>        Function_Return tResponse
13150>>>>>    End_Function
13151>>>>>    
13151>>>>>    //
13151>>>>>    //  Recursive method which loops through the data dictionaries calling 
13151>>>>>    //  AjaxMetaDataDD for each data dictionary. It fills the aParents array of
13151>>>>>    //  the TAjaxTableMetaData struct self.
13151>>>>>    //
13151>>>>>    //  Parameters:
13151>>>>>    //      tResponse    Reference to the TAjaxServiceMetaData structure to fill
13151>>>>>    //      hoCurrentDD Handle to the current data dictionary
13151>>>>>    //      haDone      Reference to handle array used to prevent recursive 
13151>>>>>    //                  looping
13151>>>>>    //
13151>>>>>    Procedure AjaxMetaDDs TAjaxMetaWO ByRef tResponse Handle hoCurrentDD Handle[] ByRef haDone
13153>>>>>        TAjaxMetaDD tResponseDD
13153>>>>>        TAjaxMetaDD tResponseDD
13153>>>>>        Handle hoNextDD
13153>>>>>        Integer iCounter iCount iServer
13153>>>>>        String sServer
13153>>>>>        
13153>>>>>        Move (hoCurrentDD) to haDone[(SizeOfArray(haDone))]
13154>>>>>        
13154>>>>>        Get AjaxMetaDD hoCurrentDD to tResponseDD
13155>>>>>        
13155>>>>>        // Add the values for all servers
13155>>>>>        Get Data_Set_Server_Count of hoCurrentDD to iCount
13156>>>>>        Decrement iCount
13157>>>>>        For iCounter from 0 to iCount
13163>>>>>>
13163>>>>>            Get Data_Set_Server of hoCurrentDD iCounter to hoNextDD
13164>>>>>    
13164>>>>>            //  Add to parents string
13164>>>>>            Get Main_File of hoNextDD to iServer
13165>>>>>            Get FriendlyTableName iServer to sServer
13166>>>>>            Move (Lowercase(sServer)) to tResponseDD.aServers[iCounter]
13167>>>>>                
13167>>>>>            If (SearchArray(hoNextDD, haDone) < 0) Begin
13169>>>>>               Send AjaxMetaDDs (&tResponse) hoNextDD (&haDone)
13170>>>>>            End
13170>>>>>>
13170>>>>>        Loop
13171>>>>>>
13171>>>>>
13171>>>>>        //  Add to response
13171>>>>>        Move tResponseDD to tResponse.aDDs[SizeOfArray(tResponse.aDDs)]
13172>>>>>    
13172>>>>>        // Add the values for all clients
13172>>>>>        Get Data_Set_Client_Count of hoCurrentDD to iCount
13173>>>>>        Decrement iCount
13174>>>>>        For iCounter from 0 to iCount
13180>>>>>>
13180>>>>>            Get Data_Set_Client of hoCurrentDD iCounter to hoNextDD
13181>>>>>            If (SearchArray(hoNextDD, haDone) < 0) Begin
13183>>>>>                Send AjaxMetaDDs (&tResponse) hoNextDD (&haDone)
13184>>>>>            End
13184>>>>>>
13184>>>>>        Loop
13185>>>>>>
13185>>>>>    End_Procedure
13186>>>>>    
13186>>>>>    //
13186>>>>>    //  Fills structure with table information. Calls AjaxMetaDataColumn for 
13186>>>>>    //  each column.
13186>>>>>    //
13186>>>>>    //  Paramseters:
13186>>>>>    //      hoDD    Handle to the data dictionary
13186>>>>>    //  Returns:
13186>>>>>    //      Filled TAjaxTabeMetaData structure
13186>>>>>    //
13186>>>>>    Function AjaxMetaDD Handle hoDD Returns TAjaxMetaDD
13188>>>>>        Integer iFile iField iFieldCount iConstrainFile
13188>>>>>        TAjaxMetaDD tResponseDD
13188>>>>>        TAjaxMetaDD tResponseDD
13188>>>>>        String sName sValue
13188>>>>>        
13188>>>>>        //  Add filename
13188>>>>>        Get Main_File of hoDD to iFile
13189>>>>>        Get FriendlyTableName iFile to sName
13190>>>>>        Move (Lowercase(sName)) to tResponseDD.sName
13191>>>>>        
13191>>>>>        //  Add table type
13191>>>>>        Get_Attribute DF_FILE_DRIVER of iFile to sValue
13194>>>>>        Move (Lowercase(sValue)) to tResponseDD.sDriverName 
13195>>>>>        
13195>>>>>        //  Add table properties
13195>>>>>        Get Validate_Foreign_File_State of hoDD to tResponseDD.bValidate_Foreign_File_State
13196>>>>>        
13196>>>>>        Get Constrain_File of hoDD to iConstrainFile
13197>>>>>        If (iConstrainFile > 0) Begin
13199>>>>>            Get FriendlyTableName iConstrainFile to sName
13200>>>>>            Move (Lowercase(sName)) to tResponseDD.sConstrainFile
13201>>>>>        End
13201>>>>>>
13201>>>>>        
13201>>>>>        Function_Return tResponseDD
13202>>>>>    End_Function
13203>>>>>    
13203>>>>>    //
13203>>>>>    //  Loops through the array of fields and uses the AjaxMetaField methods to
13203>>>>>    //  retrieve the Field information.
13203>>>>>    //
13203>>>>>    //  Params:
13203>>>>>    //      aFields Array with names of the requested fields
13203>>>>>    //  Returns:
13203>>>>>    //      Struct with the basic field meta data.
13203>>>>>    //
13203>>>>>    Function AjaxMetaFields String[] aFields Returns TAjaxMetaFields
13205>>>>>        Integer iFieldCount iField iCurrent iFile
13205>>>>>        String sFile sField
13205>>>>>        Handle hoMainDd hoDD
13205>>>>>        TAjaxMetaFields tResult
13205>>>>>        TAjaxMetaFields tResult
13205>>>>>        
13205>>>>>        
13205>>>>>        Get Main_DD to hoMainDD
13206>>>>>        If (hoMainDD = 0) Begin
13208>>>>>            Error 5631 "Main_DD not set"
13209>>>>>>
13209>>>>>            Function_Return tResult
13210>>>>>        End        
13210>>>>>>
13210>>>>>        
13210>>>>>        Move (SizeOfArray(aFields) - 1) to iFieldCount
13211>>>>>        
13211>>>>>        For iCurrent from 0 to iFieldCount
13217>>>>>>
13217>>>>>
13217>>>>>            //  Split name into file and field name
13217>>>>>            Move (left(aFields[iCurrent], (pos(".", aFields[iCurrent]) - 1))) to sFile
13218>>>>>            Move (mid(aFields[iCurrent], length(aFields[iCurrent]),(pos(".", aFields[iCurrent]) + 1))) to sField
13219>>>>>
13219>>>>>            //  Find file number
13219>>>>>            Get Search_File_Name sFile to iFile
13220>>>>>            If (iFile > -1) Begin
13222>>>>>                
13222>>>>>                //  Find field number
13222>>>>>                Get FieldMap iFile sField to iField
13223>>>>>                If (iField <> -1) Begin
13225>>>>>                    
13225>>>>>                    //  Find DD
13225>>>>>                    Get Data_Set of hoMainDD iFile to hoDD
13226>>>>>                    
13226>>>>>                    Get AjaxMetaField hoDD iFile iField to tResult.aFields[iCurrent]
13227>>>>>                    
13227>>>>>                End
13227>>>>>>
13227>>>>>                Else Begin
13228>>>>>                    Error 5641 ("Field not found: " * sField)
13229>>>>>>
13229>>>>>                End
13229>>>>>>
13229>>>>>            End
13229>>>>>>
13229>>>>>            Else Begin
13230>>>>>                Error 5632 ("File not found: " * sFile)
13231>>>>>>
13231>>>>>            End
13231>>>>>>
13231>>>>>        Loop
13232>>>>>>
13232>>>>>        
13232>>>>>        Function_Return tResult
13233>>>>>    End_Function
13234>>>>>    
13234>>>>>    //
13234>>>>>    //  Gathers the basic field meta data of a specific field.
13234>>>>>    //  
13234>>>>>    //  Params:
13234>>>>>    //      hoDD    Handle to the Data Dictionary object
13234>>>>>    //      iFile   File number.
13234>>>>>    //      iField  Field number
13234>>>>>    //  Returns:
13234>>>>>    //      Struct with field properties.
13234>>>>>    //
13234>>>>>    Function AjaxMetaField Handle hoDD Integer iFile Integer iField Returns TAjaxMetaField
13236>>>>>        TAjaxMetaField tResponse
13236>>>>>        TAjaxMetaField tResponse
13236>>>>>        Integer iType iValidationType iItem iFieldIndex iOptions iMaskType iSeparator iMask iValidateFieldMessage
13236>>>>>        String sFieldName sFileName sValue sTempValue
13236>>>>>                
13236>>>>>        //  Add name
13236>>>>>        Get_Attribute DF_FIELD_NAME of iFile iField to sFieldName
13239>>>>>        Move (LowerCase(sFieldName)) to tResponse.sName
13240>>>>>        Get FriendlyTableName iFile to sFileName
13241>>>>>        Move (Lowercase(sFileName)) to tResponse.sTable
13242>>>>>
13242>>>>>        //  Add labels
13242>>>>>        Get Field_Label_Short of hoDD iField  to tResponse.sShortLabel
13243>>>>>        Get Field_Label_Long of hoDD iField  to tResponse.sLongLabel
13244>>>>>        Get Status_Help of hoDD iField to tResponse.sStatusHelp
13245>>>>>        
13245>>>>>        // Add field type information
13245>>>>>        Get_Attribute DF_FIELD_TYPE of iFile iField to iType
13248>>>>>        Case Begin
13248>>>>>            Case (iType = DF_ASCII)   
13250>>>>>                Move "ascii"   to tResponse.sDataType
13251>>>>>                Case Break
13252>>>>>            Case (iType = DF_BCD)     
13255>>>>>                Move "bcd"     to tResponse.sDataType
13256>>>>>                Case Break
13257>>>>>            Case (iType = DF_DATE)    
13260>>>>>                Move "date"    to tResponse.sDataType
13261>>>>>                Case Break
13262>>>>>            Case (iType = DF_OVERLAP) 
13265>>>>>                Move "overlap" to tResponse.sDataType
13266>>>>>                Case Break
13267>>>>>            Case (iType = DF_TEXT)    
13270>>>>>                Move "text"    to tResponse.sDataType
13271>>>>>                Case Break
13272>>>>>            Case (iType = DF_BINARY) 
13275>>>>>                Move "binary"  to tResponse.sDataType
13276>>>>>                Case Break
13277>>>>>            Case Else 
13277>>>>>                Move "unknown" to tResponse.sDataType 
13278>>>>>        Case End
13278>>>>>        
13278>>>>>        // Add field size information
13278>>>>>        Get_Attribute DF_FIELD_LENGTH of iFile iField to tResponse.iDataLength
13281>>>>>        If (iType = DF_BCD) Begin
13283>>>>>            Get_Attribute DF_FIELD_PRECISION of iFile iField to tResponse.iPrecision
13286>>>>>        End
13286>>>>>>
13286>>>>>
13286>>>>>        // Add the Field Options
13286>>>>>        Get File_Field_Options of hoDD iFile iField to iOptions
13287>>>>>        Move (iOptions iand DD_AUTOFIND = DD_AUTOFIND)              to tResponse.bAutoFind
13288>>>>>        Move (iOptions iand DD_AUTOFIND_GE = DD_AUTOFIND_GE)        to tResponse.bAutoFindGE
13289>>>>>        Move (iOptions iand DD_CAPSLOCK = DD_CAPSLOCK)              to tResponse.bCapsLock
13290>>>>>        Move (iOptions iand DD_DISPLAYONLY = DD_DISPLAYONLY)        to tResponse.bDisplayOnly
13291>>>>>        Move (iOptions iand DD_FINDREQ = DD_FINDREQ)                to tResponse.bFindReq
13292>>>>>        Move (iOptions iand DD_NOENTER = DD_NOENTER)                to tResponse.bNoEnter
13293>>>>>        Move (iOptions iand DD_NOPUT = DD_NOPUT)                    to tResponse.bNoPut
13294>>>>>        Move (iOptions iand DD_REQUIRED = DD_REQUIRED)              to tResponse.bRequired
13295>>>>>        Move (iOptions iand DD_ZERO_SUPPRESS = DD_ZERO_SUPPRESS)    to tResponse.bZeroSuppress
13296>>>>>        Move (iOptions iand DD_SKIPFOUND = DD_SKIPFOUND)            to tResponse.bSkipFound
13297>>>>>
13297>>>>>        // Add the foreign field options
13297>>>>>        Get Foreign_Field_Options of hoDD iField to iOptions
13298>>>>>        Move (iOptions iand DD_AUTOFIND = DD_AUTOFIND)              to tResponse.bForeign_AutoFind
13299>>>>>        Move (iOptions iand DD_AUTOFIND_GE = DD_AUTOFIND_GE)        to tResponse.bForeign_AutoFindGE
13300>>>>>        Move (iOptions iand DD_DISPLAYONLY = DD_DISPLAYONLY)        to tResponse.bForeign_DisplayOnly
13301>>>>>        Move (iOptions iand DD_FINDREQ = DD_FINDREQ)                to tResponse.bForeign_FindReq
13302>>>>>        Move (iOptions iand DD_NOENTER = DD_NOENTER)                to tResponse.bForeign_NoEnter
13303>>>>>        Move (iOptions iand DD_NOPUT = DD_NOPUT)                    to tResponse.bForeign_NoPut
13304>>>>>        Move (iOptions iand DD_SKIPFOUND = DD_SKIPFOUND)            to tResponse.bForeign_SkipFound
13305>>>>>        
13305>>>>>        Get Field_Validate_msg of hoDD iField to iValidateFieldMessage
13306>>>>>        Move (iValidateFieldMessage > 0) to tResponse.bValidateServer
13307>>>>>        
13307>>>>>        // Add mask if needed
13307>>>>>        Get File_Field_Mask_Type of hoDD iFile iField to iMaskType
13308>>>>>        Case Begin
13308>>>>>            Case  (iMaskType = Mask_Window)
13310>>>>>                Move "win" to tResponse.sMaskType    
13311>>>>>                Get File_Field_Mask of hoDD iFile iField to tResponse.sMask
13312>>>>>                Case Break
13313>>>>>            Case  (iMaskType = Mask_Currency_Window)
13316>>>>>                Move "cur" to tResponse.sMaskType    
13317>>>>>                Get File_Field_Mask of hoDD iFile iField to tResponse.sMask
13318>>>>>                
13318>>>>>                If (tResponse.sMask = "") Begin
13320>>>>>                    //  Call the global default mask method
13320>>>>>                    Get Field_Number_Default_Mask iFile iField "$,*;($,*)" to tResponse.sMask 
13321>>>>>                End
13321>>>>>>
13321>>>>>                Case Break
13322>>>>>            Case  (iMaskType = Mask_Numeric_Window)
13325>>>>>                Move "num" to tResponse.sMaskType    
13326>>>>>                Get File_Field_Mask of hoDD iFile iField to tResponse.sMask
13327>>>>>                
13327>>>>>                If (tResponse.sMask = "") Begin
13329>>>>>                    //  Call the global default mask method
13329>>>>>                    Get Field_Number_Default_Mask iFile iField "*" to tResponse.sMask 
13330>>>>>                End
13330>>>>>>
13330>>>>>                Case Break
13331>>>>>            Case  (iMaskType = Mask_Date_Window)
13334>>>>>                Move "dat" to tResponse.sMaskType    
13335>>>>>                Get File_Field_Mask of hoDD iFile iField to tResponse.sMask
13336>>>>>                
13336>>>>>                If (tResponse.sMask = "") Begin
13338>>>>>                    Get_Attribute DF_DATE_SEPARATOR to iSeparator
13341>>>>>                    Get_Attribute DF_DATE_FORMAT to iMask
13344>>>>>                    
13344>>>>>                    If (iMask = DF_DATE_USA) Move ("mm" + (character(iSeparator)) +  "dd" + (character(iSeparator)) +  "yyyy") to tResponse.sMask
13347>>>>>                    Else If (iMask=DF_DATE_EUROPEAN) Move ("dd" + (character(iSeparator)) + "mm" + (character(iSeparator)) + "yyyy") to tResponse.sMask
13351>>>>>                    Else If (iMask=DF_DATE_MILITARY) Move ("yyyy" + (character(iSeparator)) + "mm" + (character(iSeparator)) + "dd") to tResponse.sMask
13355>>>>>                End
13355>>>>>>
13355>>>>>                Case Break
13356>>>>>            Case (iMaskType = Mask_Datetime_Window)
13359>>>>>                //  We whould add datetime support here
13359>>>>>                Move "dt" to tResponse.sMask
13360>>>>>                Get File_Field_Mask of hoDD iFile iField to tResponse.sMask
13361>>>>>        Case End
13361>>>>>        
13361>>>>>        // Add maximum and minimum if range defined
13361>>>>>        Get Field_Validation_Type of hoDD iField to iValidationType
13362>>>>>        If (iValidationType = FA_VALIDATION_TYPE_RANGE) Begin
13364>>>>>            Move ((iField * FA_COUNT) + FA_MIN_VALUE) to iItem
13365>>>>>            Get Value of (Field_Attributes(hoDD)) item iItem to tResponse.sMinValue
13366>>>>>        
13366>>>>>            Move ((iField * FA_COUNT) + FA_MAX_VALUE) to iItem
13367>>>>>            Get Value of (Field_Attributes(hoDD)) item iItem to tResponse.sMaxValue
13368>>>>>        End
13368>>>>>>
13368>>>>>        
13368>>>>>        // Add value check if defined ("VAL1|VAL2|VAL3...")
13368>>>>>        If (iValidationType = FA_VALIDATION_TYPE_CHECK) Begin
13370>>>>>            Move ((iField * FA_COUNT) + FA_CHECK_VALUE) to iItem
13371>>>>>            Get Value of (Field_Attributes(hoDD)) item iItem to tResponse.sCheck
13372>>>>>        End
13372>>>>>>
13372>>>>>        
13372>>>>>        //  Add checkbox values
13372>>>>>        Get File_Field_CheckBox_Value of hoDD iFile iField True to tResponse.sChecked
13373>>>>>        Get File_Field_CheckBox_Value of hoDD iFile iField False to tResponse.sUnchecked
13374>>>>>
13374>>>>>        // Add index information
13374>>>>>        Get File_Field_Index of hoDD iFile iField to iFieldIndex
13375>>>>>        If (iFieldIndex <> -1) Begin
13377>>>>>            Move iFieldIndex to tResponse.iIndex
13378>>>>>        End
13378>>>>>>
13378>>>>>        
13378>>>>>        //default value
13378>>>>>        If (iType <> DF_OVERLAP and iType <> DF_TEXT) Begin
13380>>>>>            Get File_Field_Current_Value of hoDD iFile iField to sTempValue
13381>>>>>            Set File_Field_Current_Value of hoDD iFile iField to ""
13382>>>>>            Send Field_defaults of hoDD
13383>>>>>            Get File_Field_Current_Value of hoDD iFile iField to tResponse.sDefaultValue
13384>>>>>            Set File_Field_Current_Value of hoDD iFile iField to sTempValue
13385>>>>>        End
13385>>>>>>
13385>>>>>        
13385>>>>>        Function_Return tResponse
13386>>>>>    End_Function
13387>>>>>    
13387>>>>>    
13387>>>>>    //
13387>>>>>    //  Fetches specific properties for a set of field. Uses AjaxMetaProperty 
13387>>>>>    //  to fetch the actual property.
13387>>>>>    //
13387>>>>>    //  Params:
13387>>>>>    //      aFields     Array with field names
13387>>>>>    //      aProperties Array with property names
13387>>>>>    //  Returns:
13387>>>>>    //      Struct with the result values.
13387>>>>>    //
13387>>>>>    Function AjaxMetaProperties String[] aFields String[] aProperties Returns TAjaxMetaProperties
13389>>>>>        TAjaxMetaProperties tResult
13389>>>>>        TAjaxMetaProperties tResult
13389>>>>>        TAjaxMetaPropField tField tClearField
13389>>>>>        TAjaxMetaPropField tField tClearField
13389>>>>>        String sFile sField
13389>>>>>        Handle hoMainDD hoDD
13389>>>>>        Integer iFieldCount iCurrent iPropCount iProp iFile iField
13389>>>>>        
13389>>>>>        Get Main_DD to hoMainDD
13390>>>>>        If (hoMainDD = 0) Begin
13392>>>>>            Error 5631 "Main_DD not set"
13393>>>>>>
13393>>>>>            Function_Return tResult
13394>>>>>        End        
13394>>>>>>
13394>>>>>        
13394>>>>>        
13394>>>>>        Move (SizeOfArray(aFields) - 1) to iFieldCount
13395>>>>>        Move (SizeOfArray(aProperties) - 1) to iPropCount
13396>>>>>        
13396>>>>>        For iCurrent from 0 to iFieldCount
13402>>>>>>
13402>>>>>            
13402>>>>>            //  Split name into file and field name
13402>>>>>            Move (left(aFields[iCurrent], (pos(".", aFields[iCurrent]) - 1))) to sFile
13403>>>>>            Move (mid(aFields[iCurrent], length(aFields[iCurrent]),(pos(".", aFields[iCurrent]) + 1))) to sField
13404>>>>>
13404>>>>>            //  Find file number
13404>>>>>            Get Search_File_Name sFile to iFile
13405>>>>>            If (iFile > -1) Begin
13407>>>>>                
13407>>>>>                //  Find field number
13407>>>>>                Get FieldMap iFile sField to iField
13408>>>>>                If (iField <> -1) Begin
13410>>>>>                    
13410>>>>>                    //  Find DD
13410>>>>>                    Get Data_Set of hoMainDD iFile to hoDD
13411>>>>>                    
13411>>>>>                    //  Initialize field struct
13411>>>>>                    Move tClearField to tField
13412>>>>>                    Move (Lowercase(sFile)) to tField.sTable
13413>>>>>                    Move (Lowercase(sField)) to tField.sField
13414>>>>>                    
13414>>>>>                    //  Fetch the different properties
13414>>>>>                    For iProp from 0 to iPropCount
13420>>>>>>
13420>>>>>                        Get AjaxMetaProperty hoDD iFile iField aProperties[iProp] to tField.aProperties[(SizeOfArray(tField.aProperties))]
13421>>>>>                    Loop
13422>>>>>>
13422>>>>>                    
13422>>>>>                    Move tField to tResult.aFields[(SizeOfArray(tResult.aFields))
13423>>>>>                End
13423>>>>>>
13423>>>>>            End
13423>>>>>>
13423>>>>>            
13423>>>>>            
13423>>>>>                    
13423>>>>>        Loop
13424>>>>>>
13424>>>>>        
13424>>>>>        Function_Return tResult
13425>>>>>    End_Function
13426>>>>>
13426>>>>>    //
13426>>>>>    //  Fetches a specific field property. These property aren't that commonly 
13426>>>>>    //  used so they aren't added to the default field properties struct.
13426>>>>>    //
13426>>>>>    //  Params:
13426>>>>>    //      iFile   File number
13426>>>>>    //      iField  Field number
13426>>>>>    //      sProp   Name of the property
13426>>>>>    //  Returns:
13426>>>>>    //      Structure with the property
13426>>>>>    //
13426>>>>>    Function AjaxMetaProperty Handle hoDD Integer iFile Integer iField String sProp Returns TAjaxMetaProperty
13428>>>>>        TAjaxMetaProperty tResult
13428>>>>>        TAjaxMetaProperty tResult
13428>>>>>        Integer iOptions
13428>>>>>        
13428>>>>>        Move sProp to tResult.sProperty
13429>>>>>        
13429>>>>>        Case Begin
13429>>>>>            Case (sProp = "bForcePut")
13431>>>>>                Get File_Field_Options of hoDD iFile iField to iOptions
13432>>>>>                Move (iOptions iand DD_FORCEPUT = DD_FORCEPUT)  to tResult.sValue
13433>>>>>                Case Break
13434>>>>>            Case (sProp = "bRetain")
13437>>>>>                Get File_Field_Options of hoDD iFile iField to iOptions
13438>>>>>                Move (iOptions iand DD_RETAIN = DD_RETAIN) to tResult.sValue
13439>>>>>                Case Break
13440>>>>>            Case (sProp = "bRetainAll")
13443>>>>>                Get File_Field_Options of hoDD iFile iField to iOptions
13444>>>>>                Move (iOptions iand DD_RETAINALL = DD_RETAINALL) to tResult.sValue
13445>>>>>                Case Break
13446>>>>>            Case (sProp = "iValidationErrorNumber")
13449>>>>>                Get Field_Error_Number of hoDD iField to tResult.sValue
13450>>>>>                Case Break
13451>>>>>            Case (sProp = "sValidationErrorText")
13454>>>>>                Get Field_Error_Message of hoDD iField to tResult.sValue
13455>>>>>                Case Break
13456>>>>>            Case (sProp = "sLongLabel")
13459>>>>>                Get Field_Label_Long of hoDD iField  to tResult.sValue
13460>>>>>                Case Break
13461>>>>>            Case (sProp = "sStatusHelp")
13464>>>>>                Get File_Field_Status_Help of hoDD iFile iField to tResult.sValue
13465>>>>>                Case Break
13466>>>>>            Case Else
13466>>>>>                Error 5644 (SFormat("Property unknown: {0}", sProp))
13467>>>>>>
13467>>>>>        Case End
13467>>>>>        
13467>>>>>        
13467>>>>>        Function_Return tResult
13468>>>>>    End_Function
13469>>>>>    
13469>>>>>    
13469>>>>>    //
13469>>>>>    //  Fetches the description values that of the field.
13469>>>>>    //
13469>>>>>    //  Params:
13469>>>>>    //      hMain   Handle to the datadictionary
13469>>>>>    //      iFile   File number
13469>>>>>    //      iField  Field number
13469>>>>>    //  Returns:
13469>>>>>    //      String with descriptionvalues
13469>>>>>    //
13469>>>>>    Function AjaxMetaDescriptionValues String sField Returns TAjaxMetaDescriptionValues
13471>>>>>        Integer iItems iLoop iFile iField
13471>>>>>        String sFile sColumn
13471>>>>>        TAjaxMetaDescriptionValues tResult
13471>>>>>        TAjaxMetaDescriptionValues tResult
13471>>>>>        Handle hoDD hoMainDD
13471>>>>>        
13471>>>>>        Get Main_DD to hoMainDD
13472>>>>>        If (hoMainDD = 0) Begin
13474>>>>>            Error 5631 "Main_DD not set"
13475>>>>>>
13475>>>>>            Function_Return tResult
13476>>>>>        End     
13476>>>>>>
13476>>>>>        
13476>>>>>        //  Split name into file and field name
13476>>>>>        Move (left(sField, (pos(".", sField) - 1))) to sFile
13477>>>>>        Move (mid(sField, length(sField),(pos(".", sField) + 1))) to sColumn
13478>>>>>        
13478>>>>>        Move (Lowercase(sFile)) to tResult.sTable
13479>>>>>        Move (Lowercase(sColumn)) to tResult.sField
13480>>>>>
13480>>>>>        //  Find file number
13480>>>>>        Get Search_File_Name sFile to iFile
13481>>>>>        If (iFile > -1) Begin
13483>>>>>            
13483>>>>>            //  Find field number
13483>>>>>            Get FieldMap iFile sColumn to iField
13484>>>>>            If (iField <> -1) Begin
13486>>>>>                
13486>>>>>                //  Find DD
13486>>>>>                Get Data_Set of hoMainDD iFile to hoDD
13487>>>>>                
13487>>>>>                
13487>>>>>                Get ValTbl_Items hoDD iFile iField to iItems
13488>>>>>                Decrement iItems
13489>>>>>                For iLoop  from 0 to iItems
13495>>>>>>
13495>>>>>                    Get ValTbl_ItemData hoDD iFile iField iLoop to tResult.aValues[iLoop].sValue
13496>>>>>                    Get ValTbl_ItemDesc hoDD iFile iField iLoop to tResult.aValues[iLoop].sDescription
13497>>>>>                Loop
13498>>>>>>
13498>>>>>            End
13498>>>>>>
13498>>>>>            Else Begin
13499>>>>>                Error 5641 ("Field not found: " * sField)
13500>>>>>>
13500>>>>>            End
13500>>>>>>
13500>>>>>        End
13500>>>>>>
13500>>>>>        Else Begin
13501>>>>>            Error 5632 ("File not found: " * sFile)
13502>>>>>>
13502>>>>>        End
13502>>>>>>
13502>>>>>        
13502>>>>>        
13502>>>>>        Function_Return tResult
13503>>>>>    End_Function
13504>>>>>    
13504>>>>>    
13504>>>>>    //
13504>>>>>    //  Used to get userdata variables that are send with the request. Can only
13504>>>>>    //  be used while handling an request (from and between OnAjaxRequestStart 
13504>>>>>    //  and OnAjaxRequestEnd).
13504>>>>>    //  
13504>>>>>    //  Params:
13504>>>>>    //      sName   Name of the user data variable
13504>>>>>    //  Returns:
13504>>>>>    //      String value of the user data variable
13504>>>>>    //
13504>>>>>    Function GetAjaxRequestUserData String sName Returns String
13506>>>>>        Integer iTo iCurrent
13506>>>>>        String sResult
13506>>>>>        TAjaxUserData[] taData
13506>>>>>        TAjaxUserData[] taData
13507>>>>>        
13507>>>>>        //  Get data array
13507>>>>>        Get ptaRequestUserData to taData
13508>>>>>        Move "" to sResult
13509>>>>>        
13509>>>>>        //  Search data array
13509>>>>>        Move (SizeOfArray(taData)) to iTo
13510>>>>>        Move 0 to iCurrent
13511>>>>>        While (iCurrent < iTo and sResult = "")
13515>>>>>            If (Lowercase(taData[iCurrent].sName) = Lowercase(sName)) Begin
13517>>>>>                Move taData[iCurrent].sValue to sResult
13518>>>>>            End
13518>>>>>>
13518>>>>>            
13518>>>>>            Increment iCurrent
13519>>>>>        Loop
13520>>>>>>
13520>>>>>        
13520>>>>>        Function_Return sResult
13521>>>>>    End_Function
13522>>>>>    
13522>>>>>    //
13522>>>>>    //  Sets the value of an userdata variable that is sent back to the client.
13522>>>>>    //  All variables that are received with an request are also send back. If 
13522>>>>>    //  the variable already is set the value is overwritten. 
13522>>>>>    //
13522>>>>>    //  Params:
13522>>>>>    //      sName   Name of the user data variable
13522>>>>>    //      sValue  New value of the user data variable
13522>>>>>    //  
13522>>>>>    Procedure SetAjaxResponseUserData String sName String sValue
13524>>>>>        Integer iPos iTo
13524>>>>>        TAjaxUserData[] taData
13524>>>>>        TAjaxUserData[] taData
13525>>>>>        
13525>>>>>        Get ptaRequestUserData to taData
13526>>>>>        
13526>>>>>        Move (SizeOfArray(taData)) to iTo
13527>>>>>        Move 0 to iPos
13528>>>>>        While (iPos < iTo and not(Lowercase(taData[iPos].sName) = Lowercase(sName)))
13532>>>>>            Increment iPos
13533>>>>>        Loop
13534>>>>>>
13534>>>>>        
13534>>>>>        Move sName to taData[iPos].sName
13535>>>>>        Move sValue to taData[iPos].sValue
13536>>>>>        
13536>>>>>        Set ptaRequestUserData to taData
13537>>>>>    End_Procedure
13538>>>>>    
13538>>>>>    //
13538>>>>>    //  Gets userdata variables from the request set. These can only be used 
13538>>>>>    //  while processing an requestset (from and between OnAjaxRequestSetStart 
13538>>>>>    //  and OnAjaxRequestSetEnd).
13538>>>>>    //
13538>>>>>    //  Params:
13538>>>>>    //      sName   Name of the user data variable
13538>>>>>    //  Returns:
13538>>>>>    //      Value of the user data variable
13538>>>>>    //
13538>>>>>    Function GetAjaxRequestSetUserData String sName Returns String
13540>>>>>        Integer iTo iCurrent
13540>>>>>        String sResult
13540>>>>>        TAjaxUserData[] taData
13540>>>>>        TAjaxUserData[] taData
13541>>>>>        
13541>>>>>        Get ptaRequestSetUserData to taData
13542>>>>>        
13542>>>>>        Move "" to sResult
13543>>>>>        Move (SizeOfArray(taData)) to iTo
13544>>>>>        Move 0 to iCurrent
13545>>>>>        While (iCurrent < iTo and sResult = "")
13549>>>>>            If (Lowercase(taData[iCurrent].sName) = Lowercase(sName)) Begin
13551>>>>>                Move taData[iCurrent].sValue to sResult
13552>>>>>            End
13552>>>>>>
13552>>>>>            
13552>>>>>            Increment iCurrent
13553>>>>>        Loop
13554>>>>>>
13554>>>>>        
13554>>>>>        Function_Return sResult
13555>>>>>    End_Function
13556>>>>>    
13556>>>>>    //
13556>>>>>    //  Sets the value of an userdata variable that is sent back to the client.
13556>>>>>    //  All variables that are received with an request are also send back. If 
13556>>>>>    //  the variable already is set the value is overwritten. 
13556>>>>>    //
13556>>>>>    //  Params:
13556>>>>>    //      sName   Name of the user data variable
13556>>>>>    //      sValue  New value of the user data variable
13556>>>>>    //
13556>>>>>    Procedure SetAjaxResponseSetUserData String sName String sValue
13558>>>>>        Integer iPos iTo
13558>>>>>        TAjaxUserData[] taData
13558>>>>>        TAjaxUserData[] taData
13559>>>>>        
13559>>>>>        Get ptaRequestSetUserData to taData
13560>>>>>        
13560>>>>>        Move (SizeOfArray(taData)) to iTo
13561>>>>>        Move 0 to iPos
13562>>>>>        While (iPos < iTo and Lowercase(taData[iPos].sName) = Lowercase(sName))
13566>>>>>            Increment iPos
13567>>>>>        Loop
13568>>>>>>
13568>>>>>        
13568>>>>>        Move (SizeOfArray(taData)) to iPos
13569>>>>>        Move sName to taData[iPos].sName
13570>>>>>        Move sValue to taData[iPos].sValue
13571>>>>>        
13571>>>>>        Set ptaRequestSetUserData to taData
13572>>>>>    End_Procedure
13573>>>>>    
13573>>>>>    //
13573>>>>>    //  This event method is called before the handling of a request starts. 
13573>>>>>    //  The method can be overridden in the object to initialize and set 
13573>>>>>    //  constrains or manipulate the request data.
13573>>>>>    //
13573>>>>>    //  Params:
13573>>>>>    //      tRequestData     Reference to the request data
13573>>>>>    //
13573>>>>>    Procedure OnAjaxRequestStart TAjaxRequestData ByRef tRequestData
13575>>>>>    End_Procedure
13576>>>>>    
13576>>>>>    //
13576>>>>>    //  This event method is called when the handling of a request is finished. 
13576>>>>>    //  The method can be overridden in the object to initialize and set 
13576>>>>>    //  constrains or manipulate the request data.
13576>>>>>    //
13576>>>>>    //  Params:
13576>>>>>    //      tResponseData    Reference to the response data
13576>>>>>    //
13576>>>>>    Procedure OnAjaxRequestEnd TAjaxResponseData ByRef tResponseData
13578>>>>>    End_Procedure
13579>>>>>    
13579>>>>>    //
13579>>>>>    //  This event method is called before the handling of a requestset starts.
13579>>>>>    //  The method can be overridden in the object to do requestset specific 
13579>>>>>    //  preparations and manipulate the requestset data.
13579>>>>>    //
13579>>>>>    //  Params:
13579>>>>>    //      tRequestSet      Reference to the tRequestSet data
13579>>>>>    //
13579>>>>>    Procedure OnAjaxRequestSetStart TAjaxRequestSet ByRef tRequestSet
13581>>>>>    End_Procedure
13582>>>>>    
13582>>>>>    //
13582>>>>>    //  This event method is called when the handling of a requestset is 
13582>>>>>    //  finished. The method can be overridden in the object to clean the web
13582>>>>>    //  object or to manipulate the responseset data.
13582>>>>>    //
13582>>>>>    //  Params:
13582>>>>>    //      tResponseSet     Reference to the responseset data
13582>>>>>    //
13582>>>>>    Procedure OnAjaxRequestSetEnd TAjaxResponseSet ByRef tResponseSet
13584>>>>>    End_Procedure
13585>>>>>    
13585>>>>>    //
13585>>>>>    //  Clears the data dictionaries by sending an Clear_All to the main data
13585>>>>>    //  dictionary. Extracts the userdata from the request and calls the 
13585>>>>>    //  OnRequestSetStart.
13585>>>>>    //
13585>>>>>    //  Params:
13585>>>>>    //      tRequestData     Reference to the requestdata
13585>>>>>    //
13585>>>>>    Procedure AjaxRequestStart TAjaxRequestData ByRef tRequestData
13587>>>>>        Handle hoMainDD
13587>>>>>        
13587>>>>>        Get Main_DD to hoMainDD
13588>>>>>        If (hoMainDD <> 0) Begin
13590>>>>>            //  Clear DD's
13590>>>>>            Send Clear_All of hoMainDD
13591>>>>>            
13591>>>>>            //  Extract user data
13591>>>>>            Set ptaRequestUserData to tRequestData.aUserData
13592>>>>>            
13592>>>>>            //  Call user defined method
13592>>>>>            Send OnAjaxRequestStart (&tRequestData)            
13593>>>>>        End
13593>>>>>>
13593>>>>>        Else Begin
13594>>>>>            Error 5631 "Main_DD not set"
13595>>>>>>
13595>>>>>        End
13595>>>>>>
13595>>>>>    End_Procedure
13596>>>>>    
13596>>>>>    //
13596>>>>>    //  Called when request ends (all requestsets are handled). Calls the user 
13596>>>>>    //  defined method and then updats the user data of the response.
13596>>>>>    //
13596>>>>>    //  Params:
13596>>>>>    //      Reference to the response data
13596>>>>>    //
13596>>>>>    Procedure AjaxRequestEnd TAjaxResponseData ByRef tResponseData
13598>>>>>        //  Call user defined method
13598>>>>>        Send OnAjaxRequestEnd (&tResponseData)
13599>>>>>        
13599>>>>>        //  Save user data
13599>>>>>        Get ptaRequestUserData to tResponseData.aUserData
13600>>>>>    End_Procedure
13601>>>>>    
13601>>>>>    //
13601>>>>>    //  Called when the processing of an requestset starts. Extracts the user 
13601>>>>>    //  data and calls the user defined method OnAjaxRequestSetStart.
13601>>>>>    //
13601>>>>>    //  Params:
13601>>>>>    //      Reference to the tRequestSet data
13601>>>>>    //
13601>>>>>    Procedure AjaxRequestSetStart TAjaxRequestSet ByRef tRequestSet
13603>>>>>        //  Extract user data
13603>>>>>        Set ptaRequestSetUserData to tRequestSet.aUserData
13604>>>>>        
13604>>>>>        //  Call user defined method
13604>>>>>        Send OnAjaxRequestSetStart (&tRequestSet)
13605>>>>>    End_Procedure
13606>>>>>    
13606>>>>>    //
13606>>>>>    //  Called when the processing of an requestset ends. Calls the user 
13606>>>>>    //  defined method and saves the userdata. 
13606>>>>>    //
13606>>>>>    //  Params:
13606>>>>>    //      tResponseSet Reference to the reponseset data
13606>>>>>    //
13606>>>>>    Procedure AjaxRequestSetEnd TAjaxResponseSet ByRef tResponseSet
13608>>>>>        //  Call user defined method
13608>>>>>        Send OnAjaxRequestSetEnd (&tResponseSet)
13609>>>>>        
13609>>>>>        //  Save user data
13609>>>>>        Get ptaRequestSetUserData to tResponseSet.aUserData
13610>>>>>    End_Procedure
13611>>>>>    
13611>>>>>    //    
13611>>>>>    //  Handles requestsets of the findByField type. The difference Between 
13611>>>>>    //  findByField and Find is that findByField uses the File_Field_Find 
13611>>>>>    //  message to perform the Find and won't work in deferred mode. 
13611>>>>>    //  File_Field_Find uses Item_Find like the windows interface so the 
13611>>>>>    //  behavior will be the same. The results are stored in the responseset 
13611>>>>>    //  that is returned.
13611>>>>>    //
13611>>>>>    //  Params:
13611>>>>>    //      tRequestSet Structure with request information
13611>>>>>    //  Returns:
13611>>>>>    //      Filled responseset structure
13611>>>>>    //    
13611>>>>>    Function AjaxFindByField TAjaxRequestSet ByRef tRequestSet Returns TAjaxResponseSet
13613>>>>>        TAjaxResponseSet tResponseSet
13613>>>>>        TAjaxResponseSet tResponseSet
13613>>>>>        TAjaxSnapShot tRequestRow
13613>>>>>        TAjaxSnapShot tRequestRow
13613>>>>>        Handle hoRequestDD hoMainDD
13613>>>>>        Integer iRow iFile iMode iField
13613>>>>>        Boolean bContinue bHasRecord bAllowFind bLoaded
13613>>>>>        
13613>>>>>        //  Check pbAllowFind
13613>>>>>        Get pbAllowFind to bAllowFind
13614>>>>>        If (not(bAllowFind)) Begin
13616>>>>>            Error 5643 "Find is not allowed"
13617>>>>>>
13617>>>>>            Function_Return tResponseSet
13618>>>>>        End        
13618>>>>>>
13618>>>>>        
13618>>>>>        Move 0 to iRow
13619>>>>>        
13619>>>>>        //  Get MainDD & RequestDD
13619>>>>>        Get Main_DD to hoMainDD
13620>>>>>        If (hoMainDD = 0) Begin
13622>>>>>            Error 5631 "Main_DD not set"
13623>>>>>>
13623>>>>>            Function_Return tResponseSet
13624>>>>>        End   
13624>>>>>>
13624>>>>>        Get Search_File_Name tRequestSet.sTable to iFile
13625>>>>>        If (iFile = 0) Begin
13627>>>>>            Error 5632 ("File not found: " + tRequestSet.sTable)
13628>>>>>>
13628>>>>>            Function_Return tResponseSet
13629>>>>>        End        
13629>>>>>>
13629>>>>>        Get Data_Set of hoMainDD iFile to hoRequestDD
13630>>>>>        If (hoRequestDD = 0) Begin
13632>>>>>            Error 5633 (SFormat("Data dictionary not found for table: %1 (%2)", tRequestSet.sTable, iFile))
13633>>>>>>
13633>>>>>            Function_Return tResponseSet
13634>>>>>        End
13634>>>>>>
13634>>>>>    
13634>>>>>        //  Get the field
13634>>>>>        Get FieldMap iFile tRequestSet.sColumn to iField
13635>>>>>        If (iField < 0) Begin
13637>>>>>            Error 5641 ("Field not found: " * tRequestSet.sColumn)
13638>>>>>>
13638>>>>>            Function_Return tResponseSet
13639>>>>>        End
13639>>>>>>
13639>>>>>    
13639>>>>>        //  Find the mode information
13639>>>>>        If (tRequestSet.sFindMode > "") Begin
13641>>>>>            If ("0123456789" contains left(tRequestSet.sFindMode,1)) Begin
13643>>>>>                Move tRequestSet.sFindMode to iMode
13644>>>>>            End
13644>>>>>>
13644>>>>>            Else Begin
13645>>>>>                Move (Eval(tRequestSet.sFindMode)) to iMode
13646>>>>>            End
13646>>>>>>
13646>>>>>        End
13646>>>>>>
13646>>>>>        If (iMode < LT or iMode > LAST_RECORD) Begin
13648>>>>>            Error 5634 ("Invalid findmode given: " + tRequestSet.sFindMode)
13649>>>>>>
13649>>>>>            Function_Return tResponseSet
13650>>>>>        End
13650>>>>>>
13650>>>>>    
13650>>>>>        //  One tRequestrow is required
13650>>>>>        If (SizeOfArray(tRequestSet.aRows) = 0) Begin
13652>>>>>            Error 5634 "One requestrow is required"
13653>>>>>>
13653>>>>>            Function_Return tResponseSet
13654>>>>>        End
13654>>>>>>
13654>>>>>        
13654>>>>>        
13654>>>>>        
13654>>>>>        //  If bReturnCurrent append a row with the current values
13654>>>>>        If (tRequestSet.bReturnCurrent) Begin
13656>>>>>            Move tRequestSet.aRows[iRow] to tRequestRow
13657>>>>>            Get AjaxLoadSnapShot (&tRequestRow) hoRequestDD to bLoaded
13658>>>>>            
13658>>>>>            Get hasRecord of hoRequestDD to bHasRecord
13659>>>>>            
13659>>>>>            If (bHasRecord) Begin
13661>>>>>                Get AjaxCreateSnapShot (&tRequestRow) hoMainDD to tResponseSet.aRows[iRow]
13662>>>>>                
13662>>>>>                Increment iRow
13663>>>>>            End
13663>>>>>>
13663>>>>>        End
13663>>>>>>
13663>>>>>        
13663>>>>>        //  Repeat find procedure until nothing found or maximum reached
13663>>>>>        Move True to bContinue
13664>>>>>        While (iRow < tRequestSet.iMaxRows and bContinue)
13668>>>>>            //  Load current status
13668>>>>>            If (SizeOfArray(tRequestSet.aRows) > iRow) Begin
13670>>>>>                Move tRequestSet.aRows[iRow] to tRequestRow
13671>>>>>                Get AjaxLoadSnapShot (&tRequestRow) hoRequestDD to bLoaded
13672>>>>>            End
13672>>>>>>
13672>>>>>            Else Begin
13673>>>>>                //  Doing a find LE or find GE multiple times makes no sense
13673>>>>>                If (iMode = LE) Move (LT) to iMode
13676>>>>>                If (iMode = GE or iMode = EQ) Move (GT) to iMode
13679>>>>>            End
13679>>>>>>
13679>>>>>            
13679>>>>>            //  Do the find
13679>>>>>            Send File_Field_Find of hoRequestDD iMode iFile iField True False False
13680>>>>>            Move (Found) to tResponseSet.bFound
13681>>>>>            
13681>>>>>            //  Add responserow of exit loop
13681>>>>>            If (Found) Begin
13683>>>>>                Get AjaxCreateSnapShot (&tRequestRow) hoMainDD to tResponseSet.aRows[iRow] // Add resultrow
13684>>>>>            End
13684>>>>>>
13684>>>>>            Else Begin
13685>>>>>                Move False to bContinue
13686>>>>>            End
13686>>>>>>
13686>>>>>    
13686>>>>>            Increment iRow
13687>>>>>        Loop
13688>>>>>>
13688>>>>>        
13688>>>>>        //  Set result info
13688>>>>>        Move tRequestSet.sTable to tResponseSet.sTable
13689>>>>>        Move tRequestSet.sColumn to tResponseSet.sColumn
13690>>>>>        Move tRequestSet.sName to tResponseSet.sName
13691>>>>>        Move "findByField" to tResponseSet.sResponseType
13692>>>>>        Move (SizeOfArray(tResponseSet.aRows)) to tResponseSet.iRows
13693>>>>>        
13693>>>>>        Function_Return tResponseSet
13694>>>>>        
13694>>>>>        
13694>>>>>    End_Function
13695>>>>>    
13695>>>>>    //
13695>>>>>    //  Handles requestsets of the find type. It loads the first status row 
13695>>>>>    //  into the buffers and keeps repeating the find with given options until
13695>>>>>    //  nothing is found or the number of rows requested is reached. If there 
13695>>>>>    //  are more rows in the requestset these are loaded at each new find 
13695>>>>>    //  action. The results of each find are saved in the responseset.
13695>>>>>    //
13695>>>>>    //  Params:
13695>>>>>    //      tRequestSet  Structure with request information
13695>>>>>    //  Returns:
13695>>>>>    //      Filled TAjaxResponseSet structure
13695>>>>>    //
13695>>>>>    Function AjaxFind TAjaxRequestSet ByRef tRequestSet Returns TAjaxResponseSet
13697>>>>>        TAjaxResponseSet tResponseSet
13697>>>>>        TAjaxResponseSet tResponseSet
13697>>>>>        TAjaxSnapShot tRequestRow
13697>>>>>        TAjaxSnapShot tRequestRow
13697>>>>>        Handle hoRequestDD hoMainDD
13697>>>>>        Integer iRow iFile iMode iField iIndex iSegment iSegmentMax iType
13697>>>>>        Boolean bContinue bHasRecord bAllowFind bLoaded
13697>>>>>        String sFieldValue sFile sValue
13697>>>>>
13697>>>>>        //  Check pbAllowFind
13697>>>>>        Get pbAllowFind to bAllowFind
13698>>>>>        If (not(bAllowFind)) Begin
13700>>>>>            Error 5643 "Find is not allowed"
13701>>>>>>
13701>>>>>            Function_Return tResponseSet
13702>>>>>        End
13702>>>>>>
13702>>>>>                
13702>>>>>        Move 0 to iRow
13703>>>>>        
13703>>>>>        //  Get MainDD & RequestDD
13703>>>>>        Get Main_DD to hoMainDD
13704>>>>>        If (hoMainDD = 0) Begin
13706>>>>>            Error 5631 "Main_DD not set"
13707>>>>>>
13707>>>>>            Function_Return tResponseSet
13708>>>>>        End
13708>>>>>>
13708>>>>>        
13708>>>>>        Get Search_File_Name tRequestSet.sTable to iFile     
13709>>>>>        If (iFile = 0) Begin
13711>>>>>            Error 5632 ("File not found: " + tRequestSet.sTable)
13712>>>>>>
13712>>>>>            Function_Return tResponseSet
13713>>>>>        End        
13713>>>>>>
13713>>>>>        Get Data_Set of hoMainDD iFile to hoRequestDD
13714>>>>>        If (hoRequestDD = 0) Begin
13716>>>>>            Error 5633 (SFormat("Data dictionary not found for table: %1 (%2)", tRequestSet.sTable, iFile))
13717>>>>>>
13717>>>>>            Function_Return tResponseSet
13718>>>>>        End
13718>>>>>>
13718>>>>>    
13718>>>>>        //  Find the mode information
13718>>>>>        If (tRequestSet.sFindMode > "") Begin
13720>>>>>            If ("0123456789" contains left(tRequestSet.sFindMode,1)) Begin
13722>>>>>                Move tRequestSet.sFindMode to iMode
13723>>>>>            End
13723>>>>>>
13723>>>>>            Else Begin
13724>>>>>                Move (Eval(tRequestSet.sFindMode)) to iMode
13725>>>>>            End
13725>>>>>>
13725>>>>>        End
13725>>>>>>
13725>>>>>        If (iMode < LT or iMode > LAST_RECORD) Begin
13727>>>>>            Error 5634 ("Invalid findmode given: " + tRequestSet.sFindMode)
13728>>>>>>
13728>>>>>            Function_Return tResponseSet
13729>>>>>        End
13729>>>>>>
13729>>>>>    
13729>>>>>        //  Find the index information
13729>>>>>        If (tRequestSet.sIndex > "") Begin
13731>>>>>            If ("0123456789" contains left(tRequestSet.sIndex,1)) Begin
13733>>>>>                Move tRequestSet.sIndex to iIndex
13734>>>>>            End
13734>>>>>>
13734>>>>>            Else Begin
13735>>>>>                Get MaptoFieldNumber iFile tRequestSet.sIndex To iField
13736>>>>>                If (iField >=0) Begin
13738>>>>>                    Get Field_Main_Index of hoRequestDD iFile iField to iIndex
13739>>>>>                End
13739>>>>>>
13739>>>>>            End
13739>>>>>>
13739>>>>>        End
13739>>>>>>
13739>>>>>        
13739>>>>>        //  One tRequestrow is required
13739>>>>>        If (SizeOfArray(tRequestSet.aRows) = 0) Begin
13741>>>>>            Error 5634 "One requestrow is required"
13742>>>>>>
13742>>>>>            Function_Return tResponseSet
13743>>>>>        End
13743>>>>>>
13743>>>>>        
13743>>>>>        
13743>>>>>        
13743>>>>>        //  If bReturnCurrent append a row with the current values
13743>>>>>        If (tRequestSet.bReturnCurrent) Begin
13745>>>>>            Move tRequestSet.aRows[iRow] to tRequestRow
13746>>>>>            If (tRequestSet.bLoadStatus) Begin
13748>>>>>                Get AjaxLoadSnapShot (&tRequestRow) hoRequestDD to bLoaded
13749>>>>>            End
13749>>>>>>
13749>>>>>    
13749>>>>>            Get hasRecord of hoRequestDD to bHasRecord
13750>>>>>            
13750>>>>>            If (bHasRecord) Begin
13752>>>>>                Get AjaxCreateSnapShot (&tRequestRow) hoMainDD to tResponseSet.aRows[iRow] // Add resultrow
13753>>>>>                Increment iRow
13754>>>>>            End
13754>>>>>>
13754>>>>>        End
13754>>>>>>
13754>>>>>        
13754>>>>>        //  Repeat find procedure until nothing found or maximum reached
13754>>>>>        Move True to bContinue
13755>>>>>        While (iRow < tRequestSet.iMaxRows and bContinue)
13759>>>>>            //  Load current status
13759>>>>>            If (SizeOfArray(tRequestSet.aRows) > iRow) Begin
13761>>>>>                Move tRequestSet.aRows[iRow] to tRequestRow
13762>>>>>                
13762>>>>>                If (tRequestSet.bLoadStatus) Begin
13764>>>>>                    Get AjaxLoadSnapShot (&tRequestRow) hoRequestDD to bLoaded
13765>>>>>                End
13765>>>>>>
13765>>>>>            End
13765>>>>>>
13765>>>>>            Else Begin
13766>>>>>                //  Some findmodes don't make any sense multiple times
13766>>>>>                Case Begin
13766>>>>>                    Case (iMode = LE) 
13768>>>>>                        Move (LT) to iMode
13769>>>>>                        Case Break
13770>>>>>                    Case (iMode = GE)
13773>>>>>                        Move (GT) to iMode
13774>>>>>                        Case Break
13775>>>>>                    Case (iMode = EQ)
13778>>>>>                        Move (GT) to iMode
13779>>>>>                        Case Break
13780>>>>>                    Case (iMode = LAST_RECORD)
13783>>>>>                        Move (LT) to iMode
13784>>>>>                        Case Break
13785>>>>>                    Case (iMode = FIRST_RECORD)
13788>>>>>                        Move (GT) to iMode
13789>>>>>                        Case Break
13790>>>>>                Case End
13790>>>>>            End
13790>>>>>>
13790>>>>>    
13790>>>>>            //  If the buffer contains no record and the index values are empty 
13790>>>>>            //  fill them with the highest or the lowest values, this way a 
13790>>>>>            //  Find LT on a empty buffer will return the first record
13790>>>>>//            Get hasRecord of hoRequestDD to bHasRecord
13790>>>>>//            If ((iMode = LT or iMode = GT) and not(bHasRecord)) Begin
13790>>>>>//                Get_Attribute DF_INDEX_NUMBER_SEGMENTS of iFile iIndex to iSegmentMax
13790>>>>>//                For iSegment from 1 to iSegmentMax
13790>>>>>//                    Get_Attribute DF_INDEX_SEGMENT_FIELD of iFile iIndex iSegment to iField
13790>>>>>//                    Get_Field_Value iFile iField to sFieldValue
13790>>>>>//                    Get_Attribute DF_FIELD_TYPE of iFile iField to iType
13790>>>>>//
13790>>>>>//                    If (sFieldValue = "" or (iType = DF_BCD and sFieldValue = 0)) Begin
13790>>>>>//                        If (iMode = LT) Begin
13790>>>>>//                            Fill_Field iFile iField With DF_HIGH
13790>>>>>//                        End
13790>>>>>//                        Else If (iMode = GT) Begin
13790>>>>>//                            Fill_Field iFile iField With DF_LOW
13790>>>>>//                        End
13790>>>>>//                    End
13790>>>>>//                Loop
13790>>>>>//            End
13790>>>>>    
13790>>>>>            //  Do the find
13790>>>>>            Send Request_Find of hoRequestDD iMode iFile iIndex
13791>>>>>
13791>>>>>            Move (Found) to tResponseSet.bFound
13792>>>>>            
13792>>>>>            //  Add responserow of exit loop
13792>>>>>            If (Found) Begin
13794>>>>>                Get AjaxCreateSnapShot (&tRequestRow) hoMainDD to tResponseSet.aRows[iRow]
13795>>>>>            End
13795>>>>>>
13795>>>>>            Else Begin
13796>>>>>                Move False to bContinue
13797>>>>>            End
13797>>>>>>
13797>>>>>    
13797>>>>>            Increment iRow
13798>>>>>        Loop
13799>>>>>>
13799>>>>>        
13799>>>>>        //  Set result info
13799>>>>>        Move tRequestSet.sTable to tResponseSet.sTable
13800>>>>>        Move tRequestSet.sName to tResponseSet.sName
13801>>>>>        Move "find" to tResponseSet.sResponseType
13802>>>>>        Move (SizeOfArray(tResponseSet.aRows)) to tResponseSet.iRows
13803>>>>>        
13803>>>>>        Function_Return tResponseSet
13804>>>>>    End_Function
13805>>>>>    
13805>>>>>    //
13805>>>>>    //  Handles requestsets of the findByRowId type. For each requestrow it 
13805>>>>>    //  performs an findbyrowid on the requesttable and generates the 
13805>>>>>    //  responseRows (If iMaxRows is higher than the requestrow Number).
13805>>>>>    //
13805>>>>>    //  Params:
13805>>>>>    //      tRequestSet  Structure with request information
13805>>>>>    //  Returns:
13805>>>>>    //      Filled TAjaxResponseSet structure
13805>>>>>    //
13805>>>>>    Function AjaxFindByRowId TAjaxRequestSet ByRef tRequestSet Returns TAjaxResponseSet
13807>>>>>        Handle hoMainDD hoRequestDD hoCurrentDD
13807>>>>>        Handle[] haSequence haDone
13809>>>>>        Integer iFile iRows iRow iCurrentDD iCurrentDDs
13809>>>>>        Boolean bChangedState bResult bAllowFind bContinue bLoaded
13809>>>>>        String sValue sFile
13809>>>>>        TAjaxSnapShot tRequestRow
13809>>>>>        TAjaxSnapShot tRequestRow
13809>>>>>        TAjaxResponseSet tResponseSet
13809>>>>>        TAjaxResponseSet tResponseSet
13809>>>>>
13809>>>>>        Move 0 to iRow
13810>>>>>
13810>>>>>        //  Check pbAllowFind
13810>>>>>        Get pbAllowFind to bAllowFind
13811>>>>>        If (not(bAllowFind)) Begin
13813>>>>>            Error 5643 "Find is not allowed"
13814>>>>>>
13814>>>>>            Function_Return tResponseSet
13815>>>>>        End
13815>>>>>>
13815>>>>>
13815>>>>>        //  Get MainDD & RequestDD
13815>>>>>        Get Main_DD to hoMainDD
13816>>>>>        If (hoMainDD = 0) Begin
13818>>>>>            Error 5631 "Main_DD not set"
13819>>>>>>
13819>>>>>            Function_Return tResponseSet
13820>>>>>        End   
13820>>>>>>
13820>>>>>        Get Search_File_Name tRequestSet.sTable to iFile       
13821>>>>>        If (iFile = 0) Begin
13823>>>>>            Error 5632 ("File not found: " + tRequestSet.sTable)
13824>>>>>>
13824>>>>>            Function_Return tResponseSet
13825>>>>>        End        
13825>>>>>>
13825>>>>>        Get Data_Set of hoMainDD iFile to hoRequestDD
13826>>>>>        If (hoRequestDD = 0) Begin
13828>>>>>            Error 5633 (SFormat("Data dictionary not found for table: %1 (%2)", tRequestSet.sTable, iFile))
13829>>>>>>
13829>>>>>            Function_Return tResponseSet
13830>>>>>        End
13830>>>>>>
13830>>>>>        
13830>>>>>        //  Loop through rows
13830>>>>>         
13830>>>>>        //  Repeat find procedure until nothing found or maximum reached
13830>>>>>        Move True to bContinue
13831>>>>>        While (iRow < tRequestSet.iMaxRows and bContinue)
13835>>>>>            //  Load current status
13835>>>>>            If (SizeOfArray(tRequestSet.aRows) > iRow) Begin
13837>>>>>                Move tRequestSet.aRows[iRow] to tRequestRow
13838>>>>>                
13838>>>>>                If (tRequestSet.bLoadStatus) Begin
13840>>>>>                    Get AjaxLoadSnapShot (&tRequestRow) hoRequestDD to bLoaded
13841>>>>>                End 
13841>>>>>>
13841>>>>>            End
13841>>>>>>
13841>>>>>            
13841>>>>>            //  Perform findByRowId
13841>>>>>            Send FindByRowId of hoRequestDD iFile (DeserializeRowID(tRequestSet.sFindValue))
13842>>>>>            
13842>>>>>            Move (Found) to tResponseSet.bFound
13843>>>>>            
13843>>>>>            //  Add responserow of exit loop
13843>>>>>            If (Found) Begin
13845>>>>>                Get AjaxCreateSnapShot (&tRequestRow) hoMainDD to tResponseSet.aRows[iRow]
13846>>>>>            End
13846>>>>>>
13846>>>>>            Else Begin
13847>>>>>                Move False to bContinue
13848>>>>>            End
13848>>>>>>
13848>>>>>    
13848>>>>>            Increment iRow
13849>>>>>        Loop
13850>>>>>>
13850>>>>>
13850>>>>>        //  Set result info
13850>>>>>        Move tRequestSet.sTable to tResponseSet.sTable
13851>>>>>        Move tRequestSet.sName to tResponseSet.sName
13852>>>>>        Move "findByRowId" to tResponseSet.sResponseType
13853>>>>>        Move (SizeOfArray(tResponseSet.aRows)) to tResponseSet.iRows
13854>>>>>        
13854>>>>>        Function_Return tResponseSet
13855>>>>>    End_Function
13856>>>>>    
13856>>>>>    //
13856>>>>>    //  Handles requestsets of the findByRowId type. For each requestrow it 
13856>>>>>    //  performs an findbyrowid on the requesttable and generates the 
13856>>>>>    //  responseRows (If iMaxRows is higher than the requestrow Number).
13856>>>>>    //
13856>>>>>    //  Params:
13856>>>>>    //      tRequestSet  Structure with request information
13856>>>>>    //  Returns:
13856>>>>>    //      Filled TAjaxResponseSet structure
13856>>>>>    //
13856>>>>>    Function AjaxInitialFill TAjaxRequestSet ByRef tRequestSet Returns TAjaxResponseSet
13858>>>>>        Handle hoMainDD
13858>>>>>        Integer iRow 
13858>>>>>        Boolean bResult bAllowFind bContinue bLoaded
13858>>>>>        String sValue sFile
13858>>>>>        TAjaxSnapShot tRequestRow
13858>>>>>        TAjaxSnapShot tRequestRow
13858>>>>>        TAjaxResponseSet tResponseSet
13858>>>>>        TAjaxResponseSet tResponseSet
13858>>>>>
13858>>>>>        Move 0 to iRow
13859>>>>>
13859>>>>>        //  Check pbAllowFind
13859>>>>>        Get pbAllowFind to bAllowFind
13860>>>>>        If (not(bAllowFind)) Begin
13862>>>>>            Error 5643 "Find is not allowed"
13863>>>>>>
13863>>>>>            Function_Return tResponseSet
13864>>>>>        End
13864>>>>>>
13864>>>>>
13864>>>>>        //  Get MainDD & RequestDD
13864>>>>>        Get Main_DD to hoMainDD
13865>>>>>        If (hoMainDD = 0) Begin
13867>>>>>            Error 5631 "Main_DD not set"
13868>>>>>>
13868>>>>>            Function_Return tResponseSet
13869>>>>>        End   
13869>>>>>>
13869>>>>>       
13869>>>>>        //  Repeat find procedure until nothing found or maximum reached
13869>>>>>        Move True to bContinue
13870>>>>>        While (iRow < tRequestSet.iMaxRows and bContinue)
13874>>>>>            //  Load current status
13874>>>>>            If (SizeOfArray(tRequestSet.aRows) > iRow) Begin
13876>>>>>                Move tRequestSet.aRows[iRow] to tRequestRow
13877>>>>>                
13877>>>>>                If (tRequestSet.bLoadStatus) Begin
13879>>>>>                    //  We first load the field values and the find the records (instead of the other way arround)
13879>>>>>                    Send Clear_All of hoMainDD
13880>>>>>                    Get AjaxLoadSnapShotValues (&tRequestRow) hoMainDD to bResult
13881>>>>>                    Send AjaxLoadSnapShotRecords (&tRequestRow) True    //  To prevent issues with the System files we use bForceFind
13882>>>>>                End 
13882>>>>>>
13882>>>>>            End
13882>>>>>>
13882>>>>>            
13882>>>>>            //  Add responserow of exit loop
13882>>>>>            Get AjaxCreateSnapShot (&tRequestRow) hoMainDD to tResponseSet.aRows[iRow]
13883>>>>>            
13883>>>>>            Increment iRow
13884>>>>>        Loop
13885>>>>>>
13885>>>>>
13885>>>>>        //  Set result info
13885>>>>>        Move "initialFill" to tResponseSet.sResponseType
13886>>>>>        Move (SizeOfArray(tResponseSet.aRows)) to tResponseSet.iRows
13887>>>>>        
13887>>>>>        Function_Return tResponseSet
13888>>>>>    End_Function
13889>>>>>    
13889>>>>>    //
13889>>>>>    //  Handles requestsets of the save type. It loads the given status row 
13889>>>>>    //  into the buffers using rowids and sets changed values. Then it fires a 
13889>>>>>    //  validate request to the data dictionary of the given main table. If 
13889>>>>>    //  there are no errors the values are saved. After the save it clears the 
13889>>>>>    //  data dictionary if link:pbClearAfterSave is true and bReturnCurrent in 
13889>>>>>    //  the requestset is false.
13889>>>>>    //
13889>>>>>    //  Validation / save errors are returned in the usual way depending on the
13889>>>>>    //  access interface used.
13889>>>>>    //
13889>>>>>    //  Params:
13889>>>>>    //      tRequestSet Reference to the TAjaxRequestSet with the request 
13889>>>>>    //                  information.
13889>>>>>    //  Returns:
13889>>>>>    //      TAjaxResponseSet struct filled with response information.
13889>>>>>    //
13889>>>>>    Function AjaxSave TAjaxRequestSet ByRef tRequestSet Returns TAjaxResponseSet
13891>>>>>        TAjaxResponseSet tResponseSet
13891>>>>>        TAjaxResponseSet tResponseSet
13891>>>>>        TAjaxSnapShot tRequestRow
13891>>>>>        TAjaxSnapShot tRequestRow
13891>>>>>        Handle hoRequestDD hoMainDD
13891>>>>>        Integer iFile iError iRow iRows
13891>>>>>        Boolean bSaveRequestTable bClearAfterSave bEdit bAllowSave bLoaded
13891>>>>>        
13891>>>>>        Get pbClearAfterSave to bClearAfterSave
13892>>>>>    
13892>>>>>        //  Get MainDD & RequestDD
13892>>>>>        Get Main_DD to hoMainDD
13893>>>>>        If (hoMainDD = 0) Begin
13895>>>>>            Error 5631 "Main_DD not set"
13896>>>>>>
13896>>>>>            Function_Return tResponseSet
13897>>>>>        End        
13897>>>>>>
13897>>>>>        
13897>>>>>        Get Search_File_Name tRequestSet.sTable to iFile  
13898>>>>>        If (iFile = 0) Begin
13900>>>>>            Error 5632 ("File not found: " + tRequestSet.sTable)
13901>>>>>>
13901>>>>>            Function_Return tResponseSet
13902>>>>>        End
13902>>>>>>
13902>>>>>        Get Data_Set of hoMainDD iFile to hoRequestDD
13903>>>>>        If (hoRequestDD = 0) Begin
13905>>>>>            Error 5633 (SFormat("Data dictionary not found for table: %1 (%2)", tRequestSet.sTable, iFile))
13906>>>>>>
13906>>>>>            Function_Return tResponseSet
13907>>>>>        End
13907>>>>>>
13907>>>>>        
13907>>>>>        //  Loop through rows
13907>>>>>        Move (SizeOfArray(tRequestSet.aRows) - 1) to iRows
13908>>>>>        For iRow from 0 to iRows
13914>>>>>>
13914>>>>>            //  Prepare variables
13914>>>>>            Move tRequestSet.aRows[iRow] to tRequestRow
13915>>>>>            
13915>>>>>            //  Fill structure
13915>>>>>            Get AjaxLoadSnapShot (&tRequestRow) hoRequestDD to bLoaded
13916>>>>>             
13916>>>>>            If (bLoaded) Begin   
13918>>>>>                //  Check if save is allowed using bAllowSaveEdit and bAllowSaveDelete
13918>>>>>                Get HasRecord of hoRequestDD to bEdit
13919>>>>>                If (bEdit) Begin
13921>>>>>                    Get pbAllowSaveEdit to bAllowSave
13922>>>>>                End
13922>>>>>>
13922>>>>>                Else Begin
13923>>>>>                    Get pbAllowSaveNew to bAllowSave
13924>>>>>                End
13924>>>>>>
13924>>>>>                If (not(bAllowSave)) Begin
13926>>>>>                    Error 5643 "Save not allowed"
13927>>>>>>
13927>>>>>                    Function_Return tResponseSet
13928>>>>>                End
13928>>>>>>
13928>>>>>                
13928>>>>>                //  Try to save
13928>>>>>                Get Request_Validate of hoRequestDD to iError
13929>>>>>                If (iError = 0) Begin
13931>>>>>                    Send Request_Save of hoRequestDD
13932>>>>>            
13932>>>>>                    //  If pbClearAfterSave is true and bReturnCurrent is false then clear after the save
13932>>>>>                    If (bClearAfterSave and not(tRequestSet.bReturnCurrent)) Send Clear of hoRequestDD
13935>>>>>                End
13935>>>>>>
13935>>>>>            
13935>>>>>                //  Create result response
13935>>>>>                Get AjaxCreateSnapShot (&tRequestRow) hoMainDD to tResponseSet.aRows[iRow]
13936>>>>>            End 
13936>>>>>>
13936>>>>>            Else Begin
13937>>>>>                Error 5645 "Failed to load status, record might be deleted!"
13938>>>>>>
13938>>>>>            End
13938>>>>>>
13938>>>>>        Loop
13939>>>>>>
13939>>>>>    
13939>>>>>        //  Set result info
13939>>>>>        Move tRequestSet.sTable to tResponseSet.sTable
13940>>>>>        Move tRequestSet.sName to tResponseSet.sName
13941>>>>>        Move "save" to tResponseSet.sResponseType
13942>>>>>        Move (SizeOfArray(tResponseSet.aRows)) to tResponseSet.iRows
13943>>>>>    
13943>>>>>        Function_Return tResponseSet
13944>>>>>    End_Function
13945>>>>>    
13945>>>>>    //
13945>>>>>    //  Sends clear to the data dictionary of the given maintable and generates
13945>>>>>    //  and adds the current values to the response.    
13945>>>>>    //
13945>>>>>    //  Params:
13945>>>>>    //      tRequestSet  Reference to the TAjaxRequestSet with the request 
13945>>>>>    //                  information.
13945>>>>>    //  Returns:
13945>>>>>    //      TAjaxResponseSet struct filled with response information.
13945>>>>>    //
13945>>>>>    Function AjaxClear TAjaxRequestSet ByRef tRequestSet Returns TAjaxResponseSet
13947>>>>>        TAjaxResponseSet tResponseSet
13947>>>>>        TAjaxResponseSet tResponseSet
13947>>>>>        TAjaxSnapShot tRequestRow
13947>>>>>        TAjaxSnapShot tRequestRow
13947>>>>>        Handle hoRequestDD hoMainDD
13947>>>>>        Integer iFile iRow iRows
13947>>>>>        Boolean bAllowClear bLoaded
13947>>>>>        
13947>>>>>        //  Check pbAllowClear
13947>>>>>        Get pbAllowClear to bAllowClear
13948>>>>>        If (not(bAllowClear)) Begin
13950>>>>>            Error 5643 "Clear is not allowed"
13951>>>>>>
13951>>>>>            Function_Return tResponseSet
13952>>>>>        End
13952>>>>>>
13952>>>>>            
13952>>>>>        //  Get MainDD & RequestDD
13952>>>>>        Get Main_DD to hoMainDD
13953>>>>>        If (hoMainDD = 0) Begin
13955>>>>>            Error 5631 "Main_DD not set"
13956>>>>>>
13956>>>>>            Function_Return tResponseSet
13957>>>>>        End        
13957>>>>>>
13957>>>>>        Get Search_File_Name tRequestSet.sTable to iFile  
13958>>>>>        If (iFile = 0) Begin
13960>>>>>            Error 5632 ("File not found: " + tRequestSet.sTable)
13961>>>>>>
13961>>>>>            Function_Return tResponseSet
13962>>>>>        End        
13962>>>>>>
13962>>>>>        Get Data_Set of hoMainDD iFile to hoRequestDD
13963>>>>>        If (hoRequestDD = 0) Begin
13965>>>>>            Error 5633 (SFormat("Data dictionary not found for table: %1 (%2)", tRequestSet.sTable, iFile))
13966>>>>>>
13966>>>>>            Function_Return tResponseSet
13967>>>>>        End
13967>>>>>>
13967>>>>>        
13967>>>>>        //  Loop through rows
13967>>>>>        Move (SizeOfArray(tRequestSet.aRows) - 1) to iRows
13968>>>>>        For iRow from 0 to iRows
13974>>>>>>
13974>>>>>            //  Prepare variables
13974>>>>>            Move tRequestSet.aRows[iRow] to tRequestRow
13975>>>>>        
13975>>>>>            //  Fill structure
13975>>>>>            Get AjaxLoadSnapShot (&tRequestRow) hoRequestDD to bLoaded
13976>>>>>            
13976>>>>>            //  Do clear
13976>>>>>            Send Clear of hoRequestDD
13977>>>>>        
13977>>>>>            //  Fetch tResponse row
13977>>>>>            Get AjaxCreateSnapShot (&tRequestRow) hoMainDD to tResponseSet.aRows[iRow]
13978>>>>>        Loop
13979>>>>>>
13979>>>>>    
13979>>>>>        //  Set result info
13979>>>>>        Move tRequestSet.sTable to tResponseSet.sTable
13980>>>>>        Move tRequestSet.sName to tResponseSet.sName
13981>>>>>        Move "clear" to tResponseSet.sResponseType
13982>>>>>        Move (SizeOfArray(tResponseSet.aRows)) to tResponseSet.iRows
13983>>>>>    
13983>>>>>        Function_Return tResponseSet
13984>>>>>    End_Function
13985>>>>>    
13985>>>>>    //
13985>>>>>    //  Sends clear_all to the data dictionary of the given maintable and 
13985>>>>>    //  generates and adds the current values to the response.    
13985>>>>>    //
13985>>>>>    //  Params:
13985>>>>>    //      tRequestSet  Reference to the TAjaxRequestSet with the request 
13985>>>>>    //                  information.
13985>>>>>    //  Returns:
13985>>>>>    //      TAjaxResponseSet struct filled with response information.
13985>>>>>    //
13985>>>>>    Function AjaxClearAll TAjaxRequestSet ByRef tRequestSet Returns TAjaxResponseSet
13987>>>>>        TAjaxResponseSet tResponseSet
13987>>>>>        TAjaxResponseSet tResponseSet
13987>>>>>        TAjaxSnapShot tRequestRow
13987>>>>>        TAjaxSnapShot tRequestRow
13987>>>>>        Handle hoRequestDD hoMainDD
13987>>>>>        Integer iFile iRow iRows
13987>>>>>        Boolean bAllowClear bLoaded
13987>>>>>        
13987>>>>>        //  Check pbAllowClear
13987>>>>>        Get pbAllowClear to bAllowClear
13988>>>>>        If (not(bAllowClear)) Begin
13990>>>>>            Error 5643 "Clear is not allowed"
13991>>>>>>
13991>>>>>            Function_Return tResponseSet
13992>>>>>        End
13992>>>>>>
13992>>>>>            
13992>>>>>        //  Get MainDD & RequestDD
13992>>>>>        Get Main_DD to hoMainDD
13993>>>>>        If (hoMainDD = 0) Begin
13995>>>>>            Error 5631 "Main_DD not set"
13996>>>>>>
13996>>>>>            Function_Return tResponseSet
13997>>>>>        End        
13997>>>>>>
13997>>>>>        Get Search_File_Name tRequestSet.sTable to iFile  
13998>>>>>        If (iFile = 0) Begin
14000>>>>>            Error 5632 ("File not found: " + tRequestSet.sTable)
14001>>>>>>
14001>>>>>            Function_Return tResponseSet
14002>>>>>        End        
14002>>>>>>
14002>>>>>        Get Data_Set of hoMainDD iFile to hoRequestDD
14003>>>>>        If (hoRequestDD = 0) Begin
14005>>>>>            Error 5633 (SFormat("Data dictionary not found for table: %1 (%2)", tRequestSet.sTable, iFile))
14006>>>>>>
14006>>>>>            Function_Return tResponseSet
14007>>>>>        End
14007>>>>>>
14007>>>>>        
14007>>>>>        //  Loop through rows
14007>>>>>        Move (SizeOfArray(tRequestSet.aRows) - 1) to iRows
14008>>>>>        for iRow from 0 to iRows
14014>>>>>>
14014>>>>>            //  Prepare variables
14014>>>>>            Move tRequestSet.aRows[iRow] to tRequestRow
14015>>>>>        
14015>>>>>            //  Fill structure
14015>>>>>            Get AjaxLoadSnapShot (&tRequestRow) hoRequestDD to bLoaded
14016>>>>>            
14016>>>>>            //  Do clear
14016>>>>>            Send Clear_All of hoRequestDD
14017>>>>>        
14017>>>>>            //  Fetch tResponse row
14017>>>>>            Get AjaxCreateSnapShot (&tRequestRow) hoMainDD to tResponseSet.aRows[iRow]
14018>>>>>        Loop
14019>>>>>>
14019>>>>>    
14019>>>>>        //  Set result info
14019>>>>>        Move tRequestSet.sTable to tResponseSet.sTable
14020>>>>>        Move tRequestSet.sName to tResponseSet.sName
14021>>>>>        Move "clear" to tResponseSet.sResponseType
14022>>>>>        Move (SizeOfArray(tResponseSet.aRows)) to tResponseSet.iRows
14023>>>>>    
14023>>>>>        Function_Return tResponseSet
14024>>>>>    End_Function
14025>>>>>    
14025>>>>>    //  
14025>>>>>    //  Loads the given rowstatus and tries to delete the record in the 
14025>>>>>    //  requestbuffer.
14025>>>>>    //
14025>>>>>    //  Params:
14025>>>>>    //      tRequestSet  Reference to the TAjaxRequestSet with the request 
14025>>>>>    //                  information.
14025>>>>>    //  Returns:
14025>>>>>    //      TAjaxResponseSet struct filled with response information.
14025>>>>>    //
14025>>>>>    Function AjaxDelete TAjaxRequestSet ByRef tRequestSet Returns TAjaxResponseSet
14027>>>>>        TAjaxResponseSet tResponseSet
14027>>>>>        TAjaxResponseSet tResponseSet
14027>>>>>        Handle hoRequestDD hoMainDD
14027>>>>>        Integer iError iFile
14027>>>>>        Boolean bAllowDelete bLoaded
14027>>>>>        
14027>>>>>        //  Check pbAllowDelete
14027>>>>>        Get pbAllowDelete to bAllowDelete
14028>>>>>        If (not(bAllowDelete)) Begin
14030>>>>>            Error 5643 "Delete is not allowed"
14031>>>>>>
14031>>>>>            Function_Return tResponseSet
14032>>>>>        End
14032>>>>>>
14032>>>>>            
14032>>>>>        //  Get MainDD & RequestDD
14032>>>>>        Get Main_DD to hoMainDD
14033>>>>>        If (hoMainDD = 0) Begin
14035>>>>>            Error 5631 "Main_DD not set"
14036>>>>>>
14036>>>>>            Function_Return tResponseSet
14037>>>>>        End        
14037>>>>>>
14037>>>>>        Get Search_File_Name tRequestSet.sTable to iFile  
14038>>>>>        If (iFile = 0) Begin
14040>>>>>            Error 5632 ("File not found: " + tRequestSet.sTable)
14041>>>>>>
14041>>>>>            Function_Return tResponseSet
14042>>>>>        End        
14042>>>>>>
14042>>>>>        Get Data_Set of hoMainDD iFile to hoRequestDD
14043>>>>>        If (hoRequestDD = 0) Begin
14045>>>>>            Error 5633 (SFormat("Data dictionary not found for table: %1 (%2)", tRequestSet.sTable, iFile))
14046>>>>>>
14046>>>>>            Function_Return tResponseSet
14047>>>>>        End
14047>>>>>>
14047>>>>>        
14047>>>>>        //  Fill structure
14047>>>>>        Get AjaxLoadSnapShot (&tRequestSet.aRows[0]) hoRequestDD to bLoaded
14048>>>>>        If (bLoaded) Begin
14050>>>>>        
14050>>>>>            //  Do delete
14050>>>>>            Get Validate_Delete of hoRequestDD to iError
14051>>>>>        
14051>>>>>            If (iError = 0) Begin
14053>>>>>                Send Request_Delete to hoRequestDD
14054>>>>>                Send Clear of hoRequestDD
14055>>>>>            End
14055>>>>>>
14055>>>>>        
14055>>>>>            //  Generate response
14055>>>>>            Get AjaxCreateSnapShot tRequestSet.aRows[0] hoMainDD to tResponseSet.aRows[0] // Add resultrow
14056>>>>>        End
14056>>>>>>
14056>>>>>        Else Begin
14057>>>>>            Error 5645 "Failed to load status, record might be deleted!"
14058>>>>>>
14058>>>>>        End
14058>>>>>>
14058>>>>>        
14058>>>>>        //  Set result info
14058>>>>>        Move tRequestSet.sTable to tResponseSet.sTable
14059>>>>>        Move tRequestSet.sName to tResponseSet.sName
14060>>>>>        Move "delete" to tResponseSet.sResponseType
14061>>>>>        Move (SizeOfArray(tResponseSet.aRows)) to tResponseSet.iRows
14062>>>>>    
14062>>>>>        Function_Return tResponseSet
14063>>>>>    End_Function    
14064>>>>>    
14064>>>>>    //
14064>>>>>    //  This method performs the DbCall action. The DbCall action is method invocation with buffer 
14064>>>>>    //  synchronization. Like the other actions a snapshot of the clients buffer state is loaded 
14064>>>>>    //  into the buffer and after the custom method has been called a new snapshot will be made 
14064>>>>>    //  that is sent back to the client.
14064>>>>>    //
14064>>>>>    //  Params:
14064>>>>>    //      tRequestSet  Structure with request information
14064>>>>>    //  Returns:
14064>>>>>    //      Filled TAjaxResponseSet structure
14064>>>>>    //
14064>>>>>    Function AjaxDbCall Handle hoWSO TAjaxRequestSet ByRef tRequestSet Returns TAjaxResponseSet
14066>>>>>        TAjaxResponseSet tResponseSet
14066>>>>>        TAjaxResponseSet tResponseSet
14066>>>>>        Handle hoRequestDD hoMainDD
14066>>>>>        Integer iError iFile
14066>>>>>        Boolean bAllowDelete bLoaded
14066>>>>>        
14066>>>>>        //  Get MainDD
14066>>>>>        Get Main_DD to hoMainDD
14067>>>>>
14067>>>>>        //  Fill structure
14067>>>>>        Get AjaxLoadSnapShot (&tRequestSet.aRows[0]) hoMainDD to bLoaded
14068>>>>>        If (bLoaded) Begin
14070>>>>>        
14070>>>>>            //  Call method (we use the method of the web service object that's also used by the VdfCall
14070>>>>>            Get CallMethod of hoWSO (Self) tRequestSet.sMethod tRequestSet.asParams to tResponseSet.sReturnValue
14071>>>>>        
14071>>>>>            //  Generate response
14071>>>>>            Get AjaxCreateSnapShot tRequestSet.aRows[0] hoMainDD to tResponseSet.aRows[0] // Add resultrow
14072>>>>>        End
14072>>>>>>
14072>>>>>        Else Begin
14073>>>>>            Error 5645 "Failed to load status, record might be deleted!"
14074>>>>>>
14074>>>>>        End
14074>>>>>>
14074>>>>>        
14074>>>>>        //  Set result info
14074>>>>>        Move tRequestSet.sTable to tResponseSet.sTable
14075>>>>>        Move tRequestSet.sName to tResponseSet.sName
14076>>>>>        Move "dbcall" to tResponseSet.sResponseType
14077>>>>>        Move (SizeOfArray(tResponseSet.aRows)) to tResponseSet.iRows
14078>>>>>    
14078>>>>>        Function_Return tResponseSet
14079>>>>>        
14079>>>>>    End_Function
14080>>>>>
14080>>>>>    //  
14080>>>>>    //  This is a recursive method that moves through the DDO structure to refind the records using
14080>>>>>    //  their RowID. The RowID has been Set to the Find_RowId. If a DDO already contains the 
14080>>>>>    //  correct record (Found using a Relate) it won't perform an extra Find.
14080>>>>>    //
14080>>>>>    //  Params:
14080>>>>>    //      hoDD        Handle to the current DDO object.
14080>>>>>    //      bForceFind  If true a find will be performed on each DD.
14080>>>>>    //
14080>>>>>    Procedure AjaxLoadSnapShotRecord Handle hoDD Boolean bForceFind
14082>>>>>        Integer hPrnt
14082>>>>>        Integer iMax
14082>>>>>        Integer iCount
14082>>>>>        RowID riRec
14082>>>>>        Integer iRec iMain
14082>>>>>        
14082>>>>>        //  Set visited state before moving down
14082>>>>>        Set Visited_State of hoDD to True
14083>>>>>        
14083>>>>>        // find(clear) record, if needed
14083>>>>>        Get Main_File of hoDD to iMain
14084>>>>>        Get Find_RowId of hoDD to riRec
14085>>>>>        If not (IsNullRowId(riRec)) Begin
14087>>>>>            If (not (IsSameRowId(riRec, CurrentRowId(hoDD) ) ) or bForceFind) Begin
14089>>>>>                Send FindByRowId of hoDD iMain riRec // find an Relate all parents
14090>>>>>            End
14090>>>>>>
14090>>>>>            Set Find_rowid of hoDD to (NullRowId())  // reset refind rec back to zero.
14091>>>>>        End
14091>>>>>>
14091>>>>>        
14091>>>>>        
14091>>>>>        
14091>>>>>        // Recurse down the DDO structure first before bubbling up since AJAX 
14091>>>>>        // apps will have DDO's below the main dd. In most cases if this is so 
14091>>>>>        // the Find on this DD will probably not be nessecary any more.        
14091>>>>>        Get Data_Set_Client_Count of hoDD to iMax
14092>>>>>        Decrement iMax
14093>>>>>        for iCount from 0 to iMax
14099>>>>>>
14099>>>>>            Get Data_Set_Client of hoDD iCount to hPrnt
14100>>>>>            If not (Visited_state(hPrnt)) ;                Send AjaxLoadSnapShotRecord hPrnt bForceFind
14103>>>>>        Loop
14104>>>>>>
14104>>>>>        
14104>>>>>        
14104>>>>>
14104>>>>>        // recurse and do the same to all parent files
14104>>>>>        // in almost all cases, there will be no new finding here since the relate has
14104>>>>>        // found the records. If the record is different than the relate, we have
14104>>>>>        // a switched parent state (should_save will be set appropriately).
14104>>>>>        Get Data_Set_Server_Count of hoDD to iMax
14105>>>>>        Decrement iMax
14106>>>>>        for iCount from 0 to iMax
14112>>>>>>
14112>>>>>            Get Data_Set_Server of hoDD iCount to hPrnt
14113>>>>>            If not (Visited_state(hPrnt)) ;                Send AjaxLoadSnapShotRecord hPrnt bForceFind
14116>>>>>        Loop
14117>>>>>>
14117>>>>>    End_Procedure
14118>>>>>    
14118>>>>>    //
14118>>>>>    //  This method will load all records of the given snapshot back into the buffer. It will go 
14118>>>>>    //  through the provided snapshot and place all RowID's in the "Find_RowId" Property of the 
14118>>>>>    //  DDO. Then it will call the AjaxLoadSnapShotRecord method that will go through the DDO 
14118>>>>>    //  structure and perform findByRowId's on the buffers when needed. If the bForceFind is True 
14118>>>>>    //  finds will be performed on all buffers (even If they are not needed).
14118>>>>>    //
14118>>>>>    //  Params:
14118>>>>>    //      tSnapShot   Structure containing the snapshot to load.
14118>>>>>    //      bForceFind  If true finds will be performed on all buffers (not just when needed) which
14118>>>>>    //                  is used by the AjaxInitialFill method.
14118>>>>>    //
14118>>>>>    Procedure AjaxLoadSnapShotRecords TAjaxSnapShot ByRef tSnapShot Boolean bForceFind
14120>>>>>        Integer iDDs iDD iFile
14120>>>>>        TAjaxDD tDD
14120>>>>>        TAjaxDD tDD
14120>>>>>        Handle hoMainDD hoDD
14120>>>>>    
14120>>>>>        Get Main_DD to hoMainDD
14121>>>>>        
14121>>>>>        // Clear visited state up and down, do not clear fields
14121>>>>>        Send Initialize_Visited of hoMainDD True False 
14122>>>>>        
14122>>>>>        //  Move through the DD structs and place the rowid's in the DD's       
14122>>>>>        Move (SizeOfArray(tSnapShot.aDDs) - 1) to iDDs
14123>>>>>        For iDD from 0 to iDDs
14129>>>>>>
14129>>>>>            Move tSnapShot.aDDs[iDD] to tDD
14130>>>>>            If (tDD.sName <> "") Begin
14132>>>>>            
14132>>>>>                Get Search_File_Name tDD.sName to iFile
14133>>>>>            
14133>>>>>                If (iFile > 0) Begin
14135>>>>>                    Get Data_Set of hoMainDD iFile to hoDD
14136>>>>>                    
14136>>>>>                    If (hoDD > 0) Begin
14138>>>>>                        Set Find_RowId of hoDD to (DeserializeRowID(tDD.tStatus.sValue))
14139>>>>>                    End
14139>>>>>>
14139>>>>>                End
14139>>>>>>
14139>>>>>            End            
14139>>>>>>
14139>>>>>        Loop
14140>>>>>>
14140>>>>>        
14140>>>>>        //  Move through the DD's and perform the find's
14140>>>>>        Send AjaxLoadSnapShotRecord hoMainDD bForceFind
14141>>>>>    End_Procedure
14142>>>>>    
14142>>>>>    //
14142>>>>>    //  This method will load all the changed values of the snapshot into the buffer. It will set 
14142>>>>>    //  the Field_Changed_Value for the Field values that are marked as changed or when the Field
14142>>>>>    //  had DD_ForcePut Set to True. for fields that are part of the hoActionDD the 
14142>>>>>    //  Field_Current_Value is always Set to the value of the snapshot.
14142>>>>>    //
14142>>>>>    //  Params:
14142>>>>>    //      tSnapShot   Structure containing the snapshot to load.
14142>>>>>    //      hoActionDD  Handle to the 'action' DDO.
14142>>>>>    //  Returns:
14142>>>>>    //      False if something went wrong.
14142>>>>>    //
14142>>>>>    Function AjaxLoadSnapShotValues  TAjaxSnapShot ByRef tSnapShot Handle hoActionDD Returns Boolean
14144>>>>>        Integer iDDs iDD iFile iField iCurrentField iNumFields iOptions 
14144>>>>>        String sField
14144>>>>>        TAjaxDD tDD
14144>>>>>        TAjaxDD tDD
14144>>>>>        TAjaxField tField
14144>>>>>        TAjaxField tField
14144>>>>>        Boolean bResult
14144>>>>>        Handle hoMainDD hoDD
14144>>>>>        
14144>>>>>        Get Main_DD to hoMainDD
14145>>>>>        Move True to bResult
14146>>>>>        
14146>>>>>        //  Move through the supplied DD snapshots and set the field values
14146>>>>>        Move (SizeOfArray(tSnapShot.aDDs) -1) to iDDs
14147>>>>>        For iDD from 0 to iDDs
14153>>>>>>
14153>>>>>            Move tSnapShot.aDDs[iDD] to tDD
14154>>>>>        
14154>>>>>            Get Search_File_Name tDD.sName to iFile
14155>>>>>            
14155>>>>>            If (iFile > 0) Begin
14157>>>>>                Get Data_Set of hoMainDD iFile to hoDD
14158>>>>>                If (hoDD > 0) Begin
14160>>>>>                                    
14160>>>>>                    //  If found load the field values
14160>>>>>                    If (not(tDD.bLight)) Begin
14162>>>>>                        Move (SizeOfArray(tDD.aFields) - 1) to iNumFields
14163>>>>>                        For iCurrentField from 0 to iNumFields
14169>>>>>>
14169>>>>>                            Move tDD.aFields[iCurrentField] to tField
14170>>>>>                            
14170>>>>>                            If (tField.sType = "D") Begin
14172>>>>>                                Move (mid(tField.sBinding, length(tField.sBinding),(pos(".", tField.sBinding) + 1))) to sField
14173>>>>>                                
14173>>>>>                                Get FieldMap iFile sField to iField
14174>>>>>                                If (iField <> -1) Begin
14176>>>>>                                    
14176>>>>>                                    
14176>>>>>                                    //  Get the field options to determine forceput
14176>>>>>                                    Get Field_Options of hoDD iField to iOptions
14177>>>>>                                    
14177>>>>>                                    //  Only load changes if forceput or changedstate
14177>>>>>                                    If ((tField.bChanged) or (iOptions iand DD_ForcePut = DD_ForcePut)) Begin
14179>>>>>                                        Set Field_Changed_Value of hoDD iField to tField.sValue
14180>>>>>                                    End
14180>>>>>>
14180>>>>>                                    Else If (hoDD = hoActionDD or tField.bChanged) Begin
14183>>>>>                                        //  Set the field value to the buffer (important for find actions to 
14183>>>>>                                        //  fill the Index fields). We only do this for action DD or changed 
14183>>>>>                                        //  fieldsso we don't 'override' record values (for fill requests 
14183>>>>>                                        //  and such)
14183>>>>>                                        Set Field_Current_Value of hoDD iField to tField.sValue
14184>>>>>                                    End
14184>>>>>>
14184>>>>>                                    
14184>>>>>                                End
14184>>>>>>
14184>>>>>                                Else Begin
14185>>>>>                                    Error 5641 ("Field not found: " * sField)
14186>>>>>>
14186>>>>>                                    Move False to bResult
14187>>>>>                                End
14187>>>>>>
14187>>>>>                            End
14187>>>>>>
14187>>>>>                        Loop
14188>>>>>>
14188>>>>>                        
14188>>>>>                    End
14188>>>>>>
14188>>>>>                End
14188>>>>>>
14188>>>>>                Else Begin
14189>>>>>                    Error 5633 (SFormat("Data dictionary not found for table: %1 (%2)", tDD.sName, iFile))
14190>>>>>>
14190>>>>>                    Move False to bResult
14191>>>>>                End
14191>>>>>>
14191>>>>>            End 
14191>>>>>>
14191>>>>>            Else Begin
14192>>>>>                Error 5632 ("File not found: " + tDD.sName)
14193>>>>>>
14193>>>>>                Move False to bResult
14194>>>>>            End
14194>>>>>>
14194>>>>>        Loop
14195>>>>>>
14195>>>>>        
14195>>>>>        Function_Return bResult
14196>>>>>    End_Function
14197>>>>>    
14197>>>>>    //
14197>>>>>    //  This method loads the provided snapshot back into the buffer. For this it will clear the 
14197>>>>>    //  buffers, then refind all the records (when needed) using their RowID's and then it will 
14197>>>>>    //  load all the changed values into the local buffers. The Field_Changed_Value will be Set 
14197>>>>>    //  when needed.
14197>>>>>    //
14197>>>>>    //  Params:
14197>>>>>    //      tSnapShot   Structure containing the snapshot to load.
14197>>>>>    //      hoActionDD  Handle to the 'action' DDO, for this DDO all values will be set using 
14197>>>>>    //                  Field_Current_Value.
14197>>>>>    //  Returns:
14197>>>>>    //      False if something went wrong.
14197>>>>>    //
14197>>>>>    Function AjaxLoadSnapShot TAjaxSnapShot ByRef tSnapShot Handle hoActionDD Returns Boolean
14199>>>>>        Boolean bResult
14199>>>>>        
14199>>>>>        Send Clear_All of hoActionDD
14200>>>>>        
14200>>>>>        Send AjaxLoadSnapShotRecords (&tSnapShot) False
14201>>>>>        Get AjaxLoadSnapShotValues (&tSnapShot) hoActionDD to bResult
14202>>>>>        
14202>>>>>        Function_Return bResult
14203>>>>>    End_Function   
14204>>>>>
14204>>>>>    //
14204>>>>>    //  Creates a snapshot based on the given snapshot.
14204>>>>>    //  
14204>>>>>    //  Params:
14204>>>>>    //      tSnapShot   Snapshot structure used as a blueprint.
14204>>>>>    //      hoStartDD   Handle to the datadictionary to start with
14204>>>>>    //  Returns:
14204>>>>>    //      The refilled snapshot.
14204>>>>>    //  
14204>>>>>    Function AjaxCreateSnapShot TAjaxSnapShot ByRef tSnapShot Handle hoStartDD Returns TAjaxSnapShot
14206>>>>>        Integer iDDs iDD iFile iNumFields iCurrentField iField
14206>>>>>        Handle hoDD
14206>>>>>        RowID riRowID
14206>>>>>        TAjaxSnapShot tResult
14206>>>>>        TAjaxSnapShot tResult
14206>>>>>        
14206>>>>>        Move tSnapShot to tResult
14207>>>>>        
14207>>>>>        
14207>>>>>        
14207>>>>>        If (SizeOfArray(tResult.aDDs) > 0) Begin
14209>>>>>            Move (SizeOfArray(tResult.aDDs) - 1) to iDDs    
14210>>>>>        
14210>>>>>            for iDD from 0 to iDDs
14216>>>>>>
14216>>>>>           
14216>>>>>                Get Search_File_Name tResult.aDDs[iDD].sName to iFile
14217>>>>>                If (iFile > 0) Begin
14219>>>>>            
14219>>>>>                    Get Data_Set of hoStartDD iFile to hoDD
14220>>>>>                    If (hoDD > 0) Begin
14222>>>>>            
14222>>>>>                        //  Append rowid
14222>>>>>                        Get CurrentRowId of hoDD to riRowID
14223>>>>>                        Move (SerializeRowId(riRowID)) to tResult.aDDs[iDD].tStatus.sValue
14224>>>>>                    
14224>>>>>                        Move (SizeOfArray(tResult.aDDs[iDD].aFields) - 1) to iNumFields
14225>>>>>                        for iCurrentField from 0 to iNumFields
14231>>>>>>
14231>>>>>                            
14231>>>>>                            //If (tResult.aDDs[iDD].aFields[iCurrentField].sType = "D") Begin
14231>>>>>                                Send AjaxSnapField (&tResult.aDDs[iDD].aFields[iCurrentField]) hoDD iFile                        
14232>>>>>                            
14232>>>>>                            //End
14232>>>>>                        Loop
14233>>>>>>
14233>>>>>                    End
14233>>>>>>
14233>>>>>                    Else Begin
14234>>>>>                        Error 5633 (SFormat("Data dictionary not found for table: %1 (%2)", tResult.aDDs[iDD].sName, iFile))
14235>>>>>>
14235>>>>>                    End
14235>>>>>>
14235>>>>>                End 
14235>>>>>>
14235>>>>>                Else Begin
14236>>>>>                
14236>>>>>                    Error 5632 ("File not found: " + tResult.aDDs[iDD].sName)
14237>>>>>>
14237>>>>>                End
14237>>>>>>
14237>>>>>            End
14238>>>>>>
14238>>>>>        End
14238>>>>>>
14238>>>>>        
14238>>>>>        Function_Return tResult
14239>>>>>    End_Function
14240>>>>>    
14240>>>>>    //
14240>>>>>    //  Updates the given field structure with the current value of the DD 
14240>>>>>    //  buffer.
14240>>>>>    //
14240>>>>>    //  Params:
14240>>>>>    //      tField  Field structure to which the snapshot is made
14240>>>>>    //      hoDD    Handle to the data dictionary
14240>>>>>    //      iFile   File number
14240>>>>>    //
14240>>>>>    Procedure AjaxSnapField TAjaxField ByRef tField Handle hoDD Integer iFile
14242>>>>>        Integer iField iType iPrecision iDecimalSeparatorChar iAdd iCount iMessageItem iMessageId iParamCount
14242>>>>>        String sField sDecimalSeparator sValue sSearchMSG sMSGName
14242>>>>>        
14242>>>>>        
14242>>>>>        If (tField.sType = "D") Begin
14244>>>>>            Move (mid(tField.sBinding, length(tField.sBinding),(pos(".", tField.sBinding) + 1))) to sField
14245>>>>>                            
14245>>>>>            Get FieldMap iFile sField to iField
14246>>>>>            If (iField <> -1) Begin
14248>>>>>                Get Field_Current_Value of hoDD iField to sValue
14249>>>>>                Move (Trim(sValue)) to sValue 
14250>>>>>                
14250>>>>>                 //  Switch for field type
14250>>>>>                Get_Attribute DF_FIELD_TYPE of iFile iField to iType
14253>>>>>                If (iType = DF_BCD) Begin
14255>>>>>                    //  Add separator and zero's if nececary
14255>>>>>                    Get_Attribute DF_FIELD_PRECISION of iFile iField to iPrecision
14258>>>>>                    If (iPrecision > 0) Begin
14260>>>>>            
14260>>>>>            
14260>>>>>                        Get_Attribute DF_DECIMAL_SEPARATOR to iDecimalSeparatorChar
14263>>>>>                        Move (Character(iDecimalSeparatorChar)) to sDecimalSeparator
14264>>>>>                        If (pos(sDecimalSeparator, sValue)) Begin
14266>>>>>                            Move (iPrecision - (length(sValue) - pos(sDecimalSeparator, sValue))) to iAdd
14267>>>>>                        End
14267>>>>>>
14267>>>>>                        Else Begin
14268>>>>>                            Move (sValue + sDecimalSeparator) to sValue
14269>>>>>                            Move iPrecision to iAdd
14270>>>>>                        End
14270>>>>>>
14270>>>>>                        While (iAdd > 0)
14274>>>>>                            Move (sValue + "0") to sValue
14275>>>>>                            Decrement iAdd
14276>>>>>                        Loop
14277>>>>>>
14277>>>>>                    End
14277>>>>>>
14277>>>>>                End
14277>>>>>>
14277>>>>>                
14277>>>>>                Move sValue to tField.sValue
14278>>>>>
14278>>>>>                 //  Field changed value
14278>>>>>                Get File_Field_Changed_State of hoDD iFile iField to tField.bChanged
14279>>>>>            End
14279>>>>>>
14279>>>>>            Else Begin
14280>>>>>                Error 5641 ("Field not found: " * sField)
14281>>>>>>
14281>>>>>            End
14281>>>>>>
14281>>>>>        End
14281>>>>>>
14281>>>>>        Else If (tField.sType = "E") Begin
14284>>>>>            // Evaluate expression
14284>>>>>            
14284>>>>>            Move 0 to iMessageId
14285>>>>>            If (Uppercase(Left(tField.sBinding, 4)) = "GET_") Begin
14287>>>>>                Move (Uppercase(tField.sBinding)) to sSearchMSG
14288>>>>>            End
14288>>>>>>
14288>>>>>            Else Begin
14289>>>>>                Move (Uppercase("GET_" + tField.sBinding)) to sSearchMSG
14290>>>>>            End
14290>>>>>>
14290>>>>>            
14290>>>>>            //  Find the message and get the message id and the number of parameters
14290>>>>>            Get InterfaceMessageCount of Self to iCount
14291>>>>>            
14291>>>>>            Move 0 to iMessageItem 
14292>>>>>            While (iMessageItem < iCount and iMessageId = 0)
14296>>>>>                Get InterfaceMessageName of Self iMessageItem to sMSGName
14297>>>>>                
14297>>>>>                If (UpperCase(sMSGName) = sSearchMSG) Begin
14299>>>>>                    Get InterfaceMessageId of Self iMessageItem to iMessageId
14300>>>>>                    Get InterfaceMessageParamCount of Self iMessageItem to iParamCount
14301>>>>>                End
14301>>>>>>
14301>>>>>                
14301>>>>>                Increment iMessageItem
14302>>>>>            Loop
14303>>>>>>
14303>>>>>            
14303>>>>>            If (iMessageId <> 0) Begin
14305>>>>>                If (iParamCount > 0) Begin
14307>>>>>                    Get iMessageId tField to tField.sValue
14308>>>>>                End
14308>>>>>>
14308>>>>>                Else Begin
14309>>>>>                    Get iMessageId to tField.sValue
14310>>>>>                End
14310>>>>>>
14310>>>>>            End
14310>>>>>>
14310>>>>>            Else Begin
14311>>>>>                Error 5642 ("Expression function '" + sSearchMSG + "' not found.")
14312>>>>>>
14312>>>>>            End 
14312>>>>>>
14312>>>>>        End
14312>>>>>>
14312>>>>>    End_Procedure
14313>>>>>
14313>>>>>    //
14313>>>>>    //  Recursive method that checks if the datadictionary is a parent of the 
14313>>>>>    //  other. It is used to determine wether a table is foreign. This check 
14313>>>>>    //  should be performed from the DD that is the server of the entry item.
14313>>>>>    //
14313>>>>>    //  Params:
14313>>>>>    //      hoCurrentDD Datadictionary to start
14313>>>>>    //      hoSearchDD  Datadictionary to search
14313>>>>>    //      haDone      Array with handles to prevent recursive looping
14313>>>>>    //  Returns:
14313>>>>>    //      True if the searched DD is an parent
14313>>>>>    //
14313>>>>>    //  DEPRECATED
14313>>>>>    Function AjaxIsForeign Handle hoCurrentDD Handle hoSearchDD Handle[] ByRef haDone Returns Boolean
14315>>>>>        Integer iCount iCounter
14315>>>>>        Handle hoNextDD
14315>>>>>        Boolean bResult
14315>>>>>        
14315>>>>>        Move False to bResult
14316>>>>>        
14316>>>>>        //  Add to loop prevention string
14316>>>>>        Move hoCurrentDD to haDone[(SizeOfArray(haDone))]
14317>>>>>        
14317>>>>>        //  Check if not the same (optimalization)
14317>>>>>        If (hoCurrentDD <> hoSearchDD) Begin
14319>>>>>            
14319>>>>>            //  Loop through servers
14319>>>>>            Get Data_Set_Server_Count of hoCurrentDD to iCount
14320>>>>>            Move 0 to iCounter
14321>>>>>            While (iCounter < iCount and not(bResult))
14325>>>>>                Get Data_Set_Server of hoCurrentDD iCounter to hoNextDD
14326>>>>>                
14326>>>>>                //  Check if searched
14326>>>>>                If (hoNextDD = hoSearchDD) Begin
14328>>>>>                    Move True to bResult
14329>>>>>                End
14329>>>>>>
14329>>>>>                Else Begin
14330>>>>>                    //  If not go on searching
14330>>>>>                    If (SearchArray(hoNextDD, haDone) < 0) Begin
14332>>>>>                        Get AjaxIsForeign hoNextDD hoSearchDD (&haDone) to bResult
14333>>>>>                    End
14333>>>>>>
14333>>>>>                End
14333>>>>>>
14333>>>>>                
14333>>>>>                Increment iCounter
14334>>>>>            Loop
14335>>>>>>
14335>>>>>        End
14335>>>>>>
14335>>>>>            
14335>>>>>        Function_Return bResult
14336>>>>>    End_Function
14337>>>>>    
14337>>>>>    //
14337>>>>>    //  Maps a field name into a field number.
14337>>>>>    //
14337>>>>>    //  Params:
14337>>>>>    //      iTableNumber    Number of the table which the column belong to
14337>>>>>    //      sColumnName     Name of the searched column
14337>>>>>    //  Returns:
14337>>>>>    //      Number of the field (-1 if not found)
14337>>>>>    //
14337>>>>>    Function FieldMap Integer iTableNumber String sColumnName Returns Integer
14339>>>>>        Integer iColumns iColumn iStartColumn
14339>>>>>        Boolean bIsRecnumTable
14339>>>>>        String sTableColumnName
14339>>>>>        
14339>>>>>        Get_Attribute DF_FILE_NUMBER_FIELDS of iTableNumber to iColumns
14342>>>>>        Get_Attribute DF_FILE_RECNUM_TABLE of iTableNumber to bIsRecnumTable
14345>>>>>        If (bIsRecnumTable) Begin
14347>>>>>            Move 0 to iStartColumn
14348>>>>>        End
14348>>>>>>
14348>>>>>        Else Begin
14349>>>>>            Move 1 to iStartColumn
14350>>>>>        End
14350>>>>>>
14350>>>>>        
14350>>>>>        Move (Lowercase (sColumnName)) to sColumnName
14351>>>>>        
14351>>>>>        For iColumn from iStartColumn to iColumns
14357>>>>>>
14357>>>>>            Get_Attribute DF_FIELD_NAME of iTableNumber iColumn to sTableColumnName
14360>>>>>            If (Lowercase (sTableColumnName) = sColumnName) Begin
14362>>>>>                Function_Return iColumn
14363>>>>>            End
14363>>>>>>
14363>>>>>        Loop
14364>>>>>>
14364>>>>>        
14364>>>>>        Function_Return -1
14365>>>>>    End_Function
14366>>>>>    
14366>>>>>    //
14366>>>>>    //  Maps a table number into a table name.
14366>>>>>    //  Uses DF_FILE_LOGICAL_NAME but function can be overridden
14366>>>>>    //
14366>>>>>    //  Params:
14366>>>>>    //      iTableNumber    Number of the table which the column belong to
14366>>>>>    //  Returns:
14366>>>>>    //      Name of the table
14366>>>>>    //    
14366>>>>>    Function FriendlyTableName Integer iTableNumner Returns String
14368>>>>>        String sFriendlyTableName
14368>>>>>        
14368>>>>>        Get_Attribute DF_FILE_LOGICAL_NAME of iTableNumner to sFriendlyTableName
14371>>>>>        
14371>>>>>        Function_Return sFriendlyTableName
14372>>>>>    End_Function
14373>>>>>End_Class
14374>>>
14374>>>Use cCompanyDataDictionary.dd
Including file: cCompanyDataDictionary.dd    (C:\VDF programs\timer\DdSrc\cCompanyDataDictionary.dd)
14374>>>>>Use DataDict.pkg
14374>>>>>
14374>>>>>Open Company
Including file: Company.FD    (C:\VDF programs\timer\DdSrc\Company.FD)
14376>>>>>Open CUSTOMER
Including file: Customer.fd    (C:\VDF programs\timer\DdSrc\Customer.fd)
14378>>>>>Open User
Including file: User.fd    (C:\VDF programs\timer\DdSrc\User.fd)
14380>>>>>Open OrdSys
Including file: OrdSys.fd    (C:\VDF programs\timer\DdSrc\OrdSys.fd)
14382>>>>>
14382>>>>>Class cCompanyDataDictionary is a DataDictionary
14383>>>>>    
14383>>>>>    Procedure Construct_Object
14385>>>>>        Forward Send Construct_Object
14387>>>>>        Set Main_file to Company.File_Number
14388>>>>>
14388>>>>>        Set Add_System_File to OrdSys.File_Number DD_Lock_On_All
14389>>>>>
14389>>>>>        Set Add_Client_File to CUSTOMER.File_Number
14390>>>>>        Set Add_Client_File to User.File_Number
14391>>>>>
14391>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_NOPUT to True
14392>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_FINDREQ to True
14393>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_NOPUT to True
14394>>>>>        Set Foreign_Field_Option DD_DEFAULT DD_DISPLAYONLY to True
14395>>>>>
14395>>>>>        Set Field_Auto_Increment Field Company.CompanyId to File_Field OrdSys.CompanyId
14396>>>>>
14396>>>>>    End_Procedure
14397>>>>>
14397>>>>>End_Class
14398>>>Use User.DD
Including file: User.dd    (C:\VDF programs\timer\DdSrc\User.dd)
14398>>>>>Use  Windows.pkg           // Basic Definitions
14398>>>>>Use  DataDict.pkg          // DataDictionary Class Definition
14398>>>>>Use  Ddvaltbl.pkg          // Validation Table Class Definitions
14398>>>>>
14398>>>>>Open User
14400>>>>>Open Ordsys
14402>>>>>Open Company
14404>>>>>Open TimeReg
Including file: TimeReg.FD    (C:\VDF programs\timer\DdSrc\TimeReg.FD)
14406>>>>>Open UserProj
Including file: UserProj.FD    (C:\VDF programs\timer\DdSrc\UserProj.FD)
14408>>>>>
14408>>>>>Class User_DataDictionary  is a DataDictionary
14409>>>>>    Procedure Construct_Object
14411>>>>>        Forward Send Construct_Object
14413>>>>>
14413>>>>>
14413>>>>>        Set Main_File To User.File_Number
14414>>>>>
14414>>>>>        Set Add_Server_File to Company.File_Number
14415>>>>>        
14415>>>>>        Set Cascade_Delete_State to False
14416>>>>> 
14416>>>>>
14416>>>>>        Set Add_Client_File to TimeReg.File_Number
14417>>>>>        Set Add_Client_File to UserProj.File_Number
14418>>>>>
14418>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_AUTOFIND to True
14419>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_NOPUT to True
14420>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_FINDREQ to True
14421>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_NOPUT to True
14422>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_FINDREQ to True
14423>>>>>        Set Foreign_Field_Option DD_DEFAULT DD_DISPLAYONLY to True
14424>>>>>
14424>>>>>        Set Add_System_File to Ordsys.File_Number DD_LOCK_ON_ALL
14425>>>>>
14425>>>>>        Set Field_Auto_Increment Field User.Userid to File_Field Ordsys.Userid
14426>>>>>
14426>>>>>        Set Field_Option Field User.LoginName DD_REQUIRED to True
14427>>>>>
14427>>>>>        Set Field_Option Field User.Password DD_REQUIRED to True
14428>>>>>
14428>>>>>        Set Field_Option Field User.FirstName DD_REQUIRED to True
14429>>>>>
14429>>>>>        Set Field_Option Field User.LastName DD_REQUIRED to True
14430>>>>>
14430>>>>>        Set Field_Option Field User.Mail DD_REQUIRED to True
14431>>>>>
14431>>>>>
14431>>>>>    End_Procedure    // Construct_Object
14432>>>>>
14432>>>>>    Procedure Field_Defaults
14434>>>>>        Forward Send Field_Defaults
14436>>>>>    End_Procedure    // Field_Defaults
14437>>>>>
14437>>>>>End_Class    // User_DataDictionary
14438>>>>>
14438>>>
14438>>>Object oUserTest Is A cAjaxWebBusinessProcess
14440>>>    Set psDescription to "UserTest"
14441>>>    Set pbClearAfterSave to False
14442>>>
14442>>>
14442>>>    Object oCompany_DD Is A cCompanyDataDictionary
14444>>>    End_Object // oCompany_DD
14445>>>
14445>>>    Object oUser_DD Is A User_DataDictionary
14447>>>        Set DDO_Server To oCompany_DD
14448>>>    End_Object // oUser_DD
14449>>>
14449>>>    Set Main_DD To oUser_DD
14450>>>
14450>>>
14450>>>    Send RegisterStandardInterface
14451>>>    //Send RegisterDebugInterface
14451>>>    //Send RegisterFullErrorInterface
14451>>>    //Send RegisterAutoEntryInterface
14451>>>
14451>>>End_Object // oUserTest
14452>    Use SessionManager.wo
Including file: SessionManager.wo    (C:\VDF programs\timer\AppSrc\SessionManager.wo)
14452>>>//
14452>>>//  Instantion of the Application Data Service Manager that is used for global 
14452>>>//  information, session manager, rights. Contains extra application layer 
14452>>>//  functionality for user login & rights management.
14452>>>//
14452>>>//  Since:
14452>>>//      07/19/2004
14452>>>//  Changed:
14452>>>//      --
14452>>>//  Version:
14452>>>//      0.9
14452>>>//  Created:
14452>>>//      Data Access Europe (Harm Wibier)
14452>>>//
14452>>>
14452>>>Use cAjaxSessionManager.pkg
Including file: cAjaxSessionManager.pkg    (C:\Program Files\Visual DataFlex AJAX Library 2.2\AppSrc\cAjaxSessionManager.pkg)
14452>>>>>//
14452>>>>>//  This class is the base class for the session manager in applications that 
14452>>>>>//  use the AJAX Library. It is used as a central point and contains Global 
14452>>>>>//  functionality of which most is meant to be overridden / augmented by the 
14452>>>>>//  user. Important functionality is the session system that is based here with
14452>>>>>//  the methods CreateSession and ValidateSession. These methods need to be 
14452>>>>>//  augmented to create a full Function session system!
14452>>>>>//
14452>>>>>//  Since:
14452>>>>>//      07/17/2006
14452>>>>>//  Changed:
14452>>>>>//      --
14452>>>>>//  Version:
14452>>>>>//      0.9
14452>>>>>//  Created:
14452>>>>>//      Data Access Europe (Harm Wibier)
14452>>>>>//
14452>>>>>
14452>>>>>Use WebAppBase.pkg          // standard windows classes
14452>>>>>Use HelpSystemConstants.pkg // constants used by help system (not used byt needed by cApplication)
14452>>>>>Use cApplication.pkg        // cApplication class
14452>>>>>Use cWebBusinessProcess.pkg
14452>>>>>Use cWebApp.pkg
14452>>>>>Use cWebReport.pkg
14452>>>>>Use Flexml.pkg              // this adds XML class support to server classes
14452>>>>>
14452>>>>>Use AjaxDataStructures.pkg
14452>>>>>
14452>>>>>
14452>>>>>Class cAjaxSessionManager is a cWebBusinessProcess
14453>>>>>
14453>>>>>    Procedure Construct_Object
14455>>>>>        Forward Send Construct_Object
14457>>>>>        
14457>>>>>        // Indicates the length to use for the generation of session key.
14457>>>>>        Property Integer piSessionKeyLength 64
14458>>>>>        // String with a set of characters that are used to generate the session keys.
14458>>>>>        Property String psSessionKeyChars "qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM0123456789"
14459>>>>>        // The version number of the library used in the version check. Is matched against the version number sent by the client in a request.
14459>>>>>        Property String psVersion "2.2.5.10"
14460>>>>>        
14460>>>>>        
14460>>>>>        // Set property values:
14460>>>>>        Set pbQueueErrors         to True  //
14461>>>>>        Set pbVerboseErrors       to True  // Show linenumber or not.
14462>>>>>        Set pbReportErrors        to True
14463>>>>>        Set pbClearAfterSave      to False
14464>>>>>        Set pbAllErrorsToEventLog to True   
14465>>>>>
14465>>>>>    End_Procedure  // Construct_Object
14466>>>>>    
14466>>>>>    //
14466>>>>>    //  Fills the given structure with the global meta data like dateformats 
14466>>>>>    //  and separators.
14466>>>>>    //
14466>>>>>    //  Params:
14466>>>>>    //      tResponse   TAjaxMetaWO structure passed by reference.
14466>>>>>    //
14466>>>>>    Procedure GlobalMetaData  TAjaxMetaWO ByRef tResponse
14468>>>>>        Integer iDecimalSeparatorChar iThousandsSeparator iMask iSeparator
14468>>>>>        String sCurrency
14468>>>>>    
14468>>>>>        // Add Datamask
14468>>>>>        Get_Attribute DF_DATE_SEPARATOR to iSeparator
14471>>>>>        Get_Attribute DF_DATE_FORMAT to iMask
14474>>>>>    
14474>>>>>        If (iMask = DF_DATE_USA) Move ("mm" + (character(iSeparator)) +  "dd" + (character(iSeparator)) +  "yyyy") to tResponse.sDateFormat
14477>>>>>        Else If (iMask=DF_DATE_EUROPEAN) Move ("dd" + (character(iSeparator)) + "mm" + (character(iSeparator)) + "yyyy") to tResponse.sDateFormat
14481>>>>>        Else If (iMask=DF_DATE_MILITARY) Move ("yyyy" + (character(iSeparator)) + "mm" + (character(iSeparator)) + "dd") to tResponse.sDateFormat
14485>>>>>        Move (Character(iSeparator)) to tResponse.sDateSeparator
14486>>>>>        
14486>>>>>        // Add Decimal Separator
14486>>>>>        Get_Attribute DF_DECIMAL_SEPARATOR to iDecimalSeparatorChar
14489>>>>>        Move (Character(iDecimalSeparatorChar)) to tResponse.sDecimalSeparator
14490>>>>>    
14490>>>>>        Get_Attribute DF_THOUSANDS_SEPARATOR to iThousandsSeparator
14493>>>>>        Move (Character(iThousandsSeparator)) to tResponse.sThousandsSeparator
14494>>>>>        
14494>>>>>        Get Default_Currency_Symbol to tResponse.sCurrencySymbol
14495>>>>>        //  Work arround for euro sign and the polish sign
14495>>>>>        If (tResponse.sCurrencySymbol = Character(128)) Begin
14497>>>>>            Move "&euro;" to  tResponse.sCurrencySymbol
14498>>>>>        End
14498>>>>>>
14498>>>>>        If (Left(tResponse.sCurrencySymbol, 1) = Character(122) and Right(tResponse.sCurrencySymbol, 1) = Character(179)) Begin
14500>>>>>            Move "z&#322" to tResponse.sCurrencySymbol    
14501>>>>>        End
14501>>>>>>
14501>>>>>
14501>>>>>        
14501>>>>>        // Other information
14501>>>>>        Get_Date_Attribute DATE4_STATE to tResponse.iDate4_State
14502>>>>>        Get_Date_Attribute EPOCH_VALUE to tResponse.iEpoch
14503>>>>>    End_Procedure
14504>>>>>    
14504>>>>>    //
14504>>>>>    //  Validates the session by just checking the session key length. Should 
14504>>>>>    //  be overloaded for reliable session system.
14504>>>>>    //
14504>>>>>    //  Params:
14504>>>>>    //      sSessionKey String identifying the session
14504>>>>>    //  Returns:
14504>>>>>    //      Error code (0 if no errors)
14504>>>>>    //
14504>>>>>    Function ValidateSession String sSessionKey Returns Integer
14506>>>>>        Integer iSessionKeyLength
14506>>>>>        
14506>>>>>        Get piSessionKeyLength to iSessionKeyLength
14507>>>>>        
14507>>>>>        If (Length(Trim(sSessionKey)) = iSessionKeyLength) Begin
14509>>>>>             Function_Return 0
14510>>>>>        End
14510>>>>>>
14510>>>>>        Else Begin
14511>>>>>            Error 5647 "Invalid session id"
14512>>>>>>
14512>>>>>            Function_Return 5647
14513>>>>>        End
14513>>>>>>
14513>>>>>    End_Function
14514>>>>>    
14514>>>>>    //
14514>>>>>    //  Creates the session by just generating an random session key. Should be
14514>>>>>    //  overloaded for reliable session system.
14514>>>>>    //
14514>>>>>    //  Params:
14514>>>>>    //      sRemoteAddress
14514>>>>>    //  Returns:
14514>>>>>    //      Random session key
14514>>>>>    //
14514>>>>>    Function CreateSession String sRemoteAddress Returns String
14516>>>>>        Integer iCurrent iNumChars iSessionKeyLength
14516>>>>>        String sSessionKey sSessionKeyChars
14516>>>>>        
14516>>>>>        Get piSessionKeyLength to iSessionKeyLength
14517>>>>>        Get psSessionKeyChars to sSessionKeyChars
14518>>>>>        Move (Length(sSessionKeyChars)) to iNumChars
14519>>>>>        Move "" to sSessionKey
14520>>>>>        
14520>>>>>        For iCurrent From 1 To iSessionKeyLength
14526>>>>>>
14526>>>>>            Move (sSessionKey + Mid(sSessionKeyChars, 1, ((Random(iNumChars) + 1)))) to sSessionKey
14527>>>>>        Loop
14528>>>>>>
14528>>>>>        
14528>>>>>        Function_Return sSessionKey
14529>>>>>    End_Function
14530>>>>>    
14530>>>>>    //
14530>>>>>    //  Returns default rights. This allows every known type. Should be 
14530>>>>>    //  overriden / augmented with smart rights system.
14530>>>>>    //
14530>>>>>    //  Params:
14530>>>>>    //      sSessionKey Unique string identifying the session
14530>>>>>    //      sType       Type of action to check if allowed ("meta", "find", 
14530>>>>>    //                  "clear", "save", "delete")
14530>>>>>    //      sWebObject  Name of the webobject   that will handle the call.
14530>>>>>    //      sMethod     If sType is rmi this contains the name of the method 
14530>>>>>    //                  that is called.
14530>>>>>    //      
14530>>>>>    //  Returns:
14530>>>>>    //      True if action allowed
14530>>>>>    //
14530>>>>>    Function HasRights String sSessionKey String sType String sWebObject String sMethod Returns Boolean
14532>>>>>        Boolean bResult
14532>>>>>        
14532>>>>>        Case Begin
14532>>>>>            Case (sType = "meta")
14534>>>>>                Move True to bResult
14535>>>>>                Case Break
14536>>>>>            Case (sType = "find")
14539>>>>>                Move True to bResult
14540>>>>>                Case Break
14541>>>>>            Case (sType = "clear")
14544>>>>>                Move True to bResult
14545>>>>>                Case Break
14546>>>>>            Case (sType = "save")
14549>>>>>                Move True to bResult
14550>>>>>                Case Break
14551>>>>>            Case (sType = "delete")
14554>>>>>                Move True to bResult
14555>>>>>                Case Break
14556>>>>>            Case (sType = "rmi")
14559>>>>>                Move True to bResult
14560>>>>>                Case Break
14561>>>>>            Case (sType = "tree")
14564>>>>>                Move True to bResult
14565>>>>>                Case Break
14566>>>>>            Case Else
14566>>>>>                Move False to bResult
14567>>>>>        Case End
14567>>>>>        
14567>>>>>        Function_Return bResult
14568>>>>>    End_Function
14569>>>>>    
14569>>>>>    //
14569>>>>>    //  Registers the public messages
14569>>>>>    //
14569>>>>>    Procedure End_Construct_Object
14571>>>>>        Forward Send End_Construct_Object
14573>>>>>
14573>>>>>        Send RegisterInterface get_ValidateSession "get_ValidateSession" "String sSessionKey Returns Integer" "Validate session"
14574>>>>>        Send RegisterInterface get_CreateSession "get_CreateSession" "String sRemoteAddress Returns String" "Create new session"
14575>>>>>        Send RegisterInterface get_HasRights "get_HasRights" "String sSessionKey String sType String sWebObject String sMethod Returns Boolean" "Create new session"
14576>>>>>    End_Procedure // End_Construct_Object
14577>>>>>End_Class
14578>>>
14578>>>Use Session.DD
Including file: Session.dd    (C:\VDF programs\timer\DdSrc\Session.dd)
14578>>>>>Use  Windows.pkg           // Basic Definitions
14578>>>>>Use  DataDict.pkg          // DataDictionary Class Definition
14578>>>>>Use  Ddvaltbl.pkg          // Validation Table Class Definitions
14578>>>>>
14578>>>>>Open Session
Including file: Session.fd    (C:\VDF programs\timer\DdSrc\Session.fd)
14580>>>>>Open Ordsys
14582>>>>>Open Project
Including file: Project.FD    (C:\VDF programs\timer\DdSrc\Project.FD)
14584>>>>>
14584>>>>>
14584>>>>>
14584>>>>>Class Session_DataDictionary  is a DataDictionary
14585>>>>>//
14585>>>>>    //  Called when record is created, sets the current date & time to the 
14585>>>>>    //  Create and LastAccess fields.
14585>>>>>    //
14585>>>>>    Procedure Creating
14587>>>>>        DateTime dtCurrentDateTime
14587>>>>>
14587>>>>>        Forward Send Creating
14589>>>>>        
14589>>>>>        //  Init usecounter
14589>>>>>        Move 0 to Session.UseCount
14590>>>>>        
14590>>>>>        //  Set the creation and access time to the current time
14590>>>>>        Move (CurrentDateTime()) To dtCurrentDateTime
14591>>>>>    
14591>>>>>        Get GetTimeString dtCurrentDateTime to Session.CreateTime
14592>>>>>        Get GetTimeString dtCurrentDateTime to Session.LastAccessTime
14593>>>>>        
14593>>>>>        Move dtCurrentDateTime to Session.CreateDate
14594>>>>>        Move dtCurrentDateTime to Session.LastAccessDate
14595>>>>>    End_Procedure   // Creating
14596>>>>>    
14596>>>>>    //
14596>>>>>    //  Called to update the AccessTime and AccessDate fields with the current
14596>>>>>    //  date & time.
14596>>>>>    //
14596>>>>>    Procedure RegisterAccess
14598>>>>>        Integer iError
14598>>>>>        DateTime dtCurrentDateTime
14598>>>>>        String sTimeString
14598>>>>>
14598>>>>>        //  Set the access time to the current time
14598>>>>>        Move (CurrentDateTime()) To dtCurrentDateTime
14599>>>>>        Get GetTimeString dtCurrentDateTime to sTimeString
14600>>>>>
14600>>>>>        Set Field_Changed_Value Field Session.LastAccessTime to sTimeString
14601>>>>>        Set Field_Changed_Value Field Session.LastAccessDate to dtCurrentDateTime
14602>>>>>        
14602>>>>>        //  Increment usecount
14602>>>>>        Set Field_Changed_Value Field Session.UseCount to (Session.UseCount + 1)
14603>>>>>        
14603>>>>>        Get Request_Validate to iError
14604>>>>>        If (iError = 0) Begin
14606>>>>>            Send Request_Save
14607>>>>>        End
14607>>>>>>
14607>>>>>    End_Procedure
14608>>>>>    
14608>>>>>    //
14608>>>>>    //  Converts the given time to an string that can be saved in the database.
14608>>>>>    //
14608>>>>>    //  Params:
14608>>>>>    //      dtDateTime  Time to convert
14608>>>>>    //  Returns:
14608>>>>>    //      String with "HH:MM:SS" format
14608>>>>>    //
14608>>>>>    Function GetTimeString DateTime dtDateTime Returns String
14610>>>>>        String sHours sMinutes sSeconds
14610>>>>>        
14610>>>>>        //  Extract parts
14610>>>>>        Move (String(DateGetHour(dtDateTime))) to sHours
14611>>>>>        Move (String(DateGetMinute(dtDateTime))) to sMinutes
14612>>>>>        Move (String(DateGetSecond(dtDateTime))) to sSeconds
14613>>>>>        
14613>>>>>        //  Fill out with 0
14613>>>>>        If (Length(sHours) = 1) Move ("0" + sHours) to sHours
14616>>>>>        If (Length(sMinutes) = 1) Move ("0" + sMinutes) to sMinutes
14619>>>>>        If (Length(sSeconds) = 1) Move ("0" + sSeconds) to sSeconds
14622>>>>>        
14622>>>>>        Function_Return (sHours + ":" + sMinutes + ":" + sSeconds)
14623>>>>>    End_Function
14624>>>>>    
14624>>>>>    //
14624>>>>>    //  Sets the time of the datetime variable to the time in the string.
14624>>>>>    //
14624>>>>>    //  Params:
14624>>>>>    //      dtDateTime  Datetime variable to add time to
14624>>>>>    //      sTimeString String with time in the format "HH:MM:SS"
14624>>>>>    //  Returns:
14624>>>>>    //      dtDateTime with the loaded time
14624>>>>>    //
14624>>>>>    Function LoadTimeString DateTime dtDateTime String sTimeString Returns DateTime
14626>>>>>        String sHours sMinutes sSeconds
14626>>>>>        
14626>>>>>        //  Extract parts
14626>>>>>        Move (Mid(sTimeString, 2, 1)) to sHours
14627>>>>>        Move (Mid(sTimeString, 2, 4)) to sMinutes
14628>>>>>        Move (Mid(sTimeString, 2, 7)) to sSeconds
14629>>>>>        
14629>>>>>        //  Set to DateTime
14629>>>>>        Move (DateSetHour(dtDateTime, (Integer(sHours)))) to dtDateTime
14630>>>>>        Move (DateSetMinute(dtDateTime, (Integer(sMinutes)))) to dtDateTime
14631>>>>>        Move (DateSetSecond(dtDateTime, (Integer(sSeconds)))) to dtDateTime
14632>>>>>        
14632>>>>>        Function_Return dtDateTime
14633>>>>>    End_Function
14634>>>>>    
14634>>>>>    
14634>>>>>
14634>>>>>    Procedure Construct_Object
14636>>>>>        Forward Send Construct_Object
14638>>>>>
14638>>>>>
14638>>>>>        Set Main_File To Session.File_Number
14639>>>>>
14639>>>>>        Set Add_Client_File to Project.File_Number
14640>>>>>
14640>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_AUTOFIND to True
14641>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_NOPUT to True
14642>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_FINDREQ to True
14643>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_NOPUT to True
14644>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_FINDREQ to True
14645>>>>>        Set Foreign_Field_Option DD_DEFAULT DD_DISPLAYONLY to True
14646>>>>>
14646>>>>>        Set Add_System_File to Ordsys.File_Number DD_LOCK_ON_ALL
14647>>>>>
14647>>>>>        Set Field_Auto_Increment Field Session.Sessionid to File_Field Ordsys.Sessionid
14648>>>>>
14648>>>>>
14648>>>>>    End_Procedure    // Construct_Object
14649>>>>>
14649>>>>>    Procedure Field_Defaults
14651>>>>>        Forward Send Field_Defaults
14653>>>>>    End_Procedure    // Field_Defaults
14654>>>>>
14654>>>>>End_Class    // Session_DataDictionary
14655>>>>>
14655>>>Use User.DD
14655>>>Use cCompanyDataDictionary.dd
14655>>>
14655>>>Object oSessionManager is a cAjaxSessionManager
14657>>>    Object oUser_DD is a User_DataDictionary
14659>>>    End_Object
14660>>>
14660>>>//    Object oCompany_DD is a cCompanyDataDictionary
14660>>>//        Constrain company.CompanyId eq user.companyid
14660>>>//    End_Object
14660>>>    Object oSession_DD is a Session_DataDictionary
14662>>>        Set DDO_Server to oUser_DD
14663>>>        
14663>>>        //  
14663>>>        //  Used for the SOFT Session -> User relation
14663>>>        //
14663>>>        Procedure Attach_Main_File
14666>>>            Forward Send Attach_Main_File
14668>>>        
14668>>>            Move User.Userid to Session.Userid
14669>>>            Move User.CompanyId to Session.CompanyId
14670>>>            
14670>>>        End_Procedure   // Attach_Main_File
14671>>>        
14671>>>        //
14671>>>        //  Used for the SOFT Session -> User relation
14671>>>        //
14671>>>        Procedure Relate_Main_File
14674>>>            Boolean bMustFind
14674>>>            Integer iStatus iFile
14674>>>            
14674>>>            Forward Send Relate_Main_File
14676>>>      
14676>>>            Get Main_File to iFile
14677>>>            Get_Attribute DF_FILE_STATUS of iFile to iStatus
14680>>>                
14680>>>            If (iStatus = DF_FILE_INACTIVE) Begin
14682>>>                Move True to bMustFind
14683>>>            End
14683>>>>
14683>>>            Else If (Session.Userid <> User.Userid) Begin
14686>>>                Move True to bMustFind
14687>>>            End
14687>>>>
14687>>>        
14687>>>            If bMustFind Begin // relate SoftFile only if required
14689>>>                Clear User
14690>>>                Move Session.Userid to User.Userid
14691>>>                Find eq User.Userid
14692>>>>
14692>>>            End
14692>>>>
14692>>>        
14692>>>            Get_Attribute DF_FILE_STATUS of User.File_Number to iStatus
14695>>>            If (iStatus <> DF_FILE_INACTIVE) Begin
14697>>>                Send Request_Relate User.File_Number
14698>>>            End
14698>>>>
14698>>>            Else Begin
14699>>>                Send Request_Clear_File User.File_Number
14700>>>            End
14700>>>>
14700>>>
14700>>>//            Clear Customer
14700>>>//            Move User.CompanyId to Company.CompanyId
14700>>>//            Find eq company.CompanyId
14700>>>        
14700>>>        End_Procedure
14701>>>    End_Object
14702>>>
14702>>>    Set Main_DD to oSession_DD
14703>>>
14703>>>    //  Main settings:
14703>>>    Property Integer piSessionTimeout 60
14705>>>    
14705>>>    //
14705>>>    //  Overloads the CreateSession and adds functionality to save the newly 
14705>>>    //  created session.
14705>>>    //
14705>>>    //  Params:
14705>>>    //      sRemoteAddress  Adres of the client
14705>>>    //  Returns:
14705>>>    //      Unique session key
14705>>>    //
14705>>>    Function CreateSession String sRemoteAddress returns String
14708>>>        Integer iError iAttempts
14708>>>        String sSessionKey
14708>>>        
14708>>>        //  Detach user DD
14708>>>        Send Clear of oSession_DD
14709>>>        Send Detach_Server of oSession_DD oUser_DD
14710>>>        
14710>>>        //  Forward call until we get an unique sessionid (max 100 attempts)
14710>>>        Move 0 to iAttempts
14711>>>        Repeat
14711>>>>
14711>>>            Forward Get CreateSession sRemoteAddress to sSessionKey
14713>>>            
14713>>>            Increment iAttempts
14714>>>            
14714>>>            Move sSessionKey to Session.SessionKey
14715>>>            Send Find of oSession_DD EQ Index.2
14716>>>        Until ((not(Found)) or (iAttempts >= 100))
14718>>>        
14718>>>        If (iAttempts < 100) Begin
14720>>>        
14720>>>            //  Create session record
14720>>>            Send Clear of oUser_DD
14721>>>            Send Clear of oSession_DD
14722>>>            Set Field_Changed_Value of oSession_DD Field Session.SessionKey to sSessionKey
14723>>>            Set Field_Changed_Value of oSession_DD Field Session.RemoteAddress to sRemoteAddress
14724>>>            
14724>>>            Get Request_Validate of oSession_DD to iError
14725>>>            If (iError = 0) Begin
14727>>>                Send Request_Save of oSession_DD
14728>>>            End
14728>>>>
14728>>>            
14728>>>        End
14728>>>>
14728>>>        Else Begin
14729>>>            Error 915 ("Unable to create unique session id (" * iAttempts * " attempts)")
14730>>>>
14730>>>            Function_Return ""
14731>>>        End
14731>>>>
14731>>>        
14731>>>        //  Re-attach user DD
14731>>>        Set DDO_Server of oSession_DD to oUser_DD
14732>>>        Send Clear of oUser_DD
14733>>>
14733>>>        Function_Return sSessionKey
14734>>>    End_Function
14735>>>    
14735>>>    //
14735>>>    //  Overloads the ValidateSession and adds functionality that checks if the
14735>>>    //  session exists in the Sessions table and is not timed out (10 minutes 
14735>>>    //  not accessed). If valid session it updates the last access time to the
14735>>>    //  current time.
14735>>>    //  
14735>>>    //  Params:
14735>>>    //      sSessionKey Key of the session to validate
14735>>>    //  Returns:
14735>>>    //      0 if session is valid
14735>>>    //
14735>>>    Function ValidateSession String sSessionKey returns Integer
#REM SEND REGISTERINTERFACE |CI5565 "get_ValidateSession" "String sSessionKey returns Integer" "Checks the if the passed session id is a valid session id"
14739>>>        DateTime dtLastAccess dtCurrent
14739>>>        TimeSpan tsDiff
14739>>>        Integer iError iSessionTimeout
14739>>>        
14739>>>        //  Detach user DD
14739>>>        Send Clear of oSession_DD
14740>>>        Send Detach_Server of oSession_DD oUser_DD
14741>>>        
14741>>>        Forward Get ValidateSession sSessionKey to iError
14743>>>        Get piSessionTimeout to iSessionTimeout 
14744>>>        
14744>>>        
14744>>>        If (iError = 0) Begin
14746>>>            //  Try to find the session record
14746>>>            Move sSessionKey to Session.SessionKey
14747>>>            Send Find of oSession_DD EQ Index.2
14748>>>            
14748>>>            If (Found) Begin
14750>>>                
14750>>>                //  Calculate timespan between now and last access time
14750>>>                Move (CurrentDateTime()) to dtCurrent
14751>>>                Move Session.LastAccessDate to dtLastAccess
14752>>>                Get LoadTimeString of oSession_DD dtLastAccess Session.LastAccessTime to dtLastAccess
14753>>>                Move (dtCurrent - dtLastAccess) To tsDiff
14754>>>                
14754>>>                //  Check if session didn't time out
14754>>>                If (SpanTotalMinutes(tsDiff) < iSessionTimeout) Begin
14756>>>                    
14756>>>                    //  Register this access
14756>>>                    Send RegisterAccess of oSession_DD
14757>>>                End
14757>>>>
14757>>>                Else Begin
14758>>>                    Error 950 "Session timed out (reload page to recreate session)"
14759>>>>
14759>>>                    Move 950 to iError
14760>>>                End
14760>>>>
14760>>>            End
14760>>>>
14760>>>            Else Begin
14761>>>                Move 951 to iError
14762>>>                Error 951 "Session key not known (reload page to recreate session)"
14763>>>>
14763>>>            End
14763>>>>
14763>>>        End
14763>>>>
14763>>>        
14763>>>        //  Re-attach user DD
14763>>>        Set DDO_Server of oSession_DD to oUser_DD
14764>>>        Send Clear of oUser_DD
14765>>>
14765>>>        Function_Return iError        
14766>>>    End_Function
14767>>>    
14767>>>    //
14767>>>    //  Handles userlogin request. Finds the session and the user and saves the
14767>>>    //  relation if login succesfull. This method is custom added at the object 
14767>>>    //  / application layer.
14767>>>    //
14767>>>    //  Params:
14767>>>    //      sSessionKey Identification string of the session
14767>>>    //      sLoginName  Name of the user
14767>>>    //      sPassword   Password of the user
14767>>>    //  Returns:
14767>>>    //      Error number (0 if succesfull)
14767>>>    //
14767>>>    Function UserLogin String sSessionKey String sLoginName String sPassword Returns Integer
#REM SEND REGISTERINTERFACE |CI5573 "get_UserLogin" "String sSessionKey String sLoginName String sPassword Returns Integer" "Checks the username and password and saves the login in the session if succesful."
14771>>>        Integer iError
14771>>>        
14771>>>        Move 0 to iError
14772>>>        
14772>>>        //  Try to find the session record
14772>>>        Send Clear of oSession_DD
14773>>>        Move sSessionKey to Session.SessionKey
14774>>>        Send Find of oSession_DD EQ Index.2
14775>>>        If (Found) Begin
14777>>>        
14777>>>            //  Try to find the user
14777>>>            Send Clear of oUser_DD
14778>>>            Move (Lowercase(sLoginName)) to User.LoginName
14779>>>            Send Find of oUser_DD EQ Index.2
14780>>>            If (Found and (Lowercase(sLoginName) = Lowercase(Trim(User.LoginName)))) Begin
14782>>>            
14782>>>                //  Check the password
14782>>>                If (Trim(User.Password) = Trim(sPassword)) Begin
14784>>>                    
14784>>>                    //  Check user active
14784>>>                    If (User.State = "A") Begin
14786>>>                        //  Save login
14786>>>                        Get Request_Validate of oSession_DD to iError
14787>>>                        If (iError = 0) Begin
14789>>>                            Send Request_Save of oSession_DD
14790>>>                        End
14790>>>>
14790>>>                    End 
14790>>>>
14790>>>                    Else Begin
14791>>>                        Move 962 to iError
14792>>>                        Error 962 "User account is disabled!"
14793>>>>
14793>>>                    End
14793>>>>
14793>>>                End
14793>>>>
14793>>>                Else Begin
14794>>>                    Move 961 to iError
14795>>>                    Error 961 "Username or password invalid!"
14796>>>>
14796>>>                End
14796>>>>
14796>>>            End 
14796>>>>
14796>>>            Else Begin
14797>>>                Move 961 to iError
14798>>>                Error 961 "Username or password invalid!"
14799>>>>
14799>>>            End
14799>>>>
14799>>>            
14799>>>        End
14799>>>>
14799>>>        Else Begin
14800>>>            Move 951 to iError
14801>>>            Error 951 "Session key not known (reload page to recreate session)"
14802>>>>
14802>>>        End        
14802>>>>
14802>>>        Send Clear of oUser_DD
14803>>>
14803>>>        Function_Return iError
14804>>>    End_Function
14805>>>    
14805>>>    //
14805>>>    //  Checks if the user that is logged in has the rights to execute the 
14805>>>    //  action.
14805>>>    //
14805>>>    //  Params:
14805>>>    //      sSessionKey String identifier of the current session
14805>>>    //      sType       String describing the action ("save", "delete", "find",
14805>>>    //                  "clear", "meta")
14805>>>    //      sWebObject  Name of the webobject   that will handle the call.
14805>>>    //      sMethod     If sType is rmi this contains the name of the method 
14805>>>    //                  that is called.
14805>>>    //  Returns:
14805>>>    //      True if the action is allowed
14805>>>    //
14805>>>    Function HasRights String sSessionKey String sType String sWebObject String sMethod Returns Boolean
14808>>>        Boolean bResult
14808>>>        
14808>>>        If (sWebObject = "oRegister" and sType = "save") Function_Return True
14811>>>        
14811>>>        
14811>>>        If (sType = "save" or sType = "delete") Begin
14813>>>            //  Find session info
14813>>>            Get FindSessionInfo sSessionKey to bResult
14814>>>            
14814>>>            If (bResult) Begin
14816>>>                //  Check if user found
14816>>>                Get HasRecord of oUser_DD to bResult
14817>>>                
14817>>>                If (bResult) Begin    
14819>>>                    //  Check if user has rights       
14819>>>                    Move (User.EditRights = "Y") to bResult
14820>>>                End
14820>>>>
14820>>>            End
14820>>>>
14820>>>        End
14820>>>>
14820>>>        Else Begin
14821>>>            Move (sType = "find" or sType = "meta" or sType = "clear" or sType = "rmi" or sType = "tree") to bResult
14822>>>        End
14822>>>>
14822>>>    
14822>>>        Function_Return bResult
14823>>>    End_Function
14824>>>    
14824>>>    //
14824>>>    //  Method used under asp to simply find the Session & User info (to reduce
14824>>>    //  number of commands fired from asp). The information will be fetched 
14824>>>    //  using the DDValue method.
14824>>>    //
14824>>>    //  Params:
14824>>>    //      sSessionKey String identifying the session key
14824>>>    //  Returns:
14824>>>    //      (True if session found)
14824>>>    //
14824>>>    Function FindSessionInfo String sSessionKey Returns Boolean
#REM SEND REGISTERINTERFACE |CI5574 "get_FindSessionInfo" "String sSessionKey Returns Boolean" "Loads the correct session info into the data dictionary."
14828>>>        Boolean bResult
14828>>>        
14828>>>        //  Try to find the session record
14828>>>        Send Clear of oSession_DD
14829>>>        Move sSessionKey to Session.SessionKey
14830>>>        Send Find of oSession_DD EQ Index.2
14831>>>
14831>>>        Move (Found) to bResult
14832>>>
14832>>>        Function_Return bResult
14833>>>    End_Function
14834>>>    
14834>>>    Function getUserId Returns Integer
#REM SEND REGISTERINTERFACE |CI5575 "get_getUserId" "Returns Integer" "Loads the correct session info into the data dictionary."
14838>>>        Function_Return Session.UserId
14839>>>    End_Function
14840>>>
14840>>>    Function getMyCustomers Returns Integer
#REM SEND REGISTERINTERFACE |CI5576 "get_getMyCustomers" "Returns Integer" "Loads the correct session info into the data dictionary."
14844>>>        Function_Return Session.UserId
14845>>>    End_Function
14846>>>
14846>>>    Function getMyProjects Returns String
#REM SEND REGISTERINTERFACE |CI5577 "get_getMyProjects" "Returns String" "Loads the correct session info into the data dictionary."
14850>>>        String ret
14850>>>        Clear UserProj
14851>>>        Move Session.UserId to UserProj.UserId
14852>>>        Find ge UserProj by Index.1
14853>>>>
14853>>>        While (Found)
14857>>>            Clear Project
14858>>>            Move UserProj.ProjectId to Project.ProjectId
14859>>>            Find eq Project by Index.1
14860>>>>
14860>>>            If (Found) Begin
14862>>>                Move (ret + Project.name) to ret
14863>>>            End
14863>>>>
14863>>>            Find gt UserProj by Index.1
14864>>>>
14864>>>            Move (UserProj.UserId = Session.UserId) to Found
14865>>>        Loop
14866>>>>
14866>>>        
14866>>>        //Send WriteHtml ret
14866>>>        
14866>>>        Function_Return ret
14867>>>    End_Function
14868>>>
14868>>>    Procedure getMyProjectsDDL Returns String
#REM SEND REGISTERINTERFACE |CI5578 "msg_getMyProjectsDDL" "Returns String" "Loads the correct session info into the data dictionary."
14872>>>        String ret
14872>>>        Move '<select name="project_id">' to ret
14873>>>        Clear UserProj
14874>>>        Move Session.UserId to UserProj.UserId
14875>>>        Find ge UserProj by Index.1
14876>>>>
14876>>>        While (Found)
14880>>>            Clear Project
14881>>>            Move UserProj.ProjectId to Project.ProjectId
14882>>>            Find eq Project by Index.1
14883>>>>
14883>>>            If (Found) Begin
14885>>>                Move (ret - '<option value="' - (String(Project.ProjectId)) - '">' - Project.name - '</option>') to ret
14886>>>            End
14886>>>>
14886>>>            Find gt UserProj by Index.1
14887>>>>
14887>>>            Move (UserProj.UserId = Session.UserId) to Found
14888>>>        Loop
14889>>>>
14889>>>        Move (ret - '</select>') to ret
14890>>>        //Send WriteHtml ret
14890>>>        //Send WriteHtml 'test'
14890>>>        
14890>>>        //Function_Return ret
14890>>>    End_Procedure
14891>>>
14891>>>End_Object
14892>>>
14892>>>
14892>    Use Webservice.wo
Including file: Webservice.wo    (C:\VDF programs\timer\AppSrc\Webservice.wo)
14892>>>Use cAjaxWebServiceInterface.pkg
Including file: cAjaxWebServiceInterface.pkg    (C:\Program Files\Visual DataFlex AJAX Library 2.2\AppSrc\cAjaxWebServiceInterface.pkg)
14892>>>>>//
14892>>>>>//  The cApplicationDataService contains the global webservice access methods 
14892>>>>>//  for cAjaxWebBussinesProcess webobjects. It contains some global session code
14892>>>>>//  and forwards most requests tho the webobjects handling methods. This 
14892>>>>>//  webservice is used by the ajax framework.
14892>>>>>//
14892>>>>>//  Since:
14892>>>>>//      10/24/2004
14892>>>>>//  Changed:
14892>>>>>//      --
14892>>>>>//  Version:
14892>>>>>//      0.9
14892>>>>>//  Created:
14892>>>>>//      Data Access Europe (Harm Wibier)
14892>>>>>//
14892>>>>>
14892>>>>>Use WebAppBase.pkg          // standard windows classes
14892>>>>>Use HelpSystemConstants.pkg // constants used by help system (not used but needed by cApplication)
14892>>>>>Use cApplication.pkg        // cApplication class
14892>>>>>Use cWebBusinessProcess.pkg
14892>>>>>Use cWebApp.pkg
14892>>>>>Use cWebReport.pkg
14892>>>>>Use Flexml.pkg              // this adds XML class support to server classes
14892>>>>>Use cWebService.pkg
Including file: cWebService.pkg    (C:\Program Files\Visual DataFlex 16.0\Pkg\cWebService.pkg)
14892>>>>>>>Use Windows.pkg
14892>>>>>>>Use Flexml.pkg
14892>>>>>>>Use Set.pkg
14892>>>>>>>
14892>>>>>>>Use cCallInterface.pkg
14892>>>>>>>Use cCallInterfaceHelper_mixin.pkg
14892>>>>>>>Use SoapConstants.pkg
Including file: SoapConstants.pkg    (C:\Program Files\Visual DataFlex 16.0\Pkg\SoapConstants.pkg)
14892>>>>>>>>>// SoapConstants.pkg
14892>>>>>>>>>// constants used by soap
14892>>>>>>>>>
14892>>>>>>>>>// DataFlex datatypes that we support in soap.
14892>>>>>>>>>// These MUST match the dataflex definitions as provided in fmac
14892>>>>>>>>>Enum_list
14892>>>>>>>>>    Define xsString    for 0
14892>>>>>>>>>    Define xsNumber    for 1
14892>>>>>>>>>    Define xsDate      for 2
14892>>>>>>>>>    Define xsInteger   for 3
14892>>>>>>>>>    Define xsBigint    for 4
14892>>>>>>>>>    Define xsReal      for 5
14892>>>>>>>>>    Define xsBoolean   for 6
14892>>>>>>>>>    Define xsTime      for 8
14892>>>>>>>>>    Define xsDatetime  for 9
14892>>>>>>>>>    Define xsFloat     for 10
14892>>>>>>>>>    Define xsChar      for 11
14892>>>>>>>>>    Define xsUchar     for 12
14892>>>>>>>>>    Define xsShort     for 13
14892>>>>>>>>>    Define xsUShort    for 14
14892>>>>>>>>>    Define xsUinteger  for 15
14892>>>>>>>>>    Define xsUbigint   for 17
14892>>>>>>>>>    Define xsCurrency  for 18
14892>>>>>>>>>    Define xsStruct    for 19
14892>>>>>>>>>    Define xsDecimal   for 22
14892>>>>>>>>>
14892>>>>>>>>>    Define xsEmpty     for  -1  // not a real datatype. Used with return types when nothing is returned. We must use -1 (the runtime message InterfaceMessageParamType returns this)
14892>>>>>>>>>    Define xsAnyType    for 127  // not a real type (represent as XML within a wrapper document)
14892>>>>>>>>>    Define xsXmlElement for 128  // not a real type (represent as an xml document. <any /> type in schema)
14892>>>>>>>>>
14892>>>>>>>>>End_Enum_list
14892>>>>>>>>>
14892>>>>>>>>>// soap style
14892>>>>>>>>>Enum_list
14892>>>>>>>>>   define ssDocument
14892>>>>>>>>>   define ssRPC
14892>>>>>>>>>End_Enum_list
14892>>>>>>>>>
14892>>>>>>>>>// soap encoding
14892>>>>>>>>>Enum_list
14892>>>>>>>>>   define seLiteral
14892>>>>>>>>>   define seEncoded
14892>>>>>>>>>End_Enum_list
14892>>>>>>>>>
14892>>>>>>>>>// service/port-types. Currently we only support soap
14892>>>>>>>>>Enum_list
14892>>>>>>>>>   define ptUnKnown
14892>>>>>>>>>   define ptSOAP
14892>>>>>>>>>   define ptHttp
14892>>>>>>>>>End_Enum_list
14892>>>>>>>>>
14892>>>>>>>>>// SOAP URI constants
14892>>>>>>>>>define C_WSDLURI              for "http://schemas.xmlsoap.org/wsdl/"
14892>>>>>>>>>define C_SOAPURI              for "http://schemas.xmlsoap.org/wsdl/soap/"
14892>>>>>>>>>define C_XMLSCHEMAURI         for "http://www.w3.org/2001/XMLSchema"
14892>>>>>>>>>define C_XMLSCHEMAXSIURI      for "http://www.w3.org/2001/XMLSchema-instance"
14892>>>>>>>>>define C_SOAPENVELOPEURI      for "http://schemas.xmlsoap.org/soap/envelope/"
14892>>>>>>>>>define C_SOAPENCODINGURI      for "http://schemas.xmlsoap.org/soap/encoding/"
14892>>>>>>>>>
14892>>>>>>>>>// .net uses a document style name of parameter to indicate wrap style, else bar
14892>>>>>>>>>define C_ParameterNameBare    for "parameters"
14892>>>>>>>>>define C_UnBounded            for -1 // used when maxOccurs=Unbounded
14892>>>>>>>>>
14892>>>>>>>>>
14892>>>>>>>Use LanguageTextWebApp.pkg
14892>>>>>>>
14892>>>>>>>Class cWebService is a cObject
14893>>>>>>>
14893>>>>>>>    Procedure Construct_Object
14895>>>>>>>        String sWSOName
14895>>>>>>>        Forward Send Construct_Object
14897>>>>>>>
14897>>>>>>>        Property Handle  Main_DD                 0
14898>>>>>>>        Property String  psDescription           ""
14899>>>>>>>        Property String  psServiceName           "tempService"
14900>>>>>>>        Property String  psServiceURI            "http://tempuri.org/"
14901>>>>>>>        Property String  psServiceTitle          "Visual DataFlex Web Service"
14902>>>>>>>        Property String  psDocumentation         ""
14903>>>>>>>        Property Boolean pbDocumentStyle        True // if True document, false RPC
14904>>>>>>>
14904>>>>>>>        Property string  psWebServiceMetaDataURI "http://www.dataaccess.com/schemas/WebServiceMetaData"
14905>>>>>>>
14905>>>>>>>        // This will only happen if there is a programming class bug
14905>>>>>>>        If (ghInetSession=0) Begin
14907>>>>>>>            Error DFERR_PROGRAM C_$MissingISO
14908>>>>>>>>
14908>>>>>>>            Abort
14909>>>>>>>>
14909>>>>>>>        End
14909>>>>>>>>
14909>>>>>>>
14909>>>>>>>        // register object as a WebService
14909>>>>>>>        Get Object_Label To sWSOName
14910>>>>>>>        Send Set_Wso_Data To ghInetSession sWSOName self
14911>>>>>>>
14911>>>>>>>
14911>>>>>>>        // creates call interface object and message support for this class including
14911>>>>>>>        // register interface.
14911>>>>>>>        // all access is through property phoCallInterface
14911>>>>>>>        Send DefineCallInterfaceHelper_mixin
14912>>>>>>>        // Tells callInterface to do datatype conversions with XML data
14912>>>>>>>        Set pbConvertXML to True
14913>>>>>>>
14913>>>>>>>    End_Procedure  //Construct_Object
14914>>>>>>>
14914>>>>>>>    Import_class_protocol cCallInterfaceHelper_mixin
14915>>>>>>>
14915>>>>>>>    // A web-service exception (soap fault) is generated by calling this message with
14915>>>>>>>    // error text and then exiting the function.
14915>>>>>>>
14915>>>>>>>    Procedure WebServiceException string sError
14917>>>>>>>        send WebServiceException of oCallInterface sError
14918>>>>>>>    end_procedure
14919>>>>>>>
14919>>>>>>>
14919>>>>>>>    // These three messages are directed from the callinterface object to here via the
14919>>>>>>>    // phoWebServiceImplementor property. This means that WOs handle this making it easier
14919>>>>>>>    // to augment
14919>>>>>>>
14919>>>>>>>    Function DeserializeXml Address aXml string sDataType Returns Handle
14921>>>>>>>        Integer hoXml
14921>>>>>>>        Get Create U_cXmlDomDocument to hoXml
14922>>>>>>>        Get LoadXmlFromAddress of hoXml aXml to windowindex
14923>>>>>>>        Function_Return hoXml
14924>>>>>>>    End_Function
14925>>>>>>>
14925>>>>>>>    Function SerializeXml Handle hObj string sDataType Returns Address
14927>>>>>>>        Address aXml
14927>>>>>>>        if (hObj);            Get paXml of hObj to aXml
14930>>>>>>>        Function_Return aXml
14931>>>>>>>    End_Function
14932>>>>>>>
14932>>>>>>>    Procedure DisposeObject Handle hObj
14934>>>>>>>        if (hObj);            Send Destroy of hObj
14937>>>>>>>    End_Procedure
14938>>>>>>>
14938>>>>>>>    Procedure LogEvent Integer iEventType String lpszEvent
14940>>>>>>>        Send LogEvent To ghInetSession iEventType lpszEvent
14941>>>>>>>        End_Procedure
14942>>>>>>>
14942>>>>>>>    Procedure LogErrorEvent Integer iErr String sText
14944>>>>>>>       Send LogErrorEvent To ghInetSession iErr sText
14945>>>>>>>    End_Procedure
14946>>>>>>>
14946>>>>>>>    // Pass these properties to ISO. This makes it easier to debug
14946>>>>>>>
14946>>>>>>>    //{ MethodType=Property }
14946>>>>>>>//    Function pbVerboseErrors Returns Integer
14946>>>>>>>//       Function_Return (pbVerboseErrors(ghInetSession))
14946>>>>>>>//    End_Function
14946>>>>>>>
14946>>>>>>>//    //Doc/ Visibility=Public MethodType=Property
14946>>>>>>>//    Procedure Set pbVerboseErrors Integer bState
14946>>>>>>>//       Set pbVerboseErrors Of ghInetSession To bState
14946>>>>>>>//    End_Procedure
14946>>>>>>>
14946>>>>>>>    Function pbAllErrorsToEventLog Returns Integer
14948>>>>>>>       Function_Return (pbAllErrorstoEventLog(ghInetSession))
14949>>>>>>>    End_Function
14950>>>>>>>
14950>>>>>>>    Procedure Set pbAllErrorsToEventLog Integer bState
14952>>>>>>>       Set pbAllErrorstoEventLog Of ghInetSession To bState
14953>>>>>>>    End_Procedure
14954>>>>>>>
14954>>>>>>>    Function pbAllErrorsToLocal Returns Integer
14956>>>>>>>       Function_Return (pbAllErrorstoLocal(ghInetSession))
14957>>>>>>>    End_Function
14958>>>>>>>
14958>>>>>>>    Procedure Set pbAllErrorsToLocal Integer bState
14960>>>>>>>       Set pbAllErrorstoLocal Of ghInetSession To bState
14961>>>>>>>    End_Procedure
14962>>>>>>>
14962>>>>>>>    Procedure AddServiceTypeDefinitions handle hoRoot string sNSPre string sNsURI
14964>>>>>>>        String sXml
14964>>>>>>>        Handle hoXml hoDoc
14964>>>>>>>        Boolean bOk
14964>>>>>>>        Get InterfaceTypeDefinitions sNsPre sNsURI to sXml
14965>>>>>>>        Get Create U_cXmlDomDocument to hoXml
14966>>>>>>>        Get LoadXml of hoXml sXml to bOk
14967>>>>>>>        If (bOk) Begin
14969>>>>>>>            Get DocumentElement of hoXml to hoDoc
14970>>>>>>>            Get AppendNode of hoRoot hoDoc to bOk
14971>>>>>>>            Send Destroy to hoDoc
14972>>>>>>>        End
14972>>>>>>>>
14972>>>>>>>        Send Destroy to hoXml
14973>>>>>>>    End_Procedure
14974>>>>>>>
14974>>>>>>>    Procedure AddServiceOperations handle hoRoot string sNSPre string sNsURI
14976>>>>>>>        integer iCount iItem
14976>>>>>>>        String sMethodName
14976>>>>>>>        String sMethodType
14976>>>>>>>        //String sParams
14976>>>>>>>        String sComment
14976>>>>>>>        Boolean bExtended
14976>>>>>>>        handle hoOperation
14976>>>>>>>
14976>>>>>>>        Get InterfaceMessageCount to iCount
14977>>>>>>>
14977>>>>>>>        For iItem From 0 to (iCount-1)
14983>>>>>>>>
14983>>>>>>>
14983>>>>>>>            Get InterfaceMessageIsExtended iItem to bExtended
14984>>>>>>>            If not bExtended Begin
14986>>>>>>>                Error DFERR_PROGRAM C_$ParamsMustBeExtended
14987>>>>>>>>
14987>>>>>>>                Procedure_return
14988>>>>>>>            End
14988>>>>>>>>
14988>>>>>>>
14988>>>>>>>            Get InterfaceMessageName       iItem to sMethodName
14989>>>>>>>            //Get InterfaceMessageParams     iItem to sParams
14989>>>>>>>            Get InterfaceMessageComment    iItem to sComment
14990>>>>>>>
14990>>>>>>>            If (sMethodName<>"get_WebServiceMetaData") Begin
14992>>>>>>>                // Split the "raw" method name into sMethodType and
14992>>>>>>>                // real method name. Raw method name is of the format:
14992>>>>>>>                //    get_MethodName, set_MethodName or msg_MethodName.
14992>>>>>>>                Move (lowercase(Left  (sMethodName, 3)))  To sMethodType
14993>>>>>>>                Move (Remove(sMethodName, 1, 4))         To sMethodName
14994>>>>>>>
14994>>>>>>>                Get  AddElementNS of hoRoot sNsURI (sNSPre+"operation") "" to hoOperation
14995>>>>>>>                Send AddAttribute of hoOperation "name"       sMethodName
14996>>>>>>>                Send AddAttribute of hoOperation "methodType" sMethodType
14997>>>>>>>                If (sComment<>"") Begin
14999>>>>>>>                    Send AddElementNS of hoOperation sNsURI (sNSPre+"documentation") sComment
15000>>>>>>>                end
15000>>>>>>>>
15000>>>>>>>
15000>>>>>>>                //Send AddOperationParameters hoOperation sNSPre sNsURI sParams
15000>>>>>>>                Send AddOperationParameters hoOperation sNSPre sNsURI iItem
15001>>>>>>>                Send Destroy of hoOperation
15002>>>>>>>            end
15002>>>>>>>>
15002>>>>>>>        Loop
15003>>>>>>>>
15003>>>>>>>     end_procedure
15004>>>>>>>
15004>>>>>>>    Procedure AddOperationParameters  Integer hoOperation String sNSPre string sNsURI Integer iMethodIndex
15006>>>>>>>        Integer iParam iParamCount iParamType iDimCount
15006>>>>>>>        Boolean bParamByRef
15006>>>>>>>        String  sParamType sParamName
15006>>>>>>>        Handle hoParam
15006>>>>>>>        Get InterfaceMessageParamCount iMethodIndex to iParamCount
15007>>>>>>>        For iParam from 0 to iParamCount
15013>>>>>>>>
15013>>>>>>>            Get InterfaceMessageParamType iMethodIndex iParam to iParamType
15014>>>>>>>            Get InterfaceMessageParamTypeName iMethodIndex iParam to sParamType
15015>>>>>>>            Get InterfaceMessageParamDimCount iMethodIndex iParam to iDimCount
15016>>>>>>>            If (iParam=iParamCount) Begin
15018>>>>>>>                // If the paramtype is xsNoParam (-1) then we don't have a return parameter (i.e., it's a procedure)
15018>>>>>>>                If (iParamType<>xsEmpty) begin
15020>>>>>>>                    //Return type
15020>>>>>>>                    If (iParamType=xsStruct) Begin
15022>>>>>>>                        Send AddAttribute of hoOperation "returnTypeRef" sParamType
15023>>>>>>>                    End
15023>>>>>>>>
15023>>>>>>>                    Else Begin
15024>>>>>>>                        Move (Lowercase(sParamType)) to sParamType
15025>>>>>>>                        if (sParamType="xmlhandle");                            Move "xml" to sParamType
15028>>>>>>>                        Send AddAttribute of hoOperation "returnType" sParamType
15029>>>>>>>                    End
15029>>>>>>>>
15029>>>>>>>                    If (iDimCount) Begin
15031>>>>>>>                        Send AddAttribute of hoOperation "returnTypeArrayDimCount" iDimCount
15032>>>>>>>                    End
15032>>>>>>>>
15032>>>>>>>                End
15032>>>>>>>>
15032>>>>>>>            End
15032>>>>>>>>
15032>>>>>>>            Else Begin
15033>>>>>>>                //Parameter
15033>>>>>>>                Get  AddElementNS of hoOperation sNsURI (sNSPre+"parameter") "" to hoParam
15034>>>>>>>                Get InterfaceMessageParamName iMethodIndex iParam to sParamName
15035>>>>>>>                Send AddAttribute of hoParam  "name" sParamName
15036>>>>>>>                If (iParamType=xsStruct) Begin
15038>>>>>>>                    Send AddAttribute of hoParam  "typeRef" sParamType
15039>>>>>>>                End
15039>>>>>>>>
15039>>>>>>>                Else Begin
15040>>>>>>>                    Move (Lowercase(sParamType)) to sParamType
15041>>>>>>>                    if (sParamType="xmlhandle");                        Move "xml" to sParamType
15044>>>>>>>                    Send AddAttribute of hoParam  "type" sParamType
15045>>>>>>>                End
15045>>>>>>>>
15045>>>>>>>                If (iDimCount) Begin
15047>>>>>>>                    Send AddAttribute of hoParam "arrayDimCount" iDimCount
15048>>>>>>>                End
15048>>>>>>>>
15048>>>>>>>                Get InterfaceMessageParamByRef iMethodIndex iParam to bParamByRef
15049>>>>>>>                If (bParamByRef) Begin
15051>>>>>>>                    Send AddAttribute of hoParam "byref" "true"
15052>>>>>>>                End
15052>>>>>>>>
15052>>>>>>>                Send Destroy      of hoParam
15053>>>>>>>            End
15053>>>>>>>>
15053>>>>>>>        Loop
15054>>>>>>>>
15054>>>>>>>    End_Procedure
15055>>>>>>>
15055>>>>>>>    // see WebServiceMetaData.xsd for a description of what needs to be generated here!
15055>>>>>>>
15055>>>>>>>    Function WebServiceMetaData Returns String
15057>>>>>>>        String sWebServiceMetaDataURI sServiceURI sServiceTitle sDocumentation sServiceName
15057>>>>>>>        String sXml
15057>>>>>>>        handle hoXML hoRoot hoOperation hoParam
15057>>>>>>>        string sNsPre
15057>>>>>>>        Boolean bDocumentStyle
15057>>>>>>>
15057>>>>>>>        Get psWebServiceMetaDataURI to sWebServiceMetaDataURI
15058>>>>>>>        Get psServiceName           to sServiceName
15059>>>>>>>        Get psServiceURI            to sServiceURI
15060>>>>>>>        Get psServiceTitle          to sServiceTitle
15061>>>>>>>        Get psDocumentation         to sDocumentation
15062>>>>>>>        Get pbDocumentStyle         to bDocumentStyle
15063>>>>>>>
15063>>>>>>>        Move "wso:" to sNsPre
15064>>>>>>>        Get Create U_cXmlDomDocument to hoXml
15065>>>>>>>        Get CreateDocumentElementNS of hoXml sWebServiceMetaDataURI (sNsPre+"webServiceObject") to hoRoot
15066>>>>>>>        Send AddAttribute of hoRoot "name"      sServiceName
15067>>>>>>>        Send AddAttribute of hoRoot "title"     sServiceTitle
15068>>>>>>>        Send AddAttribute of hoRoot "namespace" sServiceURI
15069>>>>>>>        Send AddAttribute of hoRoot "soapBodyStyle" (if(bDocumentStyle,"document","rpc"))
15070>>>>>>>        Send AddElementNS of hoRoot sWebServiceMetaDataURI (sNsPre+"documentation") sDocumentation
15071>>>>>>>        Send AddServiceTypeDefinitions hoRoot sNsPre sWebServiceMetaDataURI
15072>>>>>>>        Send AddServiceOperations hoRoot sNsPre sWebServiceMetaDataURI
15073>>>>>>>        Get  psXml   of hoRoot to sXml
15074>>>>>>>        send destroy of hoRoot
15075>>>>>>>        send destroy of hoXml
15076>>>>>>>        Function_Return sXml
15077>>>>>>>    End_Function
15078>>>>>>>
15078>>>>>>>    Function SoapHeaderRequestNode Returns Handle
15080>>>>>>>        Address pVDFISData pData
15080>>>>>>>        Integer iTemp
15080>>>>>>>        Handle hoXml
15080>>>>>>>        Boolean bOk bKeepAlive
15080>>>>>>>        
15080>>>>>>>        Get WebServiceRequestHeaders of ghInetSession to pVDFISData
15081>>>>>>>        If (pVDFISData=0) Begin
15083>>>>>>>            Send LogErrorEvent DFERR_WEBAPP_BAD_PARAMETER C_$pVDFISDataIsNull
15084>>>>>>>            Function_Return 0
15085>>>>>>>        End
15085>>>>>>>>
15085>>>>>>>
15085>>>>>>>        Get VDFISData_pData pVDFISData to pData
15086>>>>>>>        If (pData<>0) Begin
15088>>>>>>>            Get Create of Desktop U_cXmlDomDocument to hoXml
15089>>>>>>>            Get LoadXMLFromAddress of hoXml pData to bOk
15090>>>>>>>            //TODO - Add the error message to language .inc file
15090>>>>>>>            If (not(bOk));                Send LogErrorEvent DFERR_WEBAPP_BAD_PARAMETER C_$InvalidSOAPRequestHeader
15093>>>>>>>
15093>>>>>>>            Move (DeRefDW(pVDFISData, VDFISData.bKeepAlive)) to bKeepAlive
15094>>>>>>>            If (not(bKeepAlive));                Move (Free(pData)) to iTemp
15097>>>>>>>        End
15097>>>>>>>>
15097>>>>>>>        Move (Free(pVDFISData)) to iTemp
15098>>>>>>>
15098>>>>>>>        Function_Return hoXml
15099>>>>>>>    End_Function
15100>>>>>>>
15100>>>>>>>    Procedure AddSoapHeaderNode Handle hoNode
15102>>>>>>>        Address pData
15102>>>>>>>        Boolean bOK
15102>>>>>>>        
15102>>>>>>>        // if node is not passed or it is not an element, this is an error
15102>>>>>>>        If (hoNode=0 or piNodeType(hoNode)<>NODE_ELEMENT) Begin
15104>>>>>>>            //TODO - Add the error message to language .inc file
15104>>>>>>>            Send LogErrorEvent DFERR_WEBAPP_BAD_PARAMETER C_$CannotAddSOAPResponseHeader1
15105>>>>>>>            Procedure_Return
15106>>>>>>>        End
15106>>>>>>>>
15106>>>>>>>
15106>>>>>>>        Get paXml of hoNode to pData
15107>>>>>>>        // this should be very rare. For some reason an xml node of type element could not be converted to pData
15107>>>>>>>        If (not(pData)) Begin
15109>>>>>>>            //TODO - Add the error message to language .inc file
15109>>>>>>>            Send LogErrorEvent DFERR_WEBAPP_BAD_PARAMETER C_$CannotAddSOAPResponseHeader2 
15110>>>>>>>            Procedure_Return
15111>>>>>>>        End
15111>>>>>>>>
15111>>>>>>>        Send AddWebServiceResponseHeader of ghInetSession pData
15112>>>>>>>        Move (Free(pData)) to bOK
15113>>>>>>>    End_Procedure
15114>>>>>>>
15114>>>>>>>    Function ServerVariable String sVariableName Returns String
15116>>>>>>>        String sVal
15116>>>>>>>        Address pVar pData
15116>>>>>>>        Integer iTemp bKeepAlive
15116>>>>>>>
15116>>>>>>>        Get HttpServerVariable of ghInetSession sVariableName to pVar
15117>>>>>>>        Get Copy_VDFISDATAtoString pVar to sVal
15118>>>>>>>
15118>>>>>>>        //Cleanup memory
15118>>>>>>>        If (pVar) Begin
15120>>>>>>>
15120>>>>>>>            Get VDFISData_pData pVar to pData
15121>>>>>>>            Move (DeRefDW(pVar, VDFISData.bKeepAlive)) to bKeepAlive
15122>>>>>>>            If ( (pData) and (not(bKeepAlive)) );                Move (Free(pData)) to iTemp
15125>>>>>>>            Move (Free(pVar)) to iTemp
15126>>>>>>>        End
15126>>>>>>>>
15126>>>>>>>        Function_Return sVal
15127>>>>>>>    End_Function
15128>>>>>>>    
15128>>>>>>>    Procedure End_Construct_Object
15130>>>>>>>        Send RegisterInterface get_WebServiceMetaData "get_WebServiceMetaData" " Returns string" ""
15131>>>>>>>        Forward send End_construct_object
15133>>>>>>>    end_procedure
15134>>>>>>>
15134>>>>>>>End_Class
15135>>>>>
15135>>>>>Use AjaxDataStructures.pkg
15135>>>>>Use cAjaxWsErrorHandler.pkg
Including file: cAjaxWsErrorHandler.pkg    (C:\Program Files\Visual DataFlex AJAX Library 2.2\AppSrc\cAjaxWsErrorHandler.pkg)
15135>>>>>>>//
15135>>>>>>>//  The Error handler is used by webservice interface of the application data 
15135>>>>>>>//  service manager (cAjaxWebserviceInterface) to collect the errors that occur 
15135>>>>>>>//  during the processing of requests. They are saved in an array of error 
15135>>>>>>>//  structs wich is returned when finished collecting.
15135>>>>>>>//
15135>>>>>>>//  Since:
15135>>>>>>>//      25/11/2004
15135>>>>>>>//  Changed:
15135>>>>>>>//      --
15135>>>>>>>//  Version:
15135>>>>>>>//      0.1
15135>>>>>>>//  Created:
15135>>>>>>>//      Data Access Europe (Harm Wibier)
15135>>>>>>>//
15135>>>>>>>
15135>>>>>>>Class cAjaxWsErrorHandler is a cObject
15136>>>>>>>    Procedure Construct_Object
15138>>>>>>>        Forward Send Construct_Object
15140>>>>>>>
15140>>>>>>>        // This property MUST be created within the object or the object's class.
15140>>>>>>>        Property Integer Error_processing_state False
15141>>>>>>>        Property Integer phOrigErrorHandler
15142>>>>>>>        Property Boolean pbForward True
15143>>>>>>>        //  For collecting the errors
15143>>>>>>>        Property TAjaxError[] ptaErrors
15144>>>>>>>    End_Procedure  // Construct_Object
15145>>>>>>>
15145>>>>>>>
15145>>>>>>>
15145>>>>>>>    //
15145>>>>>>>    //  Is called by vdf on errors. It searches additional information and 
15145>>>>>>>    //  saves the error. If needed the error is forwarded.
15145>>>>>>>    //
15145>>>>>>>    //  Params:
15145>>>>>>>    //      iErrNum     Error number
15145>>>>>>>    //      iErrLine    Line where the error occured
15145>>>>>>>    //      sErrText    Additional error text
15145>>>>>>>    //
15145>>>>>>>    Procedure Error_Report Integer iErrNum Integer iErrLine String sErrText
15147>>>>>>>        String sSystemErr sFile sField
15147>>>>>>>        Boolean bForward
15147>>>>>>>        Integer hOrrigErrorHandler iErrFile iErrField
15147>>>>>>>
15147>>>>>>>        // if we are already within an error, do nothing
15147>>>>>>>        If (error_processing_state(Self)) Procedure_Return
15150>>>>>>>        // mark that we are now processing an error
15150>>>>>>>        Set error_processing_State to True
15151>>>>>>>
15151>>>>>>>        //  Get message
15151>>>>>>>        Get Error_Description iErrNum sErrText  to sSystemErr
15152>>>>>>>
15152>>>>>>>        //  Get file and field names if available
15152>>>>>>>        If ghoErrorSource Begin
15154>>>>>>>            Get Extended_Error_file   of ghoErrorSource to iErrFile
15155>>>>>>>            Get Extended_Error_Field  of ghoErrorSource to iErrField
15156>>>>>>>            If (iErrFile>0) Begin
15158>>>>>>>                Get_Attribute DF_FILE_LOGICAL_NAME of iErrFile to sFile
15161>>>>>>>                If (iErrField>0) Begin
15163>>>>>>>                    Get_Attribute DF_FIELD_NAME of iErrFile iErrField to sField
15166>>>>>>>                End
15166>>>>>>>>
15166>>>>>>>            End
15166>>>>>>>>
15166>>>>>>>        End
15166>>>>>>>>
15166>>>>>>>
15166>>>>>>>        // perform custom error handling
15166>>>>>>>        Send SaveError iErrNum iErrLine sSystemErr sFile sField
15167>>>>>>>
15167>>>>>>>        Get pbForward to bForward
15168>>>>>>>        If (bForward) Begin
15170>>>>>>>            Get phOrigErrorHandler to hOrrigErrorHandler
15171>>>>>>>            Send Error_report to hOrrigErrorHandler iErrNum iErrLine sErrText
15172>>>>>>>        End
15172>>>>>>>>
15172>>>>>>>
15172>>>>>>>        // mark that we are no longer processing an error
15172>>>>>>>        Set error_processing_State to False
15173>>>>>>>    End_Procedure
15174>>>>>>>
15174>>>>>>>    //
15174>>>>>>>    //  Used to fetch the default error description.
15174>>>>>>>    //
15174>>>>>>>    //  Param:
15174>>>>>>>    //      iError      Error number
15174>>>>>>>    //      sMessage    Additional error message
15174>>>>>>>    //  Returns:
15174>>>>>>>    //      Complete error message
15174>>>>>>>    //
15174>>>>>>>    Function Error_Description Integer iError String sMessage Returns String
15176>>>>>>>        String sDescription
15176>>>>>>>        Boolean bAvailable
15176>>>>>>>        
15176>>>>>>>        //  Fetch system error text
15176>>>>>>>        Get Error_Text of Desktop iError to sDescription
15177>>>>>>>        Get Error_Text_Available of Desktop iError to bAvailable
15178>>>>>>>        
15178>>>>>>>        //  Trim both messages
15178>>>>>>>        Move (Trim(sDescription)) to sDescription
15179>>>>>>>        Move (Trim(sMessage)) to sMessage
15180>>>>>>>        
15180>>>>>>>        //  Append message if needed
15180>>>>>>>        If (sMessage <> "") Begin
15182>>>>>>>            If (sDescription <> "" and bAvailable) Begin
15184>>>>>>>                Move (sDescription + " " + sMessage) to sDescription
15185>>>>>>>            End
15185>>>>>>>>
15185>>>>>>>            Else Begin
15186>>>>>>>                Move sMessage to sDescription
15187>>>>>>>            End
15187>>>>>>>>
15187>>>>>>>        End
15187>>>>>>>>
15187>>>>>>>        
15187>>>>>>>        Function_Return sDescription
15188>>>>>>>    End_Function
15189>>>>>>>
15189>>>>>>>    //
15189>>>>>>>    //  Adds the error to the array.
15189>>>>>>>    //
15189>>>>>>>    //  Params:
15189>>>>>>>    //      iErrNum     Error number
15189>>>>>>>    //      iErrLine    Error line
15189>>>>>>>    //      sErrText    Error message
15189>>>>>>>    //      sFile       File to wich the error belongs
15189>>>>>>>    //      sField      Field to wich the error belongs
15189>>>>>>>    //
15189>>>>>>>    Procedure SaveError Integer iErrNum Integer iErrLine String sErrText String sFile String sField
15191>>>>>>>        Integer iNum
15191>>>>>>>        TAjaxError[] taErrors
15191>>>>>>>        TAjaxError[] taErrors
15192>>>>>>>
15192>>>>>>>        Get ptaErrors to taErrors
15193>>>>>>>        Move (SizeOfArray(taErrors)) to iNum
15194>>>>>>>
15194>>>>>>>        Move iErrNum to taErrors[iNum].iNumber
15195>>>>>>>        Move iErrLine to taErrors[iNum].iLine
15196>>>>>>>        Move sErrText to taErrors[iNum].sErrorText
15197>>>>>>>        Move sFile to taErrors[iNum].sTableName
15198>>>>>>>        Move sField to taErrors[iNum].sColumnName
15199>>>>>>>        Set ptaErrors to taErrors
15200>>>>>>>    End_Procedure
15201>>>>>>>
15201>>>>>>>    //
15201>>>>>>>    //  Starts fetching the errors by setting this object as the error handler
15201>>>>>>>    //  and clearing the error array.
15201>>>>>>>    //
15201>>>>>>>    Procedure StartRecording
15203>>>>>>>        TAjaxError[] taErrors
15203>>>>>>>        TAjaxError[] taErrors
15204>>>>>>>        Set ptaErrors to taErrors
15205>>>>>>>
15205>>>>>>>        If (Error_object_id <> Self) Begin
15207>>>>>>>            Set phOrigErrorHandler to Error_object_id
15208>>>>>>>            Move Self to Error_object_id
15209>>>>>>>        End
15209>>>>>>>>
15209>>>>>>>    End_Procedure
15210>>>>>>>
15210>>>>>>>    //
15210>>>>>>>    //  Stops fetching the error by resetting the orrigional error handler.
15210>>>>>>>    //
15210>>>>>>>    //  Returns:
15210>>>>>>>    //      Array with error structs of occured errors
15210>>>>>>>    //
15210>>>>>>>    Function FinishRecording Returns TAjaxError[]
15212>>>>>>>        TAjaxError[] taErrors
15212>>>>>>>        TAjaxError[] taErrors
15213>>>>>>>
15213>>>>>>>        If (Error_object_id = Self) Begin
15215>>>>>>>            Get phOrigErrorHandler to Error_object_id
15216>>>>>>>        End
15216>>>>>>>>
15216>>>>>>>
15216>>>>>>>        Get ptaErrors to taErrors
15217>>>>>>>        Function_Return taErrors
15218>>>>>>>    End_Function
15219>>>>>>>
15219>>>>>>>End_Class
15220>>>>>Use cAjaxWebBusinessProcess.pkg
15220>>>>>Use cAjaxSessionManager.pkg
15220>>>>>
15220>>>>>
15220>>>>>
15220>>>>>//
15220>>>>>//  Base class for Application Data Webservices. It extends cWebService because
15220>>>>>//  it is an webservice. Contains methods (that are published in the 
15220>>>>>//  constructor) used by the AJAX Javascript framework to access the VDF data
15220>>>>>//  (dictionaries) in different webobjects.
15220>>>>>//
15220>>>>>Class cAjaxWebserviceInterface is a cWebService
15221>>>>>    Procedure Construct_Object
15223>>>>>        Forward Send Construct_Object
15225>>>>>
15225>>>>>        Set psDocumentation to "Visual DataFlex AJAX Library Web Service"
15226>>>>>        Set psServiceTitle to "Visual DataFlex AJAX Library Web Service"
15227>>>>>        Set psServiceName to "WebService"
15228>>>>>        
15228>>>>>        Property Handle phoErrorHandler 0
15229>>>>>        Property Handle phoSessionManager 0
15230>>>>>
15230>>>>>        Object oErrorHandler is a cAjaxWsErrorHandler
15232>>>>>            Set phoErrorHandler to Self
15233>>>>>        End_Object
15234>>>>>
15234>>>>>    End_Procedure
15235>>>>>    
15235>>>>>    //
15235>>>>>    //  Retrieves the global information from the web object after performing 
15235>>>>>    //  the version check.
15235>>>>>    //
15235>>>>>    //  Params:
15235>>>>>    //      sSessionKey Unique key identifying the session.
15235>>>>>    //      sWebObject  Name of the web object.
15235>>>>>    //      sVersion    Version used by the client
15235>>>>>    //  Returns:
15235>>>>>    //      TAjaxMetaWO struct with the global WO information.
15235>>>>>    //
15235>>>>>    Function MetaDataWO String sSessionKey String sWebObject String sVersion Returns TAjaxMetaWO
15237>>>>>        TAjaxMetaWO tResponse
15237>>>>>        TAjaxMetaWO tResponse
15237>>>>>        Handle hoErrorHandler hoSessionManager hoWO
15237>>>>>        String sServerVersion
15237>>>>>        Integer iError
15237>>>>>        Boolean bResult
15237>>>>>        
15237>>>>>        
15237>>>>>        Get phoErrorHandler to hoErrorHandler
15238>>>>>            
15238>>>>>        //  Record errors
15238>>>>>        Send StartRecording of hoErrorHandler
15239>>>>>        
15239>>>>>        //  Check SessionManager       
15239>>>>>        Get phoSessionManager to hoSessionManager
15240>>>>>        If (hoSessionManager = 0) Begin
15242>>>>>            Error 5638 "Could not find Application Data Service management object (phoSessionManager)"
15243>>>>>>
15243>>>>>        End
15243>>>>>>
15243>>>>>        Else Begin
15244>>>>>            Get psVersion of hoSessionManager to sServerVersion
15245>>>>>            
15245>>>>>            If (sVersion = "" or sVersion = sServerVersion) Begin
15247>>>>>                Get GetAjaxWebObject sWebObject to hoWo
15248>>>>>                If (hoWo > 0) Begin
15250>>>>>                
15250>>>>>                    //  Validate session
15250>>>>>                    Get ValidateSession of hoSessionManager sSessionKey to iError
15251>>>>>                    If (iError = 0) Begin
15253>>>>>                        Get HasRights of hoSessionManager sSessionKey "meta" sWebObject "" to bResult
15254>>>>>                        
15254>>>>>                        If (bResult) Begin
15256>>>>>                            //  Get the tResponse information
15256>>>>>                            Get AjaxMetaData of hoWo to tResponse
15257>>>>>                            Move sWebObject to tResponse.sName
15258>>>>>                            Send GlobalMetaData of hoSessionManager (&tResponse)
15259>>>>>                        End
15259>>>>>>
15259>>>>>                        Else Begin
15260>>>>>                            Error 5646 ("Action not allowed: meta")
15261>>>>>>
15261>>>>>                        End
15261>>>>>>
15261>>>>>                    End 
15261>>>>>>
15261>>>>>                End
15261>>>>>>
15261>>>>>            End
15261>>>>>>
15261>>>>>            Else Begin
15262>>>>>                Error 5636 (SFormat("Client & Server versions do not match (client: %1, server: %2)", sVersion, sServerVersion))
15263>>>>>>
15263>>>>>            End
15263>>>>>>
15263>>>>>        End
15263>>>>>>
15263>>>>>        
15263>>>>>        //  Fetch erros
15263>>>>>        Get FinishRecording of hoErrorHandler to tResponse.aErrors
15264>>>>>        
15264>>>>>        Function_Return tResponse
15265>>>>>    End_Function
15266>>>>>    
15266>>>>>    
15266>>>>>    //
15266>>>>>    //  Retrieves the basic meta data for a set of fields.
15266>>>>>    //
15266>>>>>    //  Params:
15266>>>>>    //      sSessionKey Unique key identifying the session.
15266>>>>>    //      sWebObject  Name of the web object.
15266>>>>>    //      aFields     Array of field names (<table>.<field>)
15266>>>>>    //  Returns:
15266>>>>>    //      Struct with the requested information.
15266>>>>>    //      
15266>>>>>    Function MetaDataFields String sSessionKey String sWebObject String sFields Returns TAjaxMetaFields
15268>>>>>        TAjaxMetaFields tResponse
15268>>>>>        TAjaxMetaFields tResponse
15268>>>>>        Handle hoErrorHandler hoSessionManager hoWO
15268>>>>>        Integer iError
15268>>>>>        Boolean bResult
15268>>>>>        String[] aFields
15269>>>>>        
15269>>>>>        
15269>>>>>        Get phoErrorHandler to hoErrorHandler
15270>>>>>            
15270>>>>>        //  Record errors
15270>>>>>        Send StartRecording of hoErrorHandler
15271>>>>>        
15271>>>>>        //  Check SessionManager       
15271>>>>>        Get phoSessionManager to hoSessionManager
15272>>>>>        If (hoSessionManager = 0) Begin
15274>>>>>            Error 5638 "Could not find Application Data Service management object (phoSessionManager)"
15275>>>>>>
15275>>>>>        End
15275>>>>>>
15275>>>>>        Else Begin
15276>>>>>            Get GetAjaxWebObject sWebObject to hoWo
15277>>>>>            If (hoWo > 0) Begin
15279>>>>>            
15279>>>>>                //  Validate session
15279>>>>>                Get ValidateSession of hoSessionManager sSessionKey to iError
15280>>>>>                If (iError = 0) Begin
15282>>>>>                    Get HasRights of hoSessionManager sSessionKey "meta" sWebObject "" to bResult
15283>>>>>                    
15283>>>>>                    If (bResult) Begin
15285>>>>>                        Get StrSplit sFields "|" to aFields
15286>>>>>                        
15286>>>>>                        //  Get the tResponse information
15286>>>>>                        Get AjaxMetaFields of hoWO aFields to tResponse
15287>>>>>                    End
15287>>>>>>
15287>>>>>                    Else Begin
15288>>>>>                        Error 5646 ("Action not allowed: meta")
15289>>>>>>
15289>>>>>                    End
15289>>>>>>
15289>>>>>                End 
15289>>>>>>
15289>>>>>            End
15289>>>>>>
15289>>>>>        End
15289>>>>>>
15289>>>>>        
15289>>>>>        //  Fetch erros
15289>>>>>        Get FinishRecording of hoErrorHandler to tResponse.aErrors
15290>>>>>        
15290>>>>>        Function_Return tResponse
15291>>>>>    End_Function
15292>>>>>    
15292>>>>>    //
15292>>>>>    //  Fetches a set of properties for all the given fields.
15292>>>>>    //
15292>>>>>    //  Params:
15292>>>>>    //      sSessionKey     Unique key identifying the session.
15292>>>>>    //      sWebObject      Name of the web object.
15292>>>>>    //      aFields         Array of field names (<table>.<field>)
15292>>>>>    //      aProperties     Array with property names
15292>>>>>    //  Returns:
15292>>>>>    //      Struct with the properties.
15292>>>>>    //
15292>>>>>    Function MetaDataProperties String sSessionKey String sWebObject String[] aFields String[] aProperties Returns TAjaxMetaProperties
15294>>>>>        TAjaxMetaProperties tResult
15294>>>>>        TAjaxMetaProperties tResult
15294>>>>>        Handle hoErrorHandler hoSessionManager hoWO
15294>>>>>        Integer iError
15294>>>>>        Boolean bResult
15294>>>>>        
15294>>>>>        
15294>>>>>        Get phoErrorHandler to hoErrorHandler
15295>>>>>            
15295>>>>>        //  Record errors
15295>>>>>        Send StartRecording of hoErrorHandler
15296>>>>>        
15296>>>>>        //  Check SessionManager       
15296>>>>>        Get phoSessionManager to hoSessionManager
15297>>>>>        If (hoSessionManager = 0) Begin
15299>>>>>            Error 5638 "Could not find Application Data Service management object (phoSessionManager)"
15300>>>>>>
15300>>>>>        End
15300>>>>>>
15300>>>>>        Else Begin
15301>>>>>            Get GetAjaxWebObject sWebObject to hoWo
15302>>>>>            If (hoWo > 0) Begin
15304>>>>>            
15304>>>>>                //  Validate session
15304>>>>>                Get ValidateSession of hoSessionManager sSessionKey to iError
15305>>>>>                If (iError = 0) Begin
15307>>>>>                    Get HasRights of hoSessionManager sSessionKey "meta" sWebObject "" to bResult
15308>>>>>                    
15308>>>>>                    If (bResult) Begin
15310>>>>>                        //  Get the tResponse information
15310>>>>>                        Get AjaxMetaProperties of hoWO aFields aProperties to tResult
15311>>>>>                    End
15311>>>>>>
15311>>>>>                    Else Begin
15312>>>>>                        Error 5646 ("Action not allowed: meta")
15313>>>>>>
15313>>>>>                    End
15313>>>>>>
15313>>>>>                End 
15313>>>>>>
15313>>>>>            End
15313>>>>>>
15313>>>>>        End
15313>>>>>>
15313>>>>>        
15313>>>>>        //  Fetch erros
15313>>>>>        Get FinishRecording of hoErrorHandler to tResult.aErrors
15314>>>>>        
15314>>>>>        Function_Return tResult 
15315>>>>>    End_Function
15316>>>>>    
15316>>>>>    //
15316>>>>>    //  Fetches the description values for the given field.
15316>>>>>    //
15316>>>>>    //  Params:
15316>>>>>    //      sSessionKey     Unique key identifying the session.
15316>>>>>    //      sWebObject      Name of the web object.
15316>>>>>    //      sField          Name of the field (<table>.<field>)
15316>>>>>    //  Returns:
15316>>>>>    //      Structure with the requested meta data.
15316>>>>>    //
15316>>>>>    Function MetaDataDescriptionValues String sSessionKey String sWebObject String sField Returns TAjaxMetaDescriptionValues
15318>>>>>        TAjaxMetaDescriptionValues tResponse
15318>>>>>        TAjaxMetaDescriptionValues tResponse
15318>>>>>        Handle hoErrorHandler hoSessionManager hoWO
15318>>>>>        Integer iError
15318>>>>>        Boolean bResult
15318>>>>>        
15318>>>>>        
15318>>>>>        Get phoErrorHandler to hoErrorHandler
15319>>>>>            
15319>>>>>        //  Record errors
15319>>>>>        Send StartRecording of hoErrorHandler
15320>>>>>        
15320>>>>>        //  Check SessionManager       
15320>>>>>        Get phoSessionManager to hoSessionManager
15321>>>>>        If (hoSessionManager = 0) Begin
15323>>>>>            Error 5638 "Could not find Application Data Service management object (phoSessionManager)"
15324>>>>>>
15324>>>>>        End
15324>>>>>>
15324>>>>>        Else Begin
15325>>>>>            Get GetAjaxWebObject sWebObject to hoWo
15326>>>>>            If (hoWo > 0) Begin
15328>>>>>            
15328>>>>>                //  Validate session
15328>>>>>                Get ValidateSession of hoSessionManager sSessionKey to iError
15329>>>>>                If (iError = 0) Begin
15331>>>>>                    Get HasRights of hoSessionManager sSessionKey "meta" sWebObject "" to bResult
15332>>>>>                    
15332>>>>>                    If (bResult) Begin
15334>>>>>                        //  Get the tResponse information
15334>>>>>                        Get AjaxMetaDescriptionValues of hoWO sField to tResponse
15335>>>>>                    End
15335>>>>>>
15335>>>>>                    Else Begin
15336>>>>>                        Error 5646 ("Action not allowed: meta")
15337>>>>>>
15337>>>>>                    End
15337>>>>>>
15337>>>>>                End 
15337>>>>>>
15337>>>>>            End
15337>>>>>>
15337>>>>>        End
15337>>>>>>
15337>>>>>        
15337>>>>>        //  Fetch erros
15337>>>>>        Get FinishRecording of hoErrorHandler to tResponse.aErrors
15338>>>>>        
15338>>>>>        Function_Return tResponse 
15339>>>>>    End_Function
15340>>>>>
15340>>>>>
15340>>>>>    //
15340>>>>>    //  This method is published in the webservice and can be used to fire 
15340>>>>>    //  requests using the application data service system. The method splits 
15340>>>>>    //  the request and forwards the requestsets to the correct handling method
15340>>>>>    //  of the webobject. 
15340>>>>>    //
15340>>>>>    //  Parameters:
15340>>>>>    //      tRequestData        TAjaxRequestData structure that contains the request 
15340>>>>>    //                      information and requestsets.
15340>>>>>    //  Returns:
15340>>>>>    //      TAjaxResponseData structure that contains the result information of 
15340>>>>>    //      the requestsets and error information.
15340>>>>>    //
15340>>>>>    Function Request TAjaxRequestData tRequestData Returns TAjaxResponseData
15342>>>>>        TAjaxResponseData tResponseData
15342>>>>>        TAjaxResponseData tResponseData
15342>>>>>        TAjaxRequestSet tCurrentRequest
15342>>>>>        TAjaxRequestSet tCurrentRequest
15342>>>>>        Handle hoWo hoErrorHandler hoSessionManager
15342>>>>>        Integer iDataSets iDataSet iError
15342>>>>>        Boolean bResult
15342>>>>>        String sRightType
15342>>>>>    
15342>>>>>        Get phoErrorHandler to hoErrorHandler
15343>>>>>        
15343>>>>>        //  Record errors
15343>>>>>        Send StartRecording of hoErrorHandler
15344>>>>>        
15344>>>>>        //  Check SessionManager
15344>>>>>        Get phoSessionManager to hoSessionManager
15345>>>>>        If (hoSessionManager = 0) Begin
15347>>>>>            Error 5638 "Could not find Application Data Service management object (phoSessionManager)"
15348>>>>>>
15348>>>>>        End
15348>>>>>>
15348>>>>>        
15348>>>>>        //  Find the WO
15348>>>>>        Get GetAjaxWebObject tRequestData.sWebObject to hoWo
15349>>>>>        If (hoWo > 0 and hoSessionManager > 0) Begin
15351>>>>>        
15351>>>>>            //  Validate session
15351>>>>>            Get ValidateSession of hoSessionManager tRequestData.sSessionKey to iError
15352>>>>>            If (iError = 0) Begin
15354>>>>>                
15354>>>>>                //  Call initialisation methods of wo
15354>>>>>                Send AjaxRequestStart of hoWo (&tRequestData)
15355>>>>>    
15355>>>>>                //  Generate response sets for every requestset
15355>>>>>                Move (SizeOfArray(tRequestData.aDataSets) - 1) to iDataSets
15356>>>>>                For iDataSet from 0 to iDataSets
15362>>>>>>
15362>>>>>                    Move tRequestData.aDataSets[iDataSet] to tCurrentRequest
15363>>>>>                    
15363>>>>>                    
15363>>>>>                    Move tCurrentRequest.sRequestType to sRightType
15364>>>>>                    
15364>>>>>                    //  Rights module doesn't make a difference between findByRowId, findByField, initialFill and find
15364>>>>>                    If (sRightType = "findByRowId" or sRightType = "findByField" or sRightType = "initialFill") Begin
15366>>>>>                        Move "find" to sRightType
15367>>>>>                    End
15367>>>>>>
15367>>>>>                    
15367>>>>>                    If (sRightType = "clearAll") Begin
15369>>>>>                        Move "clear" to sRightType
15370>>>>>                    End
15370>>>>>>
15370>>>>>                    
15370>>>>>                    Get HasRights of hoSessionManager tRequestData.sSessionKey sRightType tRequestData.sWebObject "" to bResult
15371>>>>>                    If (bResult) Begin
15373>>>>>                        Send AjaxRequestSetStart of hoWo (&tCurrentRequest)
15374>>>>>                        
15374>>>>>                        //  Switch to correct handler
15374>>>>>                        Case Begin
15374>>>>>                            Case (tCurrentRequest.sRequestType = "find")
15376>>>>>                                Get AjaxFind of hoWo (&tCurrentRequest) to tResponseData.aDataSets[iDataSet]
15377>>>>>                                Case Break
15378>>>>>                            Case (tCurrentRequest.sRequestType = "findByRowId")
15381>>>>>                                Get AjaxFindByRowId of hoWo (&tCurrentRequest) to tResponseData.aDataSets[iDataSet]
15382>>>>>                                Case Break
15383>>>>>                            Case (tCurrentRequest.sRequestType = "findByField")
15386>>>>>                                Get AjaxFindByField of hoWo (&tCurrentRequest) to tResponseData.aDataSets[iDataSet]
15387>>>>>                                Case Break
15388>>>>>                            Case (tCurrentRequest.sRequestType = "initialFill")
15391>>>>>                                Get AjaxInitialFill of hoWo (&tCurrentRequest) to tResponseData.aDataSets[iDataSet]
15392>>>>>                                Case Break
15393>>>>>                            Case (tCurrentRequest.sRequestType = "save")
15396>>>>>                                Get AjaxSave of hoWo (&tCurrentRequest) to tResponseData.aDataSets[iDataSet]
15397>>>>>                                Case Break
15398>>>>>                            Case (tCurrentRequest.sRequestType = "clear")
15401>>>>>                                Get AjaxClear of hoWo (&tCurrentRequest) to tResponseData.aDataSets[iDataSet]
15402>>>>>                                Case Break
15403>>>>>                            Case (tCurrentRequest.sRequestType = "clearAll")
15406>>>>>                                Get AjaxClearAll of hoWo (&tCurrentRequest) to tResponseData.aDataSets[iDataSet]
15407>>>>>                                Case Break
15408>>>>>                            Case (tCurrentRequest.sRequestType = "delete")
15411>>>>>                                Get AjaxDelete of hoWo (&tCurrentRequest) to tResponseData.aDataSets[iDataSet]
15412>>>>>                                Case Break
15413>>>>>                            Case (tCurrentRequest.sRequestType = "dbcall")
15416>>>>>                                Get AjaxDbCall of hoWo (Self) (&tCurrentRequest) to tResponseData.aDataSets[iDataSet]
15417>>>>>                                Case Break 
15418>>>>>                            Case Else
15418>>>>>                                Error 905 ("Invalid RequestType:" * tCurrentRequest.sRequestType)
15419>>>>>>
15419>>>>>            
15419>>>>>                        Case End
15419>>>>>                        
15419>>>>>                        Send AjaxRequestSetEnd of hoWo (&tResponseData.aDataSets[iDataSet])
15420>>>>>                    End
15420>>>>>>
15420>>>>>                    Else Begin
15421>>>>>                        Error 5646 ("Action not allowed: " + sRightType)
15422>>>>>>
15422>>>>>                    End
15422>>>>>>
15422>>>>>                Loop
15423>>>>>>
15423>>>>>                
15423>>>>>                //  Give WO chance to recover from request
15423>>>>>                Send AjaxRequestEnd of hoWo (&tResponseData)
15424>>>>>            End
15424>>>>>>
15424>>>>>        End
15424>>>>>>
15424>>>>>
15424>>>>>        //  Fetch errors
15424>>>>>        Get FinishRecording of hoErrorHandler to tResponseData.aErrors
15425>>>>>        
15425>>>>>        //Sleep 2
15425>>>>>        Function_Return tResponseData
15426>>>>>    End_Function
15427>>>>>    
15427>>>>>    //
15427>>>>>    //  Method published in the webserver for validating a field. Records the 
15427>>>>>    //  validation errors and calls the AjaxValidateField method in the WO.
15427>>>>>    //
15427>>>>>    //  Params:
15427>>>>>    //      tRequest    Structure with the request information
15427>>>>>    //  Returns:
15427>>>>>    //      The response data structure including the occured errors
15427>>>>>    //
15427>>>>>    Function ValidateField TAjaxValidationRequest tRequest Returns TAjaxValidationResponse
15429>>>>>        Boolean bResult
15429>>>>>        Integer iError
15429>>>>>        TAjaxValidationResponse tResponse
15429>>>>>        TAjaxValidationResponse tResponse
15429>>>>>        Handle hoWo hoErrorHandler hoSessionManager
15429>>>>>        
15429>>>>>        Get phoErrorHandler to hoErrorHandler
15430>>>>>            
15430>>>>>        //  Record errors
15430>>>>>        Send StartRecording of hoErrorHandler
15431>>>>>        
15431>>>>>        //  Fetch and check SessionManager
15431>>>>>        Get phoSessionManager to hoSessionManager
15432>>>>>        If (hoSessionManager = 0) Begin
15434>>>>>            Error 5638 "Could not find Application Data Service management object (phoSessionManager)"
15435>>>>>>
15435>>>>>        End
15435>>>>>>
15435>>>>>
15435>>>>>        //  Fetch and check webobject
15435>>>>>        Get GetAjaxWebObject tRequest.sWebObject to hoWo
15436>>>>>        If (hoWo > 0 and hoSessionManager > 0) Begin
15438>>>>>        
15438>>>>>            //  Validate session
15438>>>>>            Get ValidateSession of hoSessionManager tRequest.sSessionKey to iError
15439>>>>>            If (iError = 0) Begin
15441>>>>>                Get HasRights of hoSessionManager tRequest.sSessionKey "meta" tRequest.sWebObject "" to bResult
15442>>>>>                
15442>>>>>                If (bResult) Begin
15444>>>>>                    //  Get the tResponse information
15444>>>>>                    Get AjaxValidateField of hoWo (&tRequest) to tResponse
15445>>>>>                End
15445>>>>>>
15445>>>>>                Else Begin
15446>>>>>                    Error 5646 ("Action not allowed: meta")
15447>>>>>>
15447>>>>>                End
15447>>>>>>
15447>>>>>            End 
15447>>>>>>
15447>>>>>        End
15447>>>>>>
15447>>>>>            
15447>>>>>        //  Fetch erros
15447>>>>>        Get FinishRecording of hoErrorHandler to tResponse.aErrors
15448>>>>>        
15448>>>>>        Function_Return tResponse
15449>>>>>    End_Function
15450>>>>>    
15450>>>>>    //
15450>>>>>    //  Method published in the webservice for calling webobject methods. The 
15450>>>>>    //  methods must be published. The Number of parameters given is limited to
15450>>>>>    //  16.
15450>>>>>    //
15450>>>>>    //  Params:
15450>>>>>    //      sWebObject      Name of the webobject
15450>>>>>    //      sSessionKey     Unique key that identifies the session
15450>>>>>    //      sMethodName     Name of the method that should be called
15450>>>>>    //      asParams        Array of parameters
15450>>>>>    //  Returns:
15450>>>>>    //      TAjaxRMIResponse structure containing occured errors and the return 
15450>>>>>    //      value.
15450>>>>>    //
15450>>>>>    Function RemoteMethodInvocation String sWebObject String sSessionKey String sMethodName String[] asParams Returns TAjaxRMIResponse
15452>>>>>        Boolean bResult
15452>>>>>        Integer iError iMessageItem iCount iParamCount iMessageId
15452>>>>>        TAjaxRMIResponse tResponse
15452>>>>>        TAjaxRMIResponse tResponse
15452>>>>>        Handle hoWo hoErrorHandler hoSessionManager
15452>>>>>        String sMessageName
15452>>>>>        
15452>>>>>        Get phoErrorHandler to hoErrorHandler
15453>>>>>            
15453>>>>>        //  Record errors
15453>>>>>        Send StartRecording of hoErrorHandler
15454>>>>>        
15454>>>>>        //  Fetch and check SessionManager
15454>>>>>        Get phoSessionManager to hoSessionManager
15455>>>>>        If (hoSessionManager > 0) Begin
15457>>>>>
15457>>>>>            //  Validate session
15457>>>>>            Get ValidateSession of hoSessionManager sSessionKey to iError
15458>>>>>            If (iError = 0) Begin
15460>>>>>                Get HasRights of hoSessionManager sSessionKey "rmi" sWebObject sMethodName to bResult
15461>>>>>                If (bResult) Begin
15463>>>>>
15463>>>>>                    //  Find & check WO
15463>>>>>                    Get Search_WPO_ID of oVdfInetSession sWebObject to hoWo
15464>>>>>                    If (hoWo > 0) Begin
15466>>>>>                        
15466>>>>>                        Get CallMethod hoWo sMethodName asParams to tResponse.sReturnValue
15467>>>>>                        
15467>>>>>                    End
15467>>>>>>
15467>>>>>                    Else Begin
15468>>>>>                        Error 5635 ("Invalid WebObject: " * sWebObject)
15469>>>>>>
15469>>>>>                    End
15469>>>>>>
15469>>>>>                End
15469>>>>>>
15469>>>>>                Else Begin
15470>>>>>                    Error 5646 ("Action not allowed: rmi")
15471>>>>>>
15471>>>>>                End
15471>>>>>>
15471>>>>>            End 
15471>>>>>>
15471>>>>>        End
15471>>>>>>
15471>>>>>        Else Begin
15472>>>>>            Error 5638 "Could not find Application Data Service management object (phoSessionManager)"
15473>>>>>>
15473>>>>>        End
15473>>>>>>
15473>>>>>
15473>>>>>        //  Fetch erros
15473>>>>>        Get FinishRecording of hoErrorHandler to tResponse.aErrors
15474>>>>>        
15474>>>>>        Function_Return tResponse
15475>>>>>    End_Function
15476>>>>>
15476>>>>>    
15476>>>>>    
15476>>>>>    
15476>>>>>    //
15476>>>>>    //  Loads tree nodes for the vdf.gui.AjaxTreeView client component. Calls 
15476>>>>>    //  the corresponding web Object for the nodes.
15476>>>>>    //
15476>>>>>    //  Params:
15476>>>>>    //      sWebObject      Name of the WO.
15476>>>>>    //      sSessionKey     Identifyer of the session.
15476>>>>>    //      sObjectName     Name of the tree object on the client.
15476>>>>>    //      sParentId       Identifyer of the parent node.
15476>>>>>    //      sParentValue    Value of the parent node.
15476>>>>>    //      iLevel          Level of the parent node.
15476>>>>>    //  Returns:
15476>>>>>    //      TAjaxTreeNodeResponse struct with the result.
15476>>>>>    //
15476>>>>>    Function LoadTreeNodes String sWebObject String sSessionKey String sObjectName String sParentId String sParentValue Integer iLevel Returns TAjaxTreeNodeResponse
15478>>>>>        Handle hoErrorHandler hoSessionManager hoWebObject hoWo
15478>>>>>        TAjaxTreeNodeResponse tResponse
15478>>>>>        TAjaxTreeNodeResponse tResponse
15478>>>>>        Integer iError
15478>>>>>        Boolean bResult
15478>>>>>        
15478>>>>>        Move sParentId to tResponse.sParentId
15479>>>>>        
15479>>>>>        Get phoErrorHandler to hoErrorHandler
15480>>>>>            
15480>>>>>        //  Record errors
15480>>>>>        Send StartRecording of hoErrorHandler
15481>>>>>        
15481>>>>>        //  Fetch and check SessionManager
15481>>>>>        Get phoSessionManager to hoSessionManager
15482>>>>>        
15482>>>>>        //  Find the WO
15482>>>>>        Get GetAjaxWebObject sWebObject to hoWo
15483>>>>>        If (hoWo > 0 and hoSessionManager > 0) Begin
15485>>>>>
15485>>>>>            //  Validate session
15485>>>>>            Get ValidateSession of hoSessionManager sSessionKey to iError
15486>>>>>            If (iError = 0) Begin
15488>>>>>                
15488>>>>>                //  Validate rights
15488>>>>>                Get HasRights of hoSessionManager sSessionKey "tree" sWebObject "AjaxLoadTreeNodes" to bResult
15489>>>>>                If (bResult) Begin
15491>>>>>                    
15491>>>>>                    //  Call the AjaxLoadtTreeNodes of this WO
15491>>>>>                    Get AjaxLoadTreeNodes of hoWo sObjectName sParentId sParentValue iLevel to tResponse.aNodes
15492>>>>>                End
15492>>>>>>
15492>>>>>                Else Begin
15493>>>>>                    Error 5646 ("Action not allowed: tree")
15494>>>>>>
15494>>>>>                End
15494>>>>>>
15494>>>>>            End
15494>>>>>>
15494>>>>>        End
15494>>>>>>
15494>>>>>        
15494>>>>>        //Sleep 1
15494>>>>>        
15494>>>>>        //  Fetch erros
15494>>>>>        Get FinishRecording of hoErrorHandler to tResponse.aErrors
15495>>>>>        
15495>>>>>        Function_Return tResponse
15496>>>>>    End_Function
15497>>>>>    
15497>>>>>    
15497>>>>>    
15497>>>>>    //
15497>>>>>    //  Searches the requested webobject and checks if it is a valid webobject 
15497>>>>>    //  that has application data service support (see cAjaxWebBusinessProcess).
15497>>>>>    //
15497>>>>>    //  Parameters:
15497>>>>>        //      sWebObject              Name of the webobject
15497>>>>>        //  Returns:
15497>>>>>        //      Handle to the webobject (0 if not a valid Ajax webobject)
15497>>>>>    //
15497>>>>>    Function GetAjaxWebObject String sWebObject Returns Handle
15499>>>>>        Handle hoWo
15499>>>>>        Integer iOrigMode iResult
15499>>>>>        
15499>>>>>        //  Try to find wo
15499>>>>>        Get Search_WPO_ID of oVdfInetSession sWebObject to hoWo
15500>>>>>        
15500>>>>>        If (hoWo > 0) Begin
15502>>>>>            
15502>>>>>            //  Check if instance of AjaxWebBusinessProcess by calling IsAjaxSupported method
15502>>>>>            Get Delegation_Mode of hoWo to iOrigMode
15503>>>>>            Set Delegation_Mode of hoWo to No_Delegate_Or_Error
15504>>>>>        
15504>>>>>            Get IsAjaxSupported of hoWo to iResult    
15505>>>>>        
15505>>>>>            Set Delegation_Mode of hoWo to iOrigMode
15506>>>>>            
15506>>>>>            //  Send errors
15506>>>>>            If (iResult <> 1) Begin
15508>>>>>                Move 0 to hoWo
15509>>>>>                Error 5640 ("WebObject doesn't implement the Ajax Library interface defined in cAjaxWebBusinessProcess: " * sWebObject)
15510>>>>>>
15510>>>>>            End    
15510>>>>>>
15510>>>>>        End 
15510>>>>>>
15510>>>>>        Else Begin
15511>>>>>            Error 5635 ("Invalid WebObject: " * sWebObject)
15512>>>>>>
15512>>>>>        End
15512>>>>>>
15512>>>>>        
15512>>>>>        Function_Return hoWo
15513>>>>>    End_Function
15514>>>>>    
15514>>>>>    //
15514>>>>>    //  Splits a string into an array of strings using the given delimeter.
15514>>>>>    //
15514>>>>>    //  Params:
15514>>>>>    //      sString     The string to split.
15514>>>>>    //      sDel        The delimiter (like "," or "|")
15514>>>>>    //  Returns:
15514>>>>>    //      Array of strings (not including the delimiters itself.
15514>>>>>    //
15514>>>>>    Function StrSplit String sString String sDel Returns String[]
15516>>>>>        String[] asResult
15517>>>>>        Integer iStart iEnd iDel
15517>>>>>        
15517>>>>>        If (sString <> "") Begin
15519>>>>>            
15519>>>>>            Move 1 to iStart
15520>>>>>            
15520>>>>>            If (sDel  <> "") Begin
15522>>>>>                Move (Length(sDel)) to iDel
15523>>>>>                Move (Pos(sDel, sString, iStart)) to iEnd
15524>>>>>                
15524>>>>>                While (iEnd > 0)
15528>>>>>                    Move (Mid(sString,  iEnd - iStart, iStart)) to asResult[SizeOfArray(asResult)]
15529>>>>>                    
15529>>>>>                    Move (iEnd + iDel) to iStart
15530>>>>>                    Move (Pos(sDel, sString, iStart)) to iEnd
15531>>>>>                Loop
15532>>>>>>
15532>>>>>                
15532>>>>>                Move (Right(sString,  Length(sString) - iStart + 1)) to asResult[SizeOfArray(asResult)]
15533>>>>>            End
15533>>>>>>
15533>>>>>            Else Begin
15534>>>>>                Move sString to asResult[SizeOfArray(asResult)]
15535>>>>>            End
15535>>>>>>
15535>>>>>            
15535>>>>>        End
15535>>>>>>
15535>>>>>        
15535>>>>>        
15535>>>>>        Function_Return asResult
15536>>>>>    End_Function
15537>>>>>        
15537>>>>>        
15537>>>>>    //  
15537>>>>>    //  Calls a method of a web object by a string with its name and an array 
15537>>>>>    //  of parameters (as String). 
15537>>>>>    //
15537>>>>>    //  Params:
15537>>>>>    //      hoWO            Handle of the web object.
15537>>>>>    //      sMethodName     String name of the method.
15537>>>>>    //      asParams        Array with parameters as string.
15537>>>>>    //  Returns:
15537>>>>>    //      Returnvalue of the method.
15537>>>>>    //
15537>>>>>    Function CallMethod Handle hoWO String sMethodName String[] asParams Returns String
15539>>>>>        Integer iParamCount iCount iMessageId iMessageItem 
15539>>>>>        String sResult sMessageName
15539>>>>>        
15539>>>>>        //  Find the message and get the message id and the number of parameters
15539>>>>>        Get InterfaceMessageCount of hoWo to iCount
15540>>>>>        
15540>>>>>        Move 0 to iMessageItem 
15541>>>>>        While (iMessageItem < iCount and iMessageId = 0)
15545>>>>>            Get InterfaceMessageName of hoWo iMessageItem to sMessageName
15546>>>>>            
15546>>>>>            If (UpperCase(sMessageName) = UpperCase(sMethodName)) Begin
15548>>>>>                Get InterfaceMessageId of hoWo iMessageItem to iMessageId
15549>>>>>//                Get InterfaceMessageParamCount of hoWo iMessageItem to iParamCount
15549>>>>>            End
15549>>>>>>
15549>>>>>            
15549>>>>>            Increment iMessageItem
15550>>>>>        Loop
15551>>>>>>
15551>>>>>        
15551>>>>>        //  Check if found and the number of parameters
15551>>>>>        If (iMessageId > 0) Begin
15553>>>>>            Move (SizeOfArray(asParams)) to iParamCount                         
15554>>>>>            Case Begin
15554>>>>>                Case (iParamCount = 0)
15556>>>>>                    Get iMessageId of hoWo to sResult
15557>>>>>                    Case Break
15558>>>>>                Case (iParamCount = 1)
15561>>>>>                    Get iMessageId of hoWo asParams[0] to sResult
15562>>>>>                    Case Break
15563>>>>>                Case (iParamCount = 2)
15566>>>>>                    Get iMessageId of hoWo asParams[0] asParams[1] to sResult
15567>>>>>                    Case Break
15568>>>>>                Case (iParamCount = 3)
15571>>>>>                    Get iMessageId of hoWo asParams[0] asParams[1] asParams[2] to sResult
15572>>>>>                    Case Break
15573>>>>>                Case (iParamCount = 4)
15576>>>>>                    Get iMessageId of hoWo asParams[0] asParams[1] asParams[2] asParams[3] to sResult
15577>>>>>                    Case Break
15578>>>>>                Case (iParamCount = 5)
15581>>>>>                    Get iMessageId of hoWo asParams[0] asParams[1] asParams[2] asParams[3] asParams[4] to sResult
15582>>>>>                    Case Break
15583>>>>>                Case (iParamCount = 6)
15586>>>>>                    Get iMessageId of hoWo asParams[0] asParams[1] asParams[2] asParams[3] asParams[4] asParams[5] to sResult
15587>>>>>                    Case Break
15588>>>>>                Case (iParamCount = 7)
15591>>>>>                    Get iMessageId of hoWo asParams[0] asParams[1] asParams[2] asParams[3] asParams[4] asParams[5] asParams[6] to sResult
15592>>>>>                    Case Break
15593>>>>>                Case (iParamCount = 8)
15596>>>>>                    Get iMessageId of hoWo asParams[0] asParams[1] asParams[2] asParams[3] asParams[4] asParams[5] asParams[6] asParams[7] to sResult
15597>>>>>                    Case Break
15598>>>>>                Case (iParamCount = 9)
15601>>>>>                    Get iMessageId of hoWo asParams[0] asParams[1] asParams[2] asParams[3] asParams[4] asParams[5] asParams[6] asParams[7] asParams[8] to sResult
15602>>>>>                    Case Break
15603>>>>>                Case (iParamCount = 10)
15606>>>>>                    Get iMessageId of hoWo asParams[0] asParams[1] asParams[2] asParams[3] asParams[4] asParams[5] asParams[6] asParams[7] asParams[8] asParams[9] to sResult
15607>>>>>                    Case Break
15608>>>>>                Case (iParamCount = 11)
15611>>>>>                    Get iMessageId of hoWo asParams[0] asParams[1] asParams[2] asParams[3] asParams[4] asParams[5] asParams[6] asParams[7] asParams[8] asParams[9] asParams[10] to sResult
15612>>>>>                    Case Break
15613>>>>>                Case (iParamCount = 12)
15616>>>>>                    Get iMessageId of hoWo asParams[0] asParams[1] asParams[2] asParams[3] asParams[4] asParams[5] asParams[6] asParams[7] asParams[8] asParams[9] asParams[10] asParams[11] to sResult
15617>>>>>                    Case Break
15618>>>>>                Case (iParamCount = 13)
15621>>>>>                    Get iMessageId of hoWo asParams[0] asParams[1] asParams[2] asParams[3] asParams[4] asParams[5] asParams[6] asParams[7] asParams[8] asParams[9] asParams[10] asParams[11] asParams[12] to sResult
15622>>>>>                    Case Break
15623>>>>>                Case (iParamCount = 14)
15626>>>>>                    Get iMessageId of hoWo asParams[0] asParams[1] asParams[2] asParams[3] asParams[4] asParams[5] asParams[6] asParams[7] asParams[8] asParams[9] asParams[10] asParams[11] asParams[12] asParams[13] to sResult
15627>>>>>                    Case Break
15628>>>>>                Case (iParamCount = 15)
15631>>>>>                    Get iMessageId of hoWo asParams[0] asParams[1] asParams[2] asParams[3] asParams[4] asParams[5] asParams[6] asParams[7] asParams[8] asParams[9] asParams[10] asParams[11] asParams[12] asParams[13] asParams[14] to sResult
15632>>>>>                    Case Break
15633>>>>>                Case (iParamCount = 16)
15636>>>>>                    Get iMessageId of hoWo asParams[0] asParams[1] asParams[2] asParams[3] asParams[4] asParams[5] asParams[6] asParams[7] asParams[8] asParams[9] asParams[10] asParams[11] asParams[12] asParams[13] asParams[14] asParams[15] to sResult
15637>>>>>                    Case Break
15638>>>>>                Case Else
15638>>>>>                    Error 5639 "Exceeded maximum of 16 parameters"
15639>>>>>>
15639>>>>>            Case End
15639>>>>>
15639>>>>>        End
15639>>>>>>
15639>>>>>        Else Begin
15640>>>>>            Error 5637 ("Method not found:" * sMethodName)
15641>>>>>>
15641>>>>>        End
15641>>>>>>
15641>>>>>        
15641>>>>>        
15641>>>>>       
15641>>>>>        Function_Return sResult
15642>>>>>    End_Function
15643>>>>>    
15643>>>>> 
15643>>>>>    //
15643>>>>>    //  Registers the webservice calls.
15643>>>>>    //
15643>>>>>    Procedure End_Construct_Object
15645>>>>>        Forward Send End_Construct_Object
15647>>>>>        
15647>>>>>        Send RegisterInterface get_MetaDataWO "get_MetaDataWO" "String sSessionKey String sWebObject String sVersion Returns TAjaxMetaWO" "Returns the global data for the wo including the DDO structure"
15648>>>>>        Send RegisterInterface get_MetaDataFields "get_MetaDataFields" "String sSessionKey String sWebObject String sFields Returns TAjaxMetaFields" "Returns the commonly used properties for the given fields"
15649>>>>>        Send RegisterInterface get_MetaDataProperties "get_MetaDataProperties" "String sSessionKey String sWebObject String[] aFields String[] aProperties Returns TAjaxMetaProperties" "Returns extra field properties for the given fields"
15650>>>>>        Send RegisterInterface get_MetaDataDescriptionValues "get_MetaDataDescriptionValues" "String sSessionKey String sWebObject String sField Returns TAjaxMetaDescriptionValues" "Returns the descriptionvalues for the given field"
15651>>>>>
15651>>>>>        Send RegisterInterface get_Request "get_Request" "TAjaxRequestData tRequestData Returns TAjaxResponseData" "Handles the given requests"
15652>>>>>        Send RegisterInterface get_ValidateField "get_ValidateField" "TAjaxValidationRequest tRequest Returns TAjaxValidationResponse" "Validates a field"
15653>>>>>        Send RegisterInterface get_RemoteMethodInvocation "get_RemoteMethodInvocation" "String sWebObject String sSessionKey String sMethodName String[] asParams Returns TAjaxRMIResponse" "Calls a method"
15654>>>>>        Send RegisterInterface get_LoadTreeNodes "get_LoadTreeNodes" "String sWebObject String sSessionKey String sObjectName String sParentId String sParentValue Integer iLevel Returns TAjaxTreeNodeResponse" "Used by the AjaxTreeView to load its content"
15655>>>>>        
15655>>>>>    End_Procedure
15656>>>>>End_Class
15657>>>Use SessionManager.wo
15657>>>
15657>>>Object oWebService is a cAjaxWebserviceInterface
15659>>>
15659>>>    //  Set Management object
15659>>>    Set phoSessionManager to oSessionManager
15660>>>    Set psServiceName to "WebService"
15661>>>
15661>>>End_Object
15662>    Use User.wo
Including file: User.wo    (C:\VDF programs\timer\AppSrc\User.wo)
15662>>>// C:\VDF Programs\TimeReg\AppSrc\User.wo
15662>>>// User
15662>>>//
15662>>>
15662>>>Use cAjaxWebBusinessProcess.pkg
15662>>>Use Session.dd
15662>>>Use cCompanyDataDictionary.dd
15662>>>Use User.DD
15662>>>
15662>>>Object oUser Is A cAjaxWebBusinessProcess
15664>>>    Set psDescription to "User"
15665>>>    Set pbClearAfterSave to False
15666>>>
15666>>>
15666>>>    Object oCompany_DD Is A cCompanyDataDictionary
15668>>>    End_Object // oCompany_DD
15669>>>
15669>>>    Object oUser_DD Is A User_DataDictionary
15671>>>        Set DDO_Server To oCompany_DD
15672>>>
15672>>>        Procedure Save_Main_File
15675>>>            Move Session.CompanyId to user.CompanyId
15676>>>            Forward Send Save_Main_File
15678>>>        End_Procedure
15679>>>
15679>>>        Procedure OnConstrain
15682>>>            
15682>>>            Constrain user.CompanyId eq session.CompanyId
15684>>>//            Constrain customer as (customer.CompanyId = User.CompanyId)
15684>>>        End_Procedure
15685>>>    End_Object // oUser_DD
15686>>>
15686>>>    Set Main_DD To oUser_DD
15687>>>
15687>>>
15687>>>    Send RegisterStandardInterface
15688>>>    //Send RegisterDebugInterface
15688>>>    //Send RegisterFullErrorInterface
15688>>>    //Send RegisterAutoEntryInterface
15688>>>
15688>>>End_Object // oUser
15689>    Use Customer.wo
Including file: Customer.wo    (C:\VDF programs\timer\AppSrc\Customer.wo)
15689>>>// Customer.wo
15689>>>// Customer
15689>>>
15689>>>Use cAjaxWebBusinessProcess.pkg
15689>>>
15689>>>Use Customer.DD
Including file: Customer.dd    (C:\VDF programs\timer\DdSrc\Customer.dd)
15689>>>>>Use  Windows.pkg           // Basic Definitions
15689>>>>>Use  DataDict.pkg          // DataDictionary Class Definition
15689>>>>>Use  Ddvaltbl.pkg          // Validation Table Class Definitions
15689>>>>>
15689>>>>>Open Customer
15691>>>>>Open Ordsys
15693>>>>>Open Company
15695>>>>>Open Project
15697>>>>>
15697>>>>>
15697>>>>>Register_Object Customer_State_VT
15697>>>>>Register_Object Customer_Status_VT
15697>>>>>
15697>>>>>Object Customer_State_VT  is a CodeValidationTable
15699>>>>>    Set Type_Value        To "STATES"
15700>>>>>    Set Table_Title       To "States"
15701>>>>>End_Object   // Customer_State_VT
15702>>>>>
15702>>>>>Object Customer_Status_VT  is a DescriptionValidationTable
15704>>>>>
15704>>>>>    Procedure Fill_List
15707>>>>>        Forward Send Fill_List
15709>>>>>        Send Add_Table_Value  "Y"  "Active"
15710>>>>>        Send Add_Table_Value  "N"  "Inactive"
15711>>>>>    End_Procedure    // Fill_List
15712>>>>>End_Object   // Customer_Status_VT
15713>>>>>Register_Object Customer_sl
15713>>>>>
15713>>>>>
15713>>>>>Class Customer_DataDictionary Is A DataDictionary
15714>>>>>
15714>>>>>    Procedure Construct_Object
15716>>>>>        Forward Send Construct_Object
15718>>>>>
15718>>>>>
15718>>>>>        Set Main_File To Customer.File_Number
15719>>>>>
15719>>>>>        Set Add_Server_File to Company.File_Number
15720>>>>>
15720>>>>>        Set Add_Client_File to Project.File_Number
15721>>>>>        Set Cascade_Delete_State To FALSE
15722>>>>>
15722>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_FINDREQ to True
15723>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_NOPUT to True
15724>>>>>        Set Foreign_Field_Option DD_DEFAULT DD_DISPLAYONLY to True
15725>>>>>
15725>>>>>        Set Add_System_File to Ordsys.File_Number DD_LOCK_ON_NEW_SAVE
15726>>>>>
15726>>>>>        Set Field_Auto_Increment Field CUSTOMER.CustomerId to File_Field Ordsys.Cust_Number
15727>>>>>
15727>>>>>
15727>>>>>        Set Field_Class_Name Field CUSTOMER.CustomerId to "dbCheckBox"
15728>>>>>        Set Field_Label_Long Field CUSTOMER.CustomerId to "Customer Number"
15729>>>>>        Set Field_Label_Short Field CUSTOMER.CustomerId to "Number"
15730>>>>>        Set Field_Option Field CUSTOMER.CustomerId DD_AUTOFIND to True
15731>>>>>        Set Field_Option Field CUSTOMER.CustomerId DD_NOPUT to True
15732>>>>>        Set Field_Prompt_Object Field CUSTOMER.CustomerId to Customer_sl
15733>>>>>        Set Key_Field_State Field CUSTOMER.CustomerId to True
15734>>>>>        Set Status_Help Field CUSTOMER.CustomerId to "Customer Id Number (system assigned)."
15735>>>>>
15735>>>>>        Set Field_Label_Long Field Customer.Name To "Customer Name"
15736>>>>>        Set Field_Label_Short Field Customer.Name To "Customer Name"
15737>>>>>        Set Field_Option Field Customer.Name DD_REQUIRED to True
15738>>>>>        Set Field_Prompt_Object Field Customer.Name to Customer_sl
15739>>>>>        Set Status_Help Field Customer.Name To "Customer/Company Name."
15740>>>>>
15740>>>>>        Set Field_Label_Long Field Customer.Address To "Street Address"
15741>>>>>        Set Field_Label_Short Field Customer.Address To "Address"
15742>>>>>        Set Status_Help Field Customer.Address To "Street Address."
15743>>>>>
15743>>>>>        Set Status_Help Field Customer.City To "City Name."
15744>>>>>        Set Field_Label_Long Field Customer.State To "State"
15745>>>>>        Set Field_Label_Short Field Customer.State To "St."
15746>>>>>        Set Field_Option Field Customer.State DD_CAPSLOCK to True
15747>>>>>        Set Status_Help Field Customer.State To "Two letter state ID."
15748>>>>>
15748>>>>>        Set Field_Label_Long Field Customer.Zip To "Zip/Postal Code"
15749>>>>>        Set Field_Label_Short Field Customer.Zip To "Zip"
15750>>>>>        Set Field_Mask Field Customer.Zip To "#####-####"
15751>>>>>        Set Field_Mask_Type Field Customer.Zip to Mask_Window
15752>>>>>        Set Status_Help Field Customer.Zip To "Zip or Postal Code."
15753>>>>>
15753>>>>>        Set Field_Label_Long Field Customer.Phone_Number To "Phone Number"
15754>>>>>        Set Field_Label_Short Field Customer.Phone_Number To "Phone"
15755>>>>>        Set Status_Help Field Customer.Phone_Number To "Phone Number."
15756>>>>>        Set Field_Mask_Type Field Customer.PHONE_NUMBER to Mask_Window
15757>>>>>        Set Field_Mask Field Customer.PHONE_NUMBER to "(###) ###-####"
15758>>>>>
15758>>>>>        Set Field_Label_Long Field Customer.Fax_Number To "Fax Number"
15759>>>>>        Set Field_Label_Short Field Customer.Fax_Number To "Fax"
15760>>>>>        Set Status_Help Field Customer.Fax_Number To "Fax Phone Number."
15761>>>>>
15761>>>>>        Set Field_Label_Long Field Customer.Email_Address To "E-Mail Address"
15762>>>>>        Set Field_Label_Short Field Customer.Email_Address To "E-Mail"
15763>>>>>        Set Status_Help Field Customer.Email_Address To "E-mail Address (internet)."
15764>>>>>
15764>>>>>        Set Field_Class_Name Field Customer.Credit_Limit To "dbSpinForm"
15765>>>>>        Set Field_Mask_Type Field Customer.Credit_Limit To MASK_CURRENCY_WINDOW
15766>>>>>
15766>>>>>        Set Field_Label_Long Field Customer.Purchases To "Total Purchases"
15767>>>>>        Set Field_Label_Short Field Customer.Purchases To "Purchases"
15768>>>>>        Set Field_Mask_Type Field Customer.Purchases To MASK_CURRENCY_WINDOW
15769>>>>>        Set Field_Option Field Customer.Purchases DD_DISPLAYONLY to True
15770>>>>>
15770>>>>>        Set Field_Label_Long Field Customer.Balance To "Balance Due"
15771>>>>>        Set Field_Label_Short Field Customer.Balance To "Balance"
15772>>>>>        Set Field_Mask_Type Field Customer.Balance To MASK_CURRENCY_WINDOW
15773>>>>>        Set Field_Option Field Customer.Balance DD_DISPLAYONLY to True
15774>>>>>
15774>>>>>        Set Status_Help Field Customer.Comments To "Additional Comments and Notes."
15775>>>>>
15775>>>>>        Set Field_Label_Long Field Customer.Status To "Active Status"
15776>>>>>        Set Field_Label_Short Field Customer.Status To "Status"
15777>>>>>        Set Field_Value_Table Field Customer.Status to Customer_Status_VT
15778>>>>>        Set Status_Help Field Customer.Status to "Active Inactive Status of customer"
15779>>>>>
15779>>>>>    End_Procedure  //  Construct_Object
15780>>>>>    Procedure Field_defaults
15782>>>>>        Forward Send Field_Defaults
15784>>>>>        Set Field_Changed_Value   Field Customer.Credit_Limit To 1000
15785>>>>>        Set Field_Changed_Value   Field Customer.Status To "Y"
15786>>>>>    End_Procedure
15787>>>>>
15787>>>>>End_Class    //  Customer_DataDictionary
15788>>>>>
15788>>>Use cCompanyDataDictionary.dd
15788>>>//Use User.dd
15788>>>
15788>>>Object oCustomer Is A cAjaxWebBusinessProcess
15790>>>    Set psDescription To "Customer"
15791>>>    
15791>>>    Object oCompany_DD is a cCompanyDataDictionary
15793>>>//        Constrain company.CompanyId eq user.companyid
15793>>>    End_Object
15794>>>    
15794>>>    Object oCustomer_DD is a Customer_DataDictionary
15796>>>        Set DDO_Server to oCompany_DD
15797>>>        Send DefineAllExtendedFields
15798>>>//        Set DDO_Server to oCompany_DD
15798>>>        
15798>>>//        Send Remove_Server_File Company.File_Number
15798>>>//        Procedure Relate_Main_File
15798>>>//            Forward Send Relate_Main_File
15798>>>//        
15798>>>//            Clear Company
15798>>>//            Move User.CompanyId to Company.CompanyId
15798>>>//            Find eq company.CompanyId
15798>>>//
15798>>>//            Move Company.CompanyId to CUSTOMER.CompanyId
15798>>>//        
15798>>>//        End_Procedure
15798>>>
15798>>>        Procedure Save_Main_File
15801>>>            Move session.CompanyId to CUSTOMER.CompanyId
15802>>>            Forward Send Save_Main_File
15804>>>        End_Procedure
15805>>>
15805>>>        Procedure OnConstrain
15808>>>            Constrain customer.CompanyId eq session.CompanyId
15810>>>//            Constrain customer as (customer.CompanyId = User.CompanyId)
15810>>>        End_Procedure
15811>>>    End_Object // oCustomer_DD
15812>>>
15812>>>    Set Main_DD to oCustomer_DD
15813>>>
15813>>>    Send RegisterStandardInterface
15814>>>    //Send RegisterDebugInterface
15814>>>    // Send RegisterFullErrorInterface
15814>>>    // Send RegisterAutoEntryInterface
15814>>>
15814>>>End_Object // oCustomer
15815>    Use CustomerReport.wo
Including file: CustomerReport.wo    (C:\VDF programs\timer\AppSrc\CustomerReport.wo)
15815>>>Use cAjaxWebBusinessProcess.pkg
15815>>>Use cWebReport.pkg
15815>>>
15815>>>Use Customer.DD
15815>>>
15815>>>Object oCustomerReport is a cWebBusinessProcess
15817>>>    Set pbAllowDelete to False
15818>>>    Set pbAllowSaveEdit to FALSE
15819>>>    Set pbAllowSaveNew to FALSE
15820>>>    Set pbVerboseErrors to TRUE
15821>>>    Set psDescription to "Customer Information Drill Down Report"
15822>>>
15822>>>    Object oCustomer_DD is a Customer_DataDictionary
15824>>>        Send DefineAllExtendedFields
15825>>>
15825>>>        Property Number pnStartCustomer_Number
15827>>>        Property Number pnStopCustomer_Number
15829>>>        
15829>>>        Procedure OnConstrain
15832>>>            Number nStart nStop
15832>>>            Date   dStart dStop
15832>>>            String sStart sStop
15832>>>        
15832>>>            Get pnStartCustomer_Number To nStart
15833>>>            Get pnStopCustomer_Number  To nStop
15834>>>        
15834>>>            If (nStart<>0 And nStop<>0) ;                Constrain Customer.CustomerId Between nStart and nStop
15840>>>            Else If (nStart>0) ;                Constrain Customer.CustomerId Ge nStart
15845>>>            Else If (nStop<0) ;                Constrain Customer.CustomerId Le nStop
15850>>>
15850>>>            Constrain customer.CompanyId eq session.CompanyId
15852>>>        End_Procedure
15853>>>
15853>>>    End_Object
15854>>>
15854>>>    Set Main_DD to oCustomer_DD
15855>>>
15855>>>    Object oReport is a cWebReport
15857>>>        
15857>>>        Procedure OnPageTop
15860>>>            Send WriteHtmlTableBegin 'border="0" width="99%" class="ReportTable"'
15861>>>        
15861>>>            Send WriteHtmlRowBegin
15862>>>                Send WriteHtmlCellHeader 'Number' 'class="Header" align="right"'
15863>>>                Send WriteHtmlCellHeader 'Customer Name' 'class="Header" align="left"'
15864>>>                Send WriteHtmlCellHeader 'Phone' 'class="Header" align="left"'
15865>>>                Send WriteHtmlCellHeader 'Balance' 'class="Header" align="right"'
15866>>>                Send WriteHtmlCellHeader 'Status' 'class="Header" align="left"'
15867>>>            Send WriteHtmlRowEnd
15868>>>        End_Procedure
15869>>>        
15869>>>        Procedure OnBody
15872>>>            String sText sName sPhone sStatus
15872>>>            Number nID nBalance
15872>>>        
15872>>>            Send WriteHtmlRowBegin
15873>>>                Get ddValueEncode "Customer.CustomerId" to nID
15874>>>                Get ddValueEncode "Customer.Name"            To sName
15875>>>                Get ddValueEncode "Customer.Phone_Number"    To sPhone
15876>>>                Get ddValueEncode "Customer.Balance"         To nBalance
15877>>>                Get ddValueEncode "Customer.Status" DDDESC   to sStatus
15878>>>                Get AddRowIdLink (FormatNumber(nId,0)) To sText
15879>>>                Send WriteHtmlCell sText 'class="Data" align="center"'
15880>>>                Get AddRowIdLink sName To sText
15881>>>                Send WriteHtmlCell sText 'class="Data" align="left"'
15882>>>                Send WriteHtmlCell sPhone 'class="Data" align="left"'
15883>>>                Send WriteHtmlCell (FormatNumber(nBalance,2)) 'class="Data" align="right"'
15884>>>                Send WriteHtmlCell sStatus 'class="Data" align="left"'
15885>>>            Send WriteHtmlRowEnd
15886>>>        End_Procedure
15887>>>        
15887>>>        Procedure OnPageBottom
15890>>>            Send WriteHtmlTableEnd
15891>>>        End_Procedure
15892>>>        
15892>>>        Function RunCustomerReport Integer iIndex RowId riStart Integer iMax Returns RowId
15895>>>            RowId   riEnd
15895>>>            Integer iEnd iStat
15895>>>        
15895>>>            Set piOrdering           To iIndex
15896>>>            Set piMaxCount           To iMax
15897>>>            Set piMaxCountBreakLevel To 0
15898>>>            Set priStartRowId        To riStart
15899>>>            Get DoRunReport          To iStat
15900>>>            Get priLastRowId         To riEnd
15901>>>            Function_Return riEnd
15902>>>        End_Function
15903>>>
15903>>>    End_Object
15904>>>    
15904>>>    Procedure SetHRefName String sName
#REM SEND REGISTERINTERFACE |CI5626 "msg_SetHRefName" "String sName" "Sets the full URL of a file to be displayed in drill down operation"
15908>>>        Set psHRefname Of oReport To sName
15909>>>    End_Procedure
15910>>>    
15910>>>    Procedure SetCustomer_Number String sStart String sStop
#REM SEND REGISTERINTERFACE |CI5627 "msg_SetCustomer_Number" "String sStart String sStop" "Sets the start & stop customer number"
15914>>>        Handle hDD
15914>>>    
15914>>>        Get phMainDD To hDD
15915>>>        Set pnStartCustomer_Number Of hDD To sStart
15916>>>        Set pnStopCustomer_Number  Of hDD To sStop
15917>>>    End_Procedure
15918>>>    
15918>>>    Function RunCustomerReport Integer iIndex string sStart Integer iMax Returns string
#REM SEND REGISTERINTERFACE |CI5625 "get_RunCustomerReport" "Integer iIndex string sStart Integer iMax Returns string" "Starts "
15922>>>        Rowid riEnd
15922>>>    
15922>>>        Get RunCustomerReport Of oReport iIndex (DeserializeRowId(sStart)) iMax To riEnd
15923>>>    
15923>>>        Function_Return (SerializeRowid(riEnd))
15924>>>    End_Function    
15925>>>    
15925>>>    Send RegisterStandardInterface
15926>>>    
15926>>>End_Object
15927>    Use DayReport.wo
Including file: DayReport.wo    (C:\VDF programs\timer\AppSrc\DayReport.wo)
15927>>>// DayReport.wo
15927>>>// DayReport
15927>>>Use cWebBusinessProcess.pkg
15927>>>Use cWebReport.pkg
15927>>>
15927>>>Use cCompanyDataDictionary.dd
15927>>>Use CUSTOMER.DD
15927>>>Use cProjectDataDictionary.dd
Including file: cProjectDataDictionary.dd    (C:\VDF programs\timer\DdSrc\cProjectDataDictionary.dd)
15927>>>>>Use DataDict.pkg
15927>>>>>
15927>>>>>Open Project
15929>>>>>Open TimeReg
15931>>>>>Open UserProj
15933>>>>>Open CUSTOMER
15935>>>>>Open OrdSys
15937>>>>>
15937>>>>>Class cProjectDataDictionary is a DataDictionary
15938>>>>>    
15938>>>>>    Procedure Construct_Object
15940>>>>>        Forward Send Construct_Object
15942>>>>>        Set Main_file to Project.File_Number
15943>>>>>
15943>>>>>        Set Add_System_File to OrdSys.File_Number DD_Lock_On_All
15944>>>>>
15944>>>>>        Set Add_Server_File to CUSTOMER.File_Number
15945>>>>>
15945>>>>>        Set Add_Client_File to TimeReg.File_Number
15946>>>>>        Set Add_Client_File to UserProj.File_Number
15947>>>>>
15947>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_NOPUT to True
15948>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_FINDREQ to True
15949>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_NOPUT to True
15950>>>>>        Set Foreign_Field_Option DD_DEFAULT DD_DISPLAYONLY to True
15951>>>>>
15951>>>>>        Set Field_Auto_Increment Field Project.ProjectId to File_Field OrdSys.ProjectId
15952>>>>>
15952>>>>>        Set Field_Option Field Project.name DD_REQUIRED to True
15953>>>>>
15953>>>>>    End_Procedure
15954>>>>>
15954>>>>>End_Class
15955>>>Use User.DD
15955>>>Use cTimeregDataDictionary.dd
Including file: cTimeregDataDictionary.dd    (C:\VDF programs\timer\DdSrc\cTimeregDataDictionary.dd)
15955>>>>>Use DataDict.pkg
15955>>>>>
15955>>>>>Open TimeReg
15957>>>>>Open User
15959>>>>>Open Project
15961>>>>>
15961>>>>>Class cTimeregDataDictionary is a DataDictionary
15962>>>>>    
15962>>>>>    Procedure Construct_Object
15964>>>>>        Forward Send Construct_Object
15966>>>>>        Set Main_file to TimeReg.File_Number
15967>>>>>
15967>>>>>        Set Add_Server_File to User.File_Number
15968>>>>>        Set Add_Server_File to Project.File_Number
15969>>>>>
15969>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_NOPUT to True
15970>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_FINDREQ to True
15971>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_NOPUT to True
15972>>>>>        Set Foreign_Field_Option DD_DEFAULT DD_DISPLAYONLY to True
15973>>>>>
15973>>>>>    End_Procedure
15974>>>>>
15974>>>>>End_Class
15975>>>
15975>>>Object oDayReport Is A cWebBusinessProcess
15977>>>    Set psDescription To "DayReport"
15978>>>
15978>>>
15978>>>    Object oCompany_DD Is A cCompanyDataDictionary
15980>>>        Send DefineAllExtendedFields
15981>>>    End_Object // oCompany_DD
15982>>>
15982>>>    Object oCustomer_DD Is A Customer_DataDictionary
15984>>>        Send DefineAllExtendedFields
15985>>>        Set DDO_Server To oCompany_DD
15986>>>        Property String psStartNAME
15988>>>        Property String psStopNAME
15990>>>
15990>>>        Procedure OnConstrain 
15993>>>            String sStart sStop
15993>>>            Constrain customer.CompanyId eq session.CompanyId
15995>>>
15995>>>            Get psStartNAME To sStart
15996>>>            Get psStopNAME To sStop
15997>>>
15997>>>            If (sStart <> "" And sStop <> "") Begin
15999>>>                Constrain Customer.Name Between sStart And sStop
16003>>>            End
16003>>>>
16003>>>            Else Begin
16004>>>                If (sStart <> "") Begin
16006>>>                    Constrain Customer.Name Ge sStart
16008>>>                End
16008>>>>
16008>>>                Else Begin
16009>>>                    If (sStop <> "") Begin
16011>>>                        Constrain Customer.Name Le sStop
16013>>>                    End
16013>>>>
16013>>>                End
16013>>>>
16013>>>            End
16013>>>>
16013>>>        End_Procedure // OnConstrain
16014>>>    End_Object // oCustomer_DD
16015>>>
16015>>>    Object oProject_DD Is A cProjectDataDictionary
16017>>>        Send DefineAllExtendedFields
16018>>>        Set DDO_Server To oCustomer_DD
16019>>>        Property String psStartname
16021>>>        Property String psStopname
16023>>>
16023>>>        Procedure OnConstrain 
16026>>>            String sStart sStop
16026>>>
16026>>>            Get psStartname To sStart
16027>>>            Get psStopname To sStop
16028>>>
16028>>>            If (sStart <> "" And sStop <> "") Begin
16030>>>                Constrain Project.Name Between sStart And sStop
16034>>>            End
16034>>>>
16034>>>            Else Begin
16035>>>                If (sStart <> "") Begin
16037>>>                    Constrain Project.Name Ge sStart
16039>>>                End
16039>>>>
16039>>>                Else Begin
16040>>>                    If (sStop <> "") Begin
16042>>>                        Constrain Project.Name Le sStop
16044>>>                    End
16044>>>>
16044>>>                End
16044>>>>
16044>>>            End
16044>>>>
16044>>>        End_Procedure // OnConstrain
16045>>>    End_Object // oProject_DD
16046>>>
16046>>>    Object oUser_DD Is A User_DataDictionary
16048>>>        Send DefineAllExtendedFields
16049>>>        Set DDO_Server To oCompany_DD
16050>>>        Property String psStartLoginName
16052>>>        Property String psStopLoginName
16054>>>
16054>>>        Procedure OnConstrain 
16057>>>            String sStart sStop
16057>>>
16057>>>            Get psStartLoginName To sStart
16058>>>            Get psStopLoginName To sStop
16059>>>
16059>>>            If (sStart <> "" And sStop <> "") Begin
16061>>>                Constrain User.Loginname Between sStart And sStop
16065>>>            End
16065>>>>
16065>>>            Else Begin
16066>>>                If (sStart <> "") Begin
16068>>>                    Constrain User.Loginname Ge sStart
16070>>>                End
16070>>>>
16070>>>                Else Begin
16071>>>                    If (sStop <> "") Begin
16073>>>                        Constrain User.Loginname Le sStop
16075>>>                    End
16075>>>>
16075>>>                End
16075>>>>
16075>>>            End
16075>>>>
16075>>>        End_Procedure // OnConstrain
16076>>>    End_Object // oUser_DD
16077>>>
16077>>>    Object oTimereg_DD Is A cTimeregDataDictionary
16079>>>        Send DefineAllExtendedFields
16080>>>        Set DDO_Server To oUser_DD
16081>>>        Set DDO_Server To oProject_DD
16082>>>    End_Object // oTimereg_DD
16083>>>
16083>>>    Set Main_DD To oTimereg_DD
16084>>>
16084>>>
16084>>>    Object oReport Is A cWebReport
16086>>>        Procedure OnPageTop 
16089>>>            Send WriteHtmlTableBegin 'border="0" width="99%" class="ReportTable"'
16090>>>
16090>>>            Send WriteHtmlRowBegin
16091>>>                Send WriteHtmlCellHeader 'Loginname' 'class="Header" align="left"'
16092>>>                Send WriteHtmlCellHeader 'Firstname' 'class="Header" align="left"'
16093>>>                Send WriteHtmlCellHeader 'Lastname' 'class="Header" align="left"'
16094>>>                Send WriteHtmlCellHeader 'Customer Name' 'class="Header" align="left"'
16095>>>                Send WriteHtmlCellHeader 'Name' 'class="Header" align="left"'
16096>>>                Send WriteHtmlCellHeader 'Start Date' 'class="Header" align="left"'
16097>>>                Send WriteHtmlCellHeader 'Start Time' 'class="Header" align="left"'
16098>>>                Send WriteHtmlCellHeader 'End Time' 'class="Header" align="left"'
16099>>>                Send WriteHtmlCellHeader 'Time' 'class="Header" align="left"'
16100>>>            Send WriteHtmlRowEnd
16101>>>        End_Procedure // OnPageTop
16102>>>
16102>>>        Procedure OnBody 
16105>>>            String sRet zeroH zeroM
16105>>>            Integer first hours minutes totalMinutes startMinutes endMinutes
16105>>>            String sText
16105>>>            String sUserLoginname
16105>>>            String sUserFirstname
16105>>>            String sUserLastname
16105>>>            String sCustomerName
16105>>>            String sProjectName
16105>>>            String sTimeregStart_Date
16105>>>            String sTimeregStart_Time
16105>>>            String sTimeregEnd_Time
16105>>>            String sTimeregTime
16105>>>
16105>>>            Get ddValueEncode "User.Loginname" To sUserLoginname
16106>>>            Get ddValueEncode "User.Firstname" To sUserFirstname
16107>>>            Get ddValueEncode "User.Lastname" To sUserLastname
16108>>>            Get ddValueEncode "Customer.Name" To sCustomerName
16109>>>            Get ddValueEncode "Project.Name" To sProjectName
16110>>>            Get ddValueEncode "Timereg.Start_Date" To sTimeregStart_Date
16111>>>            Get ddValueEncode "Timereg.Start_Time" To sTimeregStart_Time
16112>>>            Get ddValueEncode "Timereg.End_Time" to sTimeregEnd_Time
16113>>>
16113>>>            Move (mid(sTimeregStart_Time, 2, 1)) to hours
16114>>>            Move (mid(sTimeregStart_Time, 2, 4)) to minutes
16115>>>            Move ((60*hours)+minutes) to startMinutes
16116>>>            Move (mid(sTimeregEnd_Time, 2, 1)) to hours
16117>>>            Move (mid(sTimeregEnd_Time, 2, 4)) to minutes
16118>>>            Move ((60*hours)+minutes) to endMinutes
16119>>>            Move (endMinutes-startMinutes+totalMinutes) to totalMinutes
16120>>>            
16120>>>            Move (totalMinutes/60) to hours
16121>>>            Move (totalMinutes-(hours*60)) to minutes
16122>>>
16122>>>            Move "" to zeroH
16123>>>            Move "" to zeroM
16124>>>            If (hours < 10) Move "0" to zeroH
16127>>>            If (minutes < 10) Move "0" to zeroM
16130>>>
16130>>>            Move (zeroH - String(hours) - ':' - zeroM - String(minutes)) to sTimeregTime
16131>>>
16131>>>            Send WriteHtmlRowBegin
16132>>>                Get AddRowIdLink sUserLoginname To sText
16133>>>                Send WriteHtmlCell sText 'class="Data" align="left"'
16134>>>                Send WriteHtmlCell sUserFirstname 'class="Data" align="left"'
16135>>>                Send WriteHtmlCell sUserLastname 'class="Data" align="left"'
16136>>>                Send WriteHtmlCell sCustomerName 'class="Data" align="left"'
16137>>>                Send WriteHtmlCell sProjectName 'class="Data" align="left"'
16138>>>                Send WriteHtmlCell sTimeregStart_Date 'class="Data" align="left"'
16139>>>                Send WriteHtmlCell sTimeregStart_Time 'class="Data" align="left"'
16140>>>                Send WriteHtmlCell sTimeregEnd_Time 'class="Data" align="left"'
16141>>>                Send WriteHtmlCell sTimeregTime 'class="Data" align="left"'
16142>>>            Send WriteHtmlRowEnd
16143>>>        End_Procedure // OnBody
16144>>>
16144>>>        Procedure OnPageBottom 
16147>>>            Send WriteHtmlTableEnd
16148>>>        End_Procedure // OnPageBottom
16149>>>
16149>>>        Function RunDayReport Integer iIndex RowId riStartRowId Integer iMaxCount Returns RowId
16152>>>            RowId   riLastRowId
16152>>>            Integer eStatus
16152>>>
16152>>>            Set piOrdering To iIndex
16153>>>            Set piMaxCount To iMaxCount
16154>>>            Set piMaxCountBreakLevel To 0
16155>>>            Set priStartRowId To riStartRowId
16156>>>
16156>>>            Get DoRunReport To eStatus
16157>>>
16157>>>            Get priLastRowId To riLastRowId
16158>>>
16158>>>            Function_Return riLastRowId
16159>>>        End_Function // RunDayReport
16160>>>    End_Object // oReport
16161>>>
16161>>>    Procedure SetHRefName String sName
#REM SEND REGISTERINTERFACE |CI5626 "msg_SetHRefName" "String sName" "Name to link for drill down report"
16165>>>        Set psHRefname of oReport To sName
16166>>>    End_Procedure // SetHRefName
16167>>>
16167>>>    Procedure SetCustomer_Name String sStart String sStop
#REM SEND REGISTERINTERFACE |CI5637 "msg_SetCustomer_Name" "String sStart String sStop" "Sets the reports selection criteria"
16171>>>        Set psStartNAME of oCustomer_DD To (Uppercase (sStart))
16172>>>        Set psStopNAME  of oCustomer_DD To (Uppercase (sStop))
16173>>>    End_Procedure // SetCustomer_Name
16174>>>
16174>>>    Procedure SetProject_Name String sStart String sStop
#REM SEND REGISTERINTERFACE |CI5638 "msg_SetProject_Name" "String sStart String sStop" "Sets the reports selection criteria"
16178>>>        Set psStartname of oProject_DD To (Uppercase (sStart))
16179>>>        Set psStopname  of oProject_DD To (Uppercase (sStop))
16180>>>    End_Procedure // SetProject_Name
16181>>>
16181>>>    Procedure SetUser_Loginname String sStart String sStop
#REM SEND REGISTERINTERFACE |CI5639 "msg_SetUser_Loginname" "String sStart String sStop" "Sets the reports selection criteria"
16185>>>        Set psStartLoginName of oUser_DD To (Uppercase (sStart))
16186>>>        Set psStopLoginName  of oUser_DD To (Uppercase (sStop))
16187>>>    End_Procedure // SetUser_Loginname
16188>>>
16188>>>    Function RunDayReport Integer iIndex String sStartRowId Integer iMaxCount Returns String
#REM SEND REGISTERINTERFACE |CI5636 "get_RunDayReport" "Integer iIndex String sStartRowId Integer iMaxCount Returns String" "Run Report"
16192>>>        RowId  riStartRowId riEndRowId
16192>>>        String sEndRowId
16192>>>
16192>>>        Move (DeserializeRowId(sStartRowId)) to riStartRowId
16193>>>        Get RunDayReport of oReport iIndex riStartRowId iMaxCount To riEndRowId
16194>>>        Move (SerializeRowId(riEndRowId)) to sEndRowId
16195>>>
16195>>>        Function_Return sEndRowId
16196>>>    End_Function // RunDayReport
16197>>>
16197>>>    Set pbAllowSaveNew To False
16198>>>    Set pbAllowSaveEdit To False
16199>>>    Set pbAllowDelete To False
16200>>>
16200>>>End_Object // oDayReport
16201>    Use Project.wo
Including file: Project.wo    (C:\VDF programs\timer\AppSrc\Project.wo)
16201>>>// C:\VDF Programs\TimeReg\AppSrc\Project.wo
16201>>>// Project
16201>>>
16201>>>Use cAjaxWebBusinessProcess.pkg
16201>>>
16201>>>Use cCompanyDataDictionary.dd
16201>>>Use CUSTOMER.DD
16201>>>Use cProjectDataDictionary.dd
16201>>>//Use HtmlEncode.pkg
16201>>>
16201>>>Object oProject Is A cAjaxWebBusinessProcess
16203>>>    Set psDescription to "Project"
16204>>>    Set pbClearAfterSave to False
16205>>>
16205>>>    Object oCompany_DD Is A cCompanyDataDictionary
16207>>>    End_Object // oCompany_DD
16208>>>
16208>>>    Object oCustomer_DD Is A Customer_DataDictionary
16210>>>        Set DDO_Server To oCompany_DD
16211>>>        Procedure OnConstrain
16214>>>            Constrain customer.CompanyId eq session.CompanyId
16216>>>        End_Procedure
16217>>>    End_Object // oCustomer_DD
16218>>>
16218>>>    Object oProject_DD Is A cProjectDataDictionary
16220>>>        Set DDO_Server To oCustomer_DD
16221>>>        Set Cascade_Delete_State to False 
16222>>>        Procedure Save_Main_File
16225>>>            Move session.CompanyId to Project.CompanyId
16226>>>            Forward Send Save_Main_File
16228>>>        End_Procedure
16229>>>
16229>>>    End_Object // oProject_DD
16230>>>
16230>>>    Object oTimereg_DD is a cTimeregDataDictionary
16232>>>        Set DDO_Server to oProject_DD
16233>>>    End_Object
16234>>>    Set Main_DD to oProject_DD
16235>>>
16235>>>
16235>>>    Function HtmlEncodeNoCrLfJB Global String sDat Returns String
16237>>>           Move (Replaces("&",sDat,"&amp;"))          to sDat // must do this first!
16238>>>           Move (Replaces("<",sDat,"&lt;"))           to sDat
16239>>>           Move (Replaces(">",sDat,"&gt;"))           to sDat
16240>>>           Move (Replaces('"',sDat,"&quot;"))         to sDat
16241>>>           Move (Replaces("'",sDat,"&#39;"))          to sDat // can't use apos
16242>>>    
16242>>>           Move (Replaces('',sDat,"&aring;"))         to sDat
16243>>>           Move (Replaces('',sDat,"&Aring;"))         to sDat
16244>>>           Move (Replaces('',sDat,"&oslash;"))         to sDat
16245>>>           Move (Replaces('',sDat,"&Oslash;"))         to sDat
16246>>>           Move (Replaces('',sDat,"&aelig;"))         to sDat
16247>>>           Move (Replaces('',sDat,"&AElig;"))         to sDat
16248>>>           Move (Replaces('',sDat,"&auml;"))         to sDat
16249>>>           Move (Replaces('',sDat,"&Auml;"))         to sDat
16250>>>           Move (Replaces('',sDat,"&ouml;"))         to sDat
16251>>>           Move (Replaces('',sDat,"&Ouml;"))         to sDat
16252>>>        
16252>>>//           Move (Replaces('',sDat,"a"))         to sDat
16252>>>//           Move (Replaces('',sDat,"A"))         to sDat
16252>>>//           Move (Replaces('',sDat,"o"))         to sDat
16252>>>//           Move (Replaces('',sDat,"O"))         to sDat
16252>>>//           Move (Replaces('',sDat,"ae"))         to sDat
16252>>>//           Move (Replaces('',sDat,"AE"))         to sDat
16252>>>//           Move (Replaces('',sDat,"a"))         to sDat
16252>>>//           Move (Replaces('',sDat,"A"))         to sDat
16252>>>//           Move (Replaces('',sDat,"o"))         to sDat
16252>>>//           Move (Replaces('',sDat,"O"))         to sDat
16252>>>
16252>>>           Function_Return sDat
16253>>>    End_Function
16254>>>    
16254>>>    
16254>>>    Function HtmlEncodeJB Global String sDat Returns String
16256>>>           Get HtmlEncodeNoCrLFJB sDat to sDat
16257>>>           Move (Replaces(character(10),sDat,""))     to sDat
16258>>>           Move (Replaces(character(13),sDat,"<br />")) to sDat
16259>>>           Function_Return sDat
16260>>>    End_Function
16261>>>
16261>>>
16261>>>    Send RegisterStandardInterface
16262>>>    //Send RegisterDebugInterface
16262>>>    //Send RegisterFullErrorInterface
16262>>>    //Send RegisterAutoEntryInterface
16262>>>    
16262>>>    Function getProjectList Integer iUserId Returns String
#REM SEND REGISTERINTERFACE |CI5640 "get_getProjectList" "Integer iUserId Returns String" ""
16266>>>        String sRet
16266>>>        Integer first
16266>>>        Boolean bFundet
16266>>>        Move 1 to first
16267>>>        Move ('{list:[') to sRet
16268>>>        // Get my projects from UserProj
16268>>>        Clear UserProj
16269>>>        Move iUserId to UserProj.UserId
16270>>>        Find ge UserProj by Index.1
16271>>>>
16271>>>        // foreach UserProj get Project data
16271>>>        While (Found and (UserProj.UserId=iUserId))
16275>>>//            If (UserProj.UserId = iUserId) Begin
16275>>>                If (first = 0) Begin
16277>>>                    Move (sRet + ', ') to sRet
16278>>>                End
16278>>>>
16278>>>                Move 0 to first
16279>>>                Clear Project
16280>>>                Move UserProj.ProjectId to Project.ProjectId
16281>>>                Find eq Project by Index.1
16282>>>>
16282>>>                Move (sRet + '{"project_id":' + String(Project.ProjectId) + ', "name": "' + (Trim(HtmlEncodeJB(String(Project.name)))) + '"}') to sRet
16283>>>//            End
16283>>>            Find gt UserProj by Index.1
16284>>>>
16284>>>            
16284>>>        Loop
16285>>>>
16285>>>        Move (sRet + ']}') to sRet
16286>>>        Function_Return sRet
16287>>>    End_Function
16288>>>
16288>>>    Function startProject Integer UserId Integer ProjectId String Comment Returns Integer
#REM SEND REGISTERINTERFACE |CI5641 "get_startProject" "Integer UserId Integer ProjectId String Comment Returns Integer" ""
16292>>>        String sRet, sUserId, sProject
16292>>>        Integer iRet
16292>>>        Time tmVar
16292>>>       
16292>>>        Clear TimeReg
16293>>>        Move UserId to TimeReg.UserId
16294>>>        Move "" to TimeReg.end_time
16295>>>        Find ge TimeReg by Index.1
16296>>>>
16296>>>        If (TimeReg.end_time = "     " and TimeReg.UserId = UserId) Begin
16298>>>        End
16298>>>>
16298>>>        Else Begin
16299>>>            Clear TimeReg
16300>>>            //Reread TimeReg
16300>>>            Move UserId to TimeReg.UserId
16301>>>            Move ProjectId to TimeReg.ProjectId
16302>>>            Move (Date(CurrentDateTime())) to TimeReg.start_date
16303>>>                Move (DateSetSecond(tmVar, (DateGetSecond(CurrentDateTime())))) to tmVar
16304>>>                Move (DateSetMinute(tmVar, (DateGetMinute(CurrentDateTime())))) to tmVar
16305>>>                Move (DateSetHour  (tmVar, (DateGetHour(CurrentDateTime())))) to tmVar
16306>>>            Move tmVar to TimeReg.start_time
16307>>>            Move Comment to TimeReg.Comments
16308>>>            SaveRecord TimeReg
16309>>>            //Unlock
16309>>>        End
16309>>>>
16309>>>        
16309>>>        Function_Return 0 //sRet
16310>>>    End_Function
16311>>>
16311>>>    Function stopProject Integer UserId Integer ProjectId String Comment Returns Integer
#REM SEND REGISTERINTERFACE |CI5642 "get_stopProject" "Integer UserId Integer ProjectId String Comment Returns Integer" ""
16315>>>        String sRet, sUserId, sProject
16315>>>        Integer iRet
16315>>>        Time tmVar
16315>>>       
16315>>>        Clear TimeReg
16316>>>        Move UserId to TimeReg.UserId
16317>>>        Move "" to TimeReg.end_time
16318>>>        Find ge TimeReg by Index.1
16319>>>>
16319>>>        If (TimeReg.end_time = "     " and TimeReg.UserId = UserId) Begin
16321>>>            Reread TimeReg
16325>>>            If (TimeReg.start_date = (Date(CurrentDateTime()))) Begin
16327>>>                Move (Date(CurrentDateTime())) to TimeReg.end_date
16328>>>                Move (DateSetSecond(tmVar, (DateGetSecond(CurrentDateTime())))) to tmVar
16329>>>                Move (DateSetMinute(tmVar, (DateGetMinute(CurrentDateTime())))) to tmVar
16330>>>                Move (DateSetHour  (tmVar, (DateGetHour(CurrentDateTime())))) to tmVar
16331>>>                Move tmVar to TimeReg.end_time
16332>>>                Move Comment to TimeReg.Comments
16333>>>                SaveRecord TimeReg
16334>>>            End
16334>>>>
16334>>>            Else Begin
16335>>>                Move TimeReg.start_date to TimeReg.end_date
16336>>>                //Move (DateSetSecond(tmVar, (DateGetSecond(CurrentDateTime())))) to tmVar
16336>>>                //Move (DateSetMinute(tmVar, (DateGetMinute(CurrentDateTime())))) to tmVar
16336>>>                //Move (DateSetHour  (tmVar, (DateGetHour(CurrentDateTime())))) to tmVar
16336>>>                Move '23:59:00' to TimeReg.end_time
16337>>>                Move Comment to TimeReg.Comments
16338>>>
16338>>>                Clear TimeReg
16339>>>                //Reread TimeReg
16339>>>                Move UserId to TimeReg.UserId
16340>>>                Move ProjectId to TimeReg.ProjectId
16341>>>                Move (Date(CurrentDateTime())) to TimeReg.start_date
16342>>>                    //Move (DateSetSecond(tmVar, (DateGetSecond(CurrentDateTime())))) to tmVar
16342>>>                    //Move (DateSetMinute(tmVar, (DateGetMinute(CurrentDateTime())))) to tmVar
16342>>>                    //Move (DateSetHour  (tmVar, (DateGetHour(CurrentDateTime())))) to tmVar
16342>>>                Move '00:00:00' to TimeReg.start_time
16343>>>                Move Comment to TimeReg.Comments
16344>>>
16344>>>                Move (Date(CurrentDateTime())) to TimeReg.end_date
16345>>>                Move (DateSetSecond(tmVar, (DateGetSecond(CurrentDateTime())))) to tmVar
16346>>>                Move (DateSetMinute(tmVar, (DateGetMinute(CurrentDateTime())))) to tmVar
16347>>>                Move (DateSetHour  (tmVar, (DateGetHour(CurrentDateTime())))) to tmVar
16348>>>                Move tmVar to TimeReg.end_time
16349>>>                Move Comment to TimeReg.Comments
16350>>>
16350>>>                SaveRecord TimeReg 
16351>>>            End
16351>>>>
16351>>>            Unlock
16352>>>>
16352>>>            Function_Return 1
16353>>>        End
16353>>>>
16353>>>       
16353>>>        Function_Return 0
16354>>>    End_Function
16355>>>
16355>>>    Function hasOpen Integer iUserId Returns Integer
#REM SEND REGISTERINTERFACE |CI5643 "get_hasOpen" "Integer iUserId Returns Integer" ""
16359>>>        Clear TimeReg
16360>>>        Move iUserId to TimeReg.UserId
16361>>>        Move "" to TimeReg.end_time
16362>>>        Find ge TimeReg by Index.1
16363>>>>
16363>>>        If (TimeReg.end_time = "     " and TimeReg.UserId = iUserId) Function_Return TimeReg.ProjectId
16366>>>        Function_Return -1
16367>>>    End_Function
16368>>>
16368>>>    Function hasOpenComment Integer iUserId Returns String
#REM SEND REGISTERINTERFACE |CI5644 "get_hasOpenComment" "Integer iUserId Returns String" ""
16372>>>        Clear TimeReg
16373>>>        Move iUserId to TimeReg.UserId
16374>>>        Move "" to TimeReg.end_time
16375>>>        Find ge TimeReg by Index.1
16376>>>>
16376>>>        If (TimeReg.end_time = "     " and TimeReg.UserId = iUserId) Function_Return TimeReg.Comments
16379>>>        Function_Return ""
16380>>>    End_Function
16381>>>
16381>>>    Function dayReport Integer iUserId String RepDate Integer working Returns String
#REM SEND REGISTERINTERFACE |CI5645 "get_dayReport" "Integer iUserId String RepDate Integer working Returns String" ""
16385>>>        String sRet zeroH zeroM sComments
16385>>>        Integer first hours minutes totalMinutes startMinutes endMinutes
16385>>>        Integer stops
16385>>>        Boolean found1 found2 activeProject
16385>>>        Move 1 to first
16386>>>        Move ('{date:"' + RepDate + '", list:[') to sRet
16387>>>        // Get my projects from UserProj
16387>>>        Clear UserProj
16388>>>        Move iUserId to UserProj.UserId
16389>>>        Find ge UserProj by Index.1
16390>>>>
16390>>>        Move Found to found1
16391>>>        // foreach UserProj get Project data
16391>>>        While (Found1)
16395>>>            If (UserProj.UserId = iUserId) Begin
16397>>>                Clear TimeReg
16398>>>                Move iUserId to TimeReg.UserId
16399>>>                Move RepDate to TimeReg.start_date
16400>>>                Find ge TimeReg by Index.2
16401>>>>
16401>>>                Move Found to found2
16402>>>                Move 0 to stops
16403>>>                Move False to activeProject
16404>>>                Move '' to sComments
16405>>>                While (Found2)
16409>>>                    If (RepDate = TimeReg.start_date and TimeReg.end_time <> "     ") Begin
16411>>>                        If (TimeReg.ProjectId = UserProj.ProjectId) Begin
16413>>>                            //get start and end date
16413>>>                            Move (sComments + ', ' + Timereg.Comments) to sComments
16414>>>                            Move (mid(TimeReg.start_time, 2, 1)) to hours
16415>>>                            Move (mid(TimeReg.start_time, 2, 4)) to minutes
16416>>>                            Move ((60*hours)+minutes) to startMinutes
16417>>>                            Move (mid(TimeReg.end_time, 2, 1)) to hours
16418>>>                            Move (mid(TimeReg.end_time, 2, 4)) to minutes
16419>>>                            Move ((60*hours)+minutes) to endMinutes
16420>>>                            //add to total minutes
16420>>>                            Move (endMinutes-startMinutes+totalMinutes) to totalMinutes
16421>>>                            
16421>>>                            Move (stops+1) to stops
16422>>>                        End
16422>>>>
16422>>>                    End
16422>>>>
16422>>>                    If (RepDate = TimeReg.start_date and TimeReg.ProjectId = UserProj.ProjectId and (TimeReg.end_time = "     " and TimeReg.start_time <> "     ")) Begin
16424>>>                        Move True to activeProject
16425>>>                        Move 1 to totalMinutes //Only to tell that there is something going on here
16426>>>                    End
16426>>>>
16426>>>                    Find gt TimeReg by Index.2
16427>>>>
16427>>>                    Move Found to Found2
16428>>>                    If (Found2) Move (RepDate = TimeReg.start_date) to found2
16431>>>                Loop
16432>>>>
16432>>>                
16432>>>                Move (totalMinutes/60) to hours
16433>>>                Move (totalMinutes-(hours*60)) to minutes
16434>>>                
16434>>>    
16434>>>                Move "" to zeroH
16435>>>                Move "" to zeroM
16436>>>                If (hours < 10) Move "0" to zeroH
16439>>>                If (minutes < 10) Move "0" to zeroM
16442>>>               
16442>>>                If (totalMinutes > 0) Begin
16444>>>                    If (first = 0) Begin
16446>>>                        Move (sRet + ', ') to sRet
16447>>>                    End
16447>>>>
16447>>>                    Move 0 to first
16448>>>                    Clear Project
16449>>>                    Move UserProj.ProjectId to Project.ProjectId
16450>>>                    Find eq Project by Index.1
16451>>>>
16451>>>                    If (activeProject) Begin
16453>>>                        Move (sRet + '{"name": "' + HtmlEncodeJB(String(Trim(Project.name))) + '", "comments": "' + HtmlEncodeJB(sComments) + '", "time": "active", "stops": "'+String(stops)+'"}') to sRet
16454>>>                    End
16454>>>>
16454>>>                    Else Begin
16455>>>                        Move (sRet + '{"name": "' + HtmlEncodeJB(String(Trim(Project.name))) + '", "comments": "' + HtmlEncodeJB(sComments) + '", "time": "' + zeroH + String(hours) + ':' + zeroM + String(minutes) + '", "stops": "'+String(stops)+'"}') to sRet
16456>>>                    End
16456>>>>
16456>>>                End
16456>>>>
16456>>>                Move 0 to totalMinutes
16457>>>            End
16457>>>>
16457>>>            Find gt UserProj by Index.1
16458>>>>
16458>>>            Move Found to found1
16459>>>        Loop
16460>>>>
16460>>>        Move (sRet + ']}') to sRet
16461>>>        Function_Return sRet
16462>>>    End_Function
16463>>>
16463>>>    Function intervalReport Integer iUserId Date startDate Date endDate Returns String
#REM SEND REGISTERINTERFACE |CI5646 "get_intervalReport" "Integer iUserId Date startDate Date endDate Returns String" ""
16467>>>        String sRet zeroH zeroM sComments
16467>>>        Integer first hours minutes totalMinutes startMinutes endMinutes
16467>>>        Integer stops firstDay 
16467>>>        Date RepDate
16467>>>        Boolean found1 found2 activeProject
16467>>>        
16467>>>        Move ('{days:[') to sRet
16468>>>        Move 1 to firstDay
16469>>>        Move startDate to RepDate
16470>>>        While (RepDate <= endDate)
16474>>>            If (firstDay = 0) Begin
16476>>>                Move (sRet + ', ') to sRet
16477>>>            End
16477>>>>
16477>>>            Move 0 to firstDay
16478>>>            Move 1 to first
16479>>>            Move (String(sRet) + '{date:"' + String(RepDate) + '", list:[') to sRet
16480>>>            // Get my projects from UserProj
16480>>>            Clear UserProj
16481>>>            Move iUserId to UserProj.UserId
16482>>>            Find ge UserProj by Index.1
16483>>>>
16483>>>            Move Found to found1
16484>>>            // foreach UserProj get Project data
16484>>>            While (Found1)
16488>>>                If (UserProj.UserId = iUserId) Begin
16490>>>                    Clear TimeReg
16491>>>                    Move iUserId to TimeReg.UserId
16492>>>                    Move RepDate to TimeReg.start_date
16493>>>                    Find ge TimeReg by Index.2
16494>>>>
16494>>>                    Move Found to found2
16495>>>                    Move 0 to stops
16496>>>                    Move False to activeProject
16497>>>                    Move '' to sComments
16498>>>                    While (Found2)
16502>>>                        If (RepDate = TimeReg.start_date and TimeReg.end_time <> "     ") Begin
16504>>>                            If (TimeReg.ProjectId = UserProj.ProjectId) Begin
16506>>>                                //get start and end date
16506>>>                                If (sComments = "") Begin
16508>>>                                   Move (Timereg.Comments) to sComments 
16509>>>                                End
16509>>>>
16509>>>                                Else Begin
16510>>>                                    Move (sComments + ', ' + Timereg.Comments) to sComments
16511>>>                                End
16511>>>>
16511>>>                                Move (mid(TimeReg.start_time, 2, 1)) to hours
16512>>>                                Move (mid(TimeReg.start_time, 2, 4)) to minutes
16513>>>                                Move ((60 * hours) + minutes) to startMinutes
16514>>>                                Move (mid(TimeReg.end_time, 2, 1)) to hours
16515>>>                                Move (mid(TimeReg.end_time, 2, 4)) to minutes
16516>>>                                Move ((60 * hours) + minutes) to endMinutes
16517>>>                                //add to total minutes
16517>>>                                Move (endMinutes-startMinutes+totalMinutes) to totalMinutes
16518>>>                                
16518>>>                                Move (stops+1) to stops
16519>>>                            End
16519>>>>
16519>>>                        End
16519>>>>
16519>>>                        If (RepDate = TimeReg.start_date and TimeReg.ProjectId = UserProj.ProjectId and (TimeReg.end_time = "     " and TimeReg.start_time <> "     ")) Begin
16521>>>                            Move True to activeProject
16522>>>                            Move 1 to totalMinutes //Only to tell that there is something going on here
16523>>>                        End
16523>>>>
16523>>>                        Find gt TimeReg by Index.2
16524>>>>
16524>>>                        Move Found to Found2
16525>>>                        If (Found2) Move (RepDate = TimeReg.start_date) to found2
16528>>>                    Loop
16529>>>>
16529>>>                    
16529>>>                    Move (totalMinutes/60) to hours
16530>>>                    Move (totalMinutes-(hours*60)) to minutes
16531>>>        
16531>>>                    Move "" to zeroH
16532>>>                    Move "" to zeroM
16533>>>                    If (hours < 10) Move "0" to zeroH
16536>>>                    If (minutes < 10) Move "0" to zeroM
16539>>>                   
16539>>>                    If (totalMinutes > 0) Begin
16541>>>                        If (first = 0) Begin
16543>>>                            Move (sRet + ', ') to sRet
16544>>>                        End
16544>>>>
16544>>>                        Move 0 to first
16545>>>                        Clear Project
16546>>>                        Move UserProj.ProjectId to Project.ProjectId
16547>>>                        Find eq Project by Index.1
16548>>>>
16548>>>//                        If (activeProject) Begin
16548>>>//                            Move (sRet + '{"name": "' + String(Trim(Project.name)) + '", "time": "active", "stops": "'+String(stops)+'"}') to sRet
16548>>>//                        End
16548>>>//                        Else Begin
16548>>>//                            Move (sRet + '{"name": "' + String(Trim(Project.name)) + '", "time": "' + zeroH + String(hours) + ':' + zeroM + String(minutes) + '", "stops": "'+String(stops)+'"}') to sRet
16548>>>//                        End
16548>>>                        If (activeProject) Begin
16550>>>                            Move (sRet + '{"name": "' + HtmlEncodeJB(String(Trim(Project.name))) + '", "comments": "' + HtmlEncodeJB(sComments) + '", "time": "active", "stops": "'+String(stops)+'"}') to sRet
16551>>>                        End
16551>>>>
16551>>>                        Else Begin
16552>>>                            Move (sRet + '{"name": "' + HtmlEncodeJB(String(Trim(Project.name))) + '", "comments": "' + HtmlEncodeJB(sComments) + '", "time": "' + zeroH + String(hours) + ':' + zeroM + String(minutes) + '", "stops": "'+String(stops)+'"}') to sRet
16553>>>                        End
16553>>>>
16553>>>                    End
16553>>>>
16553>>>                    Move 0 to totalMinutes
16554>>>                End
16554>>>>
16554>>>                Find gt UserProj by Index.1
16555>>>>
16555>>>                Move Found to found1
16556>>>            Loop
16557>>>>
16557>>>            Move (sRet + ']}') to sRet
16558>>>            Move (RepDate + 1) to RepDate
16559>>>        Loop
16560>>>>
16560>>>        Move (sRet + ']}') to sRet
16561>>>
16561>>>        Function_Return sRet
16562>>>    End_Function
16563>>>
16563>>>End_Object // oProject
16564>    Use Register.wo
Including file: Register.wo    (C:\VDF programs\timer\AppSrc\Register.wo)
16564>>>// C:\VDF Programs\TimeReg\AppSrc\Register.wo
16564>>>// Register
16564>>>//
16564>>>
16564>>>Use cAjaxWebBusinessProcess.pkg
16564>>>
16564>>>Use cCompanyDataDictionary.dd
16564>>>Use User.DD
16564>>>
16564>>>Object oRegister Is A cAjaxWebBusinessProcess
16566>>>    Set psDescription to "Register"
16567>>>    Set pbClearAfterSave to False
16568>>>
16568>>>    Object oCompany_DD Is A cCompanyDataDictionary
16570>>>    End_Object // oCompany_DD
16571>>>
16571>>>    Object oUser_DD Is A User_DataDictionary
16573>>>        Set DDO_Server To oCompany_DD
16574>>>        Procedure Save_Main_File
16577>>>            Move "A" to User.State
16578>>>            Move "Y" to User.EditRights
16579>>>            Forward Send Save_Main_File
16581>>>        End_Procedure
16582>>>    End_Object // oUser_DD
16583>>>
16583>>>    Set Main_DD To oUser_DD
16584>>>
16584>>>    Send RegisterStandardInterface
16585>>>    //Send RegisterDebugInterface
16585>>>    //Send RegisterFullErrorInterface
16585>>>    //Send RegisterAutoEntryInterface
16585>>>
16585>>>
16585>>>// FUNCTION NOT IN USE
16585>>>
16585>>>    Function registerNewUser String Username String Password String Name String Surname String Mail Returns Integer
#REM SEND REGISTERINTERFACE |CI5647 "get_registerNewUser" "String Username String Password String Name String Surname String Mail Returns Integer" "Registers the user"
16589>>>        Integer iError
16589>>>        Move 0 to iError
16590>>>       
16590>>>        If (Username = "") Begin
16592>>>            Move 950 to iError
16593>>>            Error 950 "Username may not be blank!"
16594>>>>
16594>>>            Function_Return iError
16595>>>        End
16595>>>>
16595>>>        
16595>>>        Clear User
16596>>>        Move Username to User.LoginName
16597>>>        Move Password to User.Password
16598>>>        Move Name     to User.FirstName
16599>>>        Move Surname  to User.LastName
16600>>>        Move Mail     to User.Mail
16601>>>        Move 'A'      to User.State
16602>>>        Move 'Y'      to User.EditRights
16603>>>        
16603>>>        SaveRecord User
16604>>>        Function_Return iError
16605>>>    End_Function
16606>>>
16606>>>End_Object // oRegister
16607>    Use UserProj.wo
Including file: UserProj.wo    (C:\VDF programs\timer\AppSrc\UserProj.wo)
16607>>>// C:\VDF Programs\TimeReg\AppSrc\UserProj.wo
16607>>>// UserProj
16607>>>//
16607>>>
16607>>>Use cAjaxWebBusinessProcess.pkg
16607>>>
16607>>>Use cCompanyDataDictionary.dd
16607>>>Use CUSTOMER.DD
16607>>>Use cProjectDataDictionary.dd
16607>>>Use User.DD
16607>>>Use cUserprojDataDictionary.dd
Including file: cUserprojDataDictionary.dd    (C:\VDF programs\timer\DdSrc\cUserprojDataDictionary.dd)
16607>>>>>Use DataDict.pkg
16607>>>>>
16607>>>>>Open UserProj
16609>>>>>Open User
16611>>>>>Open Project
16613>>>>>
16613>>>>>Class cUserprojDataDictionary is a DataDictionary
16614>>>>>    
16614>>>>>    Procedure Construct_Object
16616>>>>>        Forward Send Construct_Object
16618>>>>>        Set Main_file to UserProj.File_Number
16619>>>>>
16619>>>>>        Set Add_Server_File to User.File_Number
16620>>>>>        Set Add_Server_File to Project.File_Number
16621>>>>>
16621>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_NOPUT to True
16622>>>>>        Set Foreign_Field_Option DD_KEYFIELD DD_FINDREQ to True
16623>>>>>        Set Foreign_Field_Option DD_INDEXFIELD DD_NOPUT to True
16624>>>>>        Set Foreign_Field_Option DD_DEFAULT DD_DISPLAYONLY to True
16625>>>>>
16625>>>>>    End_Procedure
16626>>>>>
16626>>>>>End_Class
16627>>>
16627>>>Object oUserProj Is A cAjaxWebBusinessProcess
16629>>>    Set psDescription to "UserProj"
16630>>>    Set pbClearAfterSave to False
16631>>>
16631>>>
16631>>>    Object oCompany_DD Is A cCompanyDataDictionary
16633>>>    End_Object // oCompany_DD
16634>>>
16634>>>    Object oCustomer_DD Is A Customer_DataDictionary
16636>>>        Set DDO_Server To oCompany_DD
16637>>>//        Procedure OnConstrain
16637>>>//            Constrain customer.CompanyId eq session.CompanyId
16637>>>//        End_Procedure
16637>>>    End_Object // oCustomer_DD
16638>>>
16638>>>    Object oProject_DD Is A cProjectDataDictionary
16640>>>        Set DDO_Server To oCustomer_DD
16641>>>//        Procedure OnConstrain
16641>>>//            Constrain project.CompanyId eq session.CompanyId
16641>>>//        End_Procedure
16641>>>    End_Object // oProject_DD
16642>>>
16642>>>    Object oUser_DD Is A User_DataDictionary
16644>>>        Set DDO_Server To oCompany_DD
16645>>>        Procedure OnConstrain
16648>>>            Constrain user.CompanyId eq session.CompanyId
16650>>>        End_Procedure
16651>>>    End_Object // oUser_DD
16652>>>
16652>>>    Object oUserproj_DD Is A cUserprojDataDictionary
16654>>>        Set DDO_Server To oUser_DD
16655>>>        Set DDO_Server To oProject_DD
16656>>>        Set Constrain_File to User.File_Number
16657>>>    End_Object // oUserproj_DD
16658>>>
16658>>>    Set Main_DD To oUser_DD
16659>>>
16659>>>
16659>>>    Send RegisterStandardInterface
16660>>>    //Send RegisterDebugInterface
16660>>>    //Send RegisterFullErrorInterface
16660>>>    //Send RegisterAutoEntryInterface
16660>>>
16660>>>End_Object // oUserProj
16661>    Use UserReport.wo
Including file: UserReport.wo    (C:\VDF programs\timer\AppSrc\UserReport.wo)
16661>>>Use cAjaxWebBusinessProcess.pkg
16661>>>Use cWebReport.pkg
16661>>>
16661>>>Use User.DD
16661>>>
16661>>>Object oUserReport is a cWebBusinessProcess
16663>>>    Set pbAllowDelete to False
16664>>>    Set pbAllowSaveEdit to FALSE
16665>>>    Set pbAllowSaveNew to FALSE
16666>>>    Set pbVerboseErrors to TRUE
16667>>>    Set psDescription to "User Information Drill Down Report"
16668>>>
16668>>>    Object oUser_DD is a User_DataDictionary
16670>>>        Send DefineAllExtendedFields
16671>>>
16671>>>        Property Number pnStartStart_Date
16673>>>        Property Number pnStopStartDate
16675>>>        
16675>>>        Procedure OnConstrain
16678>>>            Number nStart nStop
16678>>>            Date   dStart dStop
16678>>>            String sStart sStop
16678>>>        
16678>>>            Get pnStartCustomer_Number To nStart
16679>>>            Get pnStopCustomer_Number  To nStop
16680>>>        
16680>>>            If (nStart<>0 And nStop<>0) ;                Constrain Customer.CustomerId Between nStart and nStop
16686>>>            Else If (nStart>0) ;                Constrain Customer.CustomerId Ge nStart
16691>>>            Else If (nStop<0) ;                Constrain Customer.CustomerId Le nStop
16696>>>        End_Procedure
16697>>>
16697>>>    End_Object
16698>>>
16698>>>    Set Main_DD to oCustomer_DD
16699>>>
16699>>>    Object oReport is a cWebReport
16701>>>        
16701>>>        Procedure OnPageTop
16704>>>            Send WriteHtmlTableBegin 'border="0" width="99%" class="ReportTable"'
16705>>>        
16705>>>            Send WriteHtmlRowBegin
16706>>>                Send WriteHtmlCellHeader 'Number' 'class="Header" align="right"'
16707>>>                Send WriteHtmlCellHeader 'Customer Name' 'class="Header" align="left"'
16708>>>                Send WriteHtmlCellHeader 'Phone' 'class="Header" align="left"'
16709>>>                Send WriteHtmlCellHeader 'Balance' 'class="Header" align="right"'
16710>>>                Send WriteHtmlCellHeader 'Status' 'class="Header" align="left"'
16711>>>            Send WriteHtmlRowEnd
16712>>>        End_Procedure
16713>>>        
16713>>>        Procedure OnBody
16716>>>            String sText sName sPhone sStatus
16716>>>            Number nID nBalance
16716>>>        
16716>>>            Send WriteHtmlRowBegin
16717>>>                Get ddValueEncode "Customer.CustomerId" To nID
16718>>>                Get ddValueEncode "Customer.Name"            To sName
16719>>>                Get ddValueEncode "Customer.Phone_Number"    To sPhone
16720>>>                Get ddValueEncode "Customer.Balance"         To nBalance
16721>>>                Get ddValueEncode "Customer.Status" DDDESC   to sStatus
16722>>>                Get AddRowIdLink (FormatNumber(nId,0)) To sText
16723>>>                Send WriteHtmlCell sText 'class="Data" align="center"'
16724>>>                Get AddRowIdLink sName To sText
16725>>>                Send WriteHtmlCell sText 'class="Data" align="left"'
16726>>>                Send WriteHtmlCell sPhone 'class="Data" align="left"'
16727>>>                Send WriteHtmlCell (FormatNumber(nBalance,2)) 'class="Data" align="right"'
16728>>>                Send WriteHtmlCell sStatus 'class="Data" align="left"'
16729>>>            Send WriteHtmlRowEnd
16730>>>        End_Procedure
16731>>>        
16731>>>        Procedure OnPageBottom
16734>>>            Send WriteHtmlTableEnd
16735>>>        End_Procedure
16736>>>        
16736>>>        Function RunCustomerReport Integer iIndex RowId riStart Integer iMax Returns RowId
16739>>>            RowId   riEnd
16739>>>            Integer iEnd iStat
16739>>>        
16739>>>            Set piOrdering           To iIndex
16740>>>            Set piMaxCount           To iMax
16741>>>            Set piMaxCountBreakLevel To 0
16742>>>            Set priStartRowId        To riStart
16743>>>            Get DoRunReport          To iStat
16744>>>            Get priLastRowId         To riEnd
16745>>>            Function_Return riEnd
16746>>>        End_Function
16747>>>
16747>>>    End_Object
16748>>>    
16748>>>    Procedure SetHRefName String sName
#REM SEND REGISTERINTERFACE |CI5626 "msg_SetHRefName" "String sName" "Sets the full URL of a file to be displayed in drill down operation"
16752>>>        Set psHRefname Of oReport To sName
16753>>>    End_Procedure
16754>>>    
16754>>>    Procedure SetCustomer_Number String sStart String sStop
#REM SEND REGISTERINTERFACE |CI5627 "msg_SetCustomer_Number" "String sStart String sStop" "Sets the start & stop customer number"
16758>>>        Handle hDD
16758>>>    
16758>>>        Get phMainDD To hDD
16759>>>        Set pnStartCustomer_Number Of hDD To sStart
16760>>>        Set pnStopCustomer_Number  Of hDD To sStop
16761>>>    End_Procedure
16762>>>    
16762>>>    Function RunCustomerReport Integer iIndex string sStart Integer iMax Returns string
#REM SEND REGISTERINTERFACE |CI5625 "get_RunCustomerReport" "Integer iIndex string sStart Integer iMax Returns string" "Starts "
16766>>>        Rowid riEnd
16766>>>    
16766>>>        Get RunCustomerReport Of oReport iIndex (DeserializeRowId(sStart)) iMax To riEnd
16767>>>    
16767>>>        Function_Return (SerializeRowid(riEnd))
16768>>>    End_Function    
16769>>>    
16769>>>    Send RegisterStandardInterface
16770>>>    
16770>>>End_Object
16771>    Use TimeReport.wo
Including file: TimeReport.wo    (C:\VDF programs\timer\AppSrc\TimeReport.wo)
16771>>>// TimeReport.wo
16771>>>// TimeReport
16771>>>Use cWebBusinessProcess.pkg
16771>>>Use cWebReport.pkg
16771>>>
16771>>>Use cCompanyDataDictionary.dd
16771>>>Use CUSTOMER.DD
16771>>>Use cProjectDataDictionary.dd
16771>>>Use User.DD
16771>>>Use cTimeregDataDictionary.dd
16771>>>
16771>>>Object oTimeReport Is A cWebBusinessProcess
16773>>>    Set psDescription to "....vvTimeReport"
16774>>>
16774>>>
16774>>>    Object oCompany_DD Is A cCompanyDataDictionary
16776>>>        Send DefineAllExtendedFields
16777>>>    End_Object // oCompany_DD
16778>>>
16778>>>    Object oCustomer_DD Is A Customer_DataDictionary
16780>>>        Send DefineAllExtendedFields
16781>>>//        Set DDO_Server To oCompany_DD
16781>>>        Property String psStartName
16783>>>        Property String psStopName
16785>>>
16785>>>        Procedure OnConstrain 
16788>>>            String sStart sStop
16788>>>//            Constrain customer.CompanyId eq session.CompanyId
16788>>>
16788>>>            Get psStartName to sStart
16789>>>            Get psStopName to sStop
16790>>>
16790>>>//            If (sStart <> "" And sStop <> "") Begin
16790>>>                Constrain Customer.NAME Between sStart and sStop
16794>>>//            End
16794>>>//            Else Begin
16794>>>//                If (sStart <> "") Begin
16794>>>//                    Constrain Customer.Name Ge sStart
16794>>>//                End
16794>>>//                Else Begin
16794>>>//                    If (sStop <> "") Begin
16794>>>//                        Constrain Customer.Name Le sStop
16794>>>//                    End
16794>>>//                End
16794>>>//            End
16794>>>        End_Procedure // OnConstrain
16795>>>    End_Object // oCustomer_DD
16796>>>
16796>>>    Object oProject_DD Is A cProjectDataDictionary
16798>>>        Send DefineAllExtendedFields
16799>>>        Set DDO_Server To oCustomer_DD
16800>>>        Property String psStartID
16802>>>        Property String psStopID
16804>>>
16804>>>        Procedure OnConstrain 
16807>>>            String sStart sStop
16807>>>            Get psStartID to sStart
16808>>>            Get psStopID to sStop
16809>>>
16809>>>            If (sStart <> 0 and sStop <> 0) Begin
16811>>>                Constrain Project.ProjectId Between sStart and sStop
16815>>>            End
16815>>>>
16815>>>
16815>>>//            Else Begin
16815>>>//                If (sStart <> "") Begin
16815>>>//                    Constrain Project.Name Ge sStart
16815>>>//                End
16815>>>//                Else Begin
16815>>>//                    If (sStop <> "") Begin
16815>>>//                        Constrain Project.Name Le sStop
16815>>>//                    End
16815>>>//                End
16815>>>//            End
16815>>>        End_Procedure // OnConstrain
16816>>>    End_Object // oProject_DD
16817>>>
16817>>>    Object oUser_DD Is A User_DataDictionary
16819>>>        Send DefineAllExtendedFields
16820>>>        Set DDO_Server To oCompany_DD
16821>>>        Property String psStartLoginID
16823>>>        Property String psStopLoginID
16825>>>
16825>>>        Procedure OnConstrain 
16828>>>            String sStart sStop
16828>>>//            Constrain User.UserId eq session.UserId
16828>>>//
16828>>>            Get psStartLoginID to sStart
16829>>>            Get psStopLoginID to sStop
16830>>>//
16830>>>//            If (sStart <> "" And sStop <> "") Begin
16830>>>                Constrain User.UserId Between sStart and sStop
16834>>>//            End
16834>>>//            Else Begin
16834>>>//                If (sStart <> "") Begin
16834>>>//                    Constrain User.Loginname Ge sStart
16834>>>//                End
16834>>>//                Else Begin
16834>>>//                    If (sStop <> "") Begin
16834>>>//                        Constrain User.Loginname Le sStop
16834>>>//                    End
16834>>>//                End
16834>>>//            End
16834>>>        End_Procedure // OnConstrain
16835>>>    End_Object // oUser_DD
16836>>>
16836>>>    Object oTimereg_DD Is A cTimeregDataDictionary
16838>>>        Set DDO_Server To oProject_DD
16839>>>        Send DefineAllExtendedFields
16840>>>        Set DDO_Server To oUser_DD
16841>>>        Property Date pdStartstart_date
16843>>>        Property Date pdStopstart_date
16845>>>        Property String psStartstart_time
16847>>>        Property String psStopstart_time
16849>>>        Property Date pdStartend_date
16851>>>        Property Date pdStopend_date
16853>>>        Property String psStartend_time
16855>>>        Property String psStopend_time
16857>>>
16857>>>        Procedure OnConstrain 
16860>>>            Date dStart dStop
16860>>>            String sStart sStop
16860>>>
16860>>>            Get pdStartstart_date to dStart
16861>>>            Get pdStopstart_date to dStop
16862>>>//            If (dStart <> 0 and dStop <> 0) Begin
16862>>>                Constrain Timereg.Start_Date Between dStart and dStop
16866>>>//            End
16866>>>//            Else Begin
16866>>>//                If (dStart <> 0) Begin
16866>>>//                    Constrain Timereg.Start_Date Ge dStart
16866>>>//                End
16866>>>//                Else Begin
16866>>>//                    If (dStop <> 0) Begin
16866>>>//                        Constrain Timereg.Start_Date Le dStop
16866>>>//                    End
16866>>>//                End
16866>>>//            End
16866>>>//
16866>>>//            Get psStartstart_time To sStart
16866>>>//            Get psStopstart_time To sStop
16866>>>//
16866>>>//            If (sStart <> "" And sStop <> "") Begin
16866>>>//                Constrain Timereg.Start_Time Between sStart And sStop
16866>>>//            End
16866>>>//            Else Begin
16866>>>//                If (sStart <> "") Begin
16866>>>//                    Constrain Timereg.Start_Time Ge sStart
16866>>>//                End
16866>>>//                Else Begin
16866>>>//                    If (sStop <> "") Begin
16866>>>//                        Constrain Timereg.Start_Time Le sStop
16866>>>//                    End
16866>>>//                End
16866>>>//            End
16866>>>//
16866>>>//            Get pdStartend_date To dStart
16866>>>//            Get pdStopend_date To dStop
16866>>>//
16866>>>//            If (dStart <> 0 And dStop <> 0) Begin
16866>>>//                Constrain Timereg.End_Date Between dStart And dStop
16866>>>//            End
16866>>>//            Else Begin
16866>>>//                If (dStart <> 0) Begin
16866>>>//                    Constrain Timereg.End_Date Ge dStart
16866>>>//                End
16866>>>//                Else Begin
16866>>>//                    If (dStop <> 0) Begin
16866>>>//                        Constrain Timereg.End_Date Le dStop
16866>>>//                    End
16866>>>//                End
16866>>>//            End
16866>>>//
16866>>>//            Get psStartend_time To sStart
16866>>>//            Get psStopend_time To sStop
16866>>>//
16866>>>//            If (sStart <> "" And sStop <> "") Begin
16866>>>//                Constrain Timereg.End_Time Between sStart And sStop
16866>>>//            End
16866>>>//            Else Begin
16866>>>//                If (sStart <> "") Begin
16866>>>//                    Constrain Timereg.End_Time Ge sStart
16866>>>//                End
16866>>>//                Else Begin
16866>>>//                    If (sStop <> "") Begin
16866>>>//                        Constrain Timereg.End_Time Le sStop
16866>>>//                    End
16866>>>//                End
16866>>>//            End
16866>>>        End_Procedure // OnConstrain
16867>>>    End_Object // oTimereg_DD
16868>>>
16868>>>    Set Main_DD To oTimereg_DD
16869>>>
16869>>>
16869>>>    Object oReport is a cWebReport
16871>>>        Property Integer piTotalMinutes 
16873>>>        Property Integer piTotalHours
16875>>>        
16875>>>//        Procedure OnPageTop 
16875>>>//            Send WriteHtmlTableBegin 'border="2" width="99%" class="ReportTable"'
16875>>>//
16875>>>//            Send WriteHtmlRowBegin
16875>>>//                Send WriteHtmlCellHeader 'Customer Name' 'class="Header" align="left"'
16875>>>//                Send WriteHtmlCellHeader 'Name' 'class="Header" align="left"'
16875>>>//                Send WriteHtmlCellHeader 'Loginname' 'class="Header" align="left"'
16875>>>//                Send WriteHtmlCellHeader 'Start Date' 'class="Header" align="left"'
16875>>>//                Send WriteHtmlCellHeader 'Start Time' 'class="Header" align="left"'
16875>>>//                Send WriteHtmlCellHeader 'End Date' 'class="Header" align="left"'
16875>>>//                Send WriteHtmlCellHeader 'End Time' 'class="Header" align="left"'
16875>>>//            Send WriteHtmlRowEnd
16875>>>//        End_Procedure // OnPageTop
16875>>>
16875>>>        Function Break1 Returns String
16878>>>            RowID  riRec
16878>>>            String sRec
16878>>>            Move (GetRowId(Project.File_number)) to riRec
16879>>>            Move (SerializeRowId(riRec)) to sRec
16880>>>            Function_Return sRec //  Break every time the parent record changes
16881>>>        End_Function // Break1
16882>>>
16882>>>        Procedure OnInitBreakpoints 
16885>>>            Send RegisterBreakpoint Get_Break1
16886>>>        End_Procedure // OnInitBreakpoints
16887>>>
16887>>>        Procedure OnPageTop
16890>>>            String sCustomerCustomerid
16890>>>            String sCustomerName
16890>>>            String sProjectName
16890>>>            String sUserLoginname
16890>>>            Set piTotalHours to 0
16891>>>             
16891>>>
16891>>>            Get ddValueEncode "Customer.Name" to sCustomerName
16892>>>//            Get ddValueEncode "Customer.Customerid" to sCustomerCustomerid
16892>>>            Get ddValueEncode "Project.Name" to sProjectName
16893>>>            Get ddValueEncode "User.Loginname" to sUserLoginname
16894>>>       
16894>>>            Send WriteHtmlTableBegin 'border="0" width="50%" class="ReportHdr1Table"'
16895>>>
16895>>>            Send WriteHtmlRowBegin
16896>>>                Send WriteHtmlCellHeader 'Customer Name' 'class="Label"'
16897>>>                Send WriteHtmlCell sCustomerName 'class="Data"'
16898>>>            Send WriteHtmlRowEnd
16899>>>            Send WriteHtmlRowBegin
16900>>>                Send WriteHtmlCellHeader 'Loginname' 'class="Label"'
16901>>>                Send WriteHtmlCell sUserLoginname 'class="Data"'
16902>>>            Send WriteHtmlRowEnd
16903>>>
16903>>>            Send WriteHtmlTableEnd
16904>>>
16904>>>
16904>>>
16904>>>        End_Procedure
16905>>>        
16905>>>        Procedure OnSubHeader1 
16908>>>            String sCustomerCustomerid
16908>>>            String sCustomerName
16908>>>            String sProjectName
16908>>>            String sUserLoginname
16908>>>            Set piTotalMinutes to 0
16909>>>
16909>>>            Get ddValueEncode "Customer.Name" to sCustomerName
16910>>>//            Get ddValueEncode "Customer.Customerid" to sCustomerCustomerid
16910>>>            Get ddValueEncode "Project.Name" to sProjectName
16911>>>            Get ddValueEncode "User.Loginname" to sUserLoginname
16912>>>
16912>>>            Send WriteHtmlTableBegin 'border="0" width="200" class="ReportHdr1Table"'
16913>>>
16913>>>//            Send WriteHtmlRowBegin
16913>>>//                Send WriteHtmlCellHeader 'Customer Name' 'class="Label"'
16913>>>//                Send WriteHtmlCell sCustomerName 'class="Data"'
16913>>>//            Send WriteHtmlRowEnd
16913>>>            Send WriteHtmlRowBegin
16914>>>                Send WriteHtmlCellHeader 'Projekt' 'class="Label"'
16915>>>                Send WriteHtmlCell sProjectName 'class="Data"'
16916>>>            Send WriteHtmlRowEnd
16917>>>//            Send WriteHtmlRowBegin
16917>>>//                Send WriteHtmlCellHeader 'Loginname' 'class="Label"'
16917>>>//                Send WriteHtmlCell sUserLoginname 'class="Data"'
16917>>>//            Send WriteHtmlRowEnd
16917>>>
16917>>>            Send WriteHtmlTableEnd
16918>>>
16918>>>            Send WriteHtmlTableBegin 'border="0" width="99%" class="ReportTable"'
16919>>>
16919>>>            Send WriteHtmlRowBegin
16920>>>//                Send WriteHtmlCellHeader 'Projectid' 'class="Header" align="right"'
16920>>>                Send WriteHtmlCellHeader 'Start Date' 'class="Header" align="left"'
16921>>>                Send WriteHtmlCellHeader 'Comments' 'class="Header" align="left"'
16922>>>                Send WriteHtmlCellHeader 'Start' 'class="Header" align="left"'
16923>>>//                Send WriteHtmlCellHeader 'End Date' 'class="Header" align="left"'
16923>>>                Send WriteHtmlCellHeader 'End' 'class="Header" align="left"'
16924>>>                Send WriteHtmlCellHeader 'Time' 'class="Header" align="left"'
16925>>>            Send WriteHtmlRowEnd
16926>>>        End_Procedure // OnSubHeader1
16927>>>
16927>>>
16927>>>        Procedure OnBody 
16930>>>            String sText, sComments
16930>>>            String sCustomerName
16930>>>            String sProjectName
16930>>>            String sUserLoginname
16930>>>            String sTimeregStart_Date
16930>>>            String sTimeregStart_Time
16930>>>            String sTimeregEnd_Date
16930>>>            String sTimeregEnd_Time
16930>>>            String sRet zeroH zeroM sTimeregTime
16930>>>            Integer iHours iMinutes iStartMinutes iEndMinutes iTotalMinutes iSubtotal1
16930>>>            Get AddRowIdLink (Timereg.Start_Date) to sText   
16931>>>            Get ddValueEncode "Timereg.Comments" to sComments 
16932>>>            Get ddValueEncode "Timereg.Start_Time" to sTimeregStart_Time
16933>>>            Get ddValueEncode "Timereg.End_Time" To sTimeregEnd_Time
16934>>>
16934>>>            Move (mid(sTimeregStart_Time, 2, 1)) to iHours
16935>>>            Move (mid(sTimeregStart_Time, 2, 4)) to iMinutes
16936>>>            Move ((60*iHours)+iMinutes) to iStartMinutes
16937>>>            Move (mid(sTimeregEnd_Time, 2, 1)) to iHours
16938>>>            Move (mid(sTimeregEnd_Time, 2, 4)) to iMinutes
16939>>>            Move ((60*iHours)+iMinutes) to iEndMinutes
16940>>>            Move (iEndMinutes-iStartMinutes+iTotalMinutes) to iTotalMinutes
16941>>>            Get piTotalMinutes to iSubtotal1
16942>>>            Move (iSubtotal1+iTotalMinutes) to iSubtotal1
16943>>>            Set piTotalMinutes to iSubtotal1
16944>>>            Move (iTotalMinutes/60) to iHours
16945>>>            Move (iTotalMinutes-(iHours*60)) to iMinutes
16946>>>            Move "" to zeroH
16947>>>            Move "" to zeroM
16948>>>            If (iHours < 10) Move "0" to zeroH
16951>>>            If (iMinutes < 10) Move "0" to zeroM
16954>>>            Move (zeroH - String(iHours) - ':' - zeroM - String(iMinutes)) to sTimeregTime
16955>>>            Send WriteHtmlRowBegin
16956>>>            Send WriteHtmlCell sText 'class="Data" align="left"'
16957>>>            Send WriteHtmlCell sComments 'class="Data" align="left"'
16958>>>            Send WriteHtmlCell sTimeregStart_Time 'class="Data" align="left"'
16959>>>            Send WriteHtmlCell sTimeregEnd_Time 'class="Data" align="left"'
16960>>>            Send WriteHtmlCell sTimeregTime 'class="Data" align="left"'
16961>>>            Send WriteHtmlRowEnd
16962>>>        End_Procedure // OnBody
16963>>>
16963>>>
16963>>>
16963>>>        Procedure OnSubTotal1 
16966>>>            Integer iSubtotal1 iHours iMinutes
16966>>>            Get piTotalMinutes to iSubtotal1
16967>>>            String zeroH zeroM sTimeregTime
16967>>>            Move (iSubTotal1/60) to iHours
16968>>>            Move (iSubtotal1-(iHours*60)) to iMinutes
16969>>>            Move "" to zeroH
16970>>>            Move "" to zeroM
16971>>>            If (iHours < 10) Move "0" to zeroH
16974>>>            If (iMinutes < 10) Move "0" to zeroM
16977>>>            Move (zeroH - String(iHours) - ':' - zeroM - String(iMinutes)) to sTimeregTime
16978>>>            Send WriteHtmlCell "" 'class="Header" align="left"'
16979>>>            Send WriteHtmlCell "" 'class="Header" align="left"'
16980>>>            Send WriteHtmlCell "" 'class="Header" align="left"'
16981>>>            Send WriteHtmlCell "" 'class="Header" align="left"'
16982>>>            Send WriteHtmlCell sTimeregTime 'class="Header" Style="text-align:left; padding-left:9px;"'
16983>>>            Send WriteHtmlTableEnd
16984>>>        End_Procedure // OnSubTotal1
16985>>>
16985>>>        Procedure OnPageBottom 
16988>>>            Send WriteHtmlTableEnd
16989>>>        End_Procedure // OnPageBottom
16990>>>
16990>>>        Function RunTimeReport Integer iIndex RowId riStartRowId Integer iMaxCount Returns RowId
16993>>>            RowId   riLastRowId
16993>>>            Integer eStatus
16993>>>
16993>>>            Set piOrdering to 3 //iIndex
16994>>>            Set piMaxCount To iMaxCount
16995>>>            Set piMaxCountBreakLevel To 0
16996>>>            Set priStartRowId To riStartRowId
16997>>>
16997>>>            Get DoRunReport To eStatus
16998>>>
16998>>>            Get priLastRowId To riLastRowId
16999>>>
16999>>>            Function_Return riLastRowId
17000>>>        End_Function // RunTimeReport
17001>>>    End_Object // oReport
17002>>>
17002>>>    Procedure SetHRefName String sName
#REM SEND REGISTERINTERFACE |CI5626 "msg_SetHRefName" "String sName" "Name to link for drill down report"
17006>>>        Set psHRefname of oReport To sName
17007>>>    End_Procedure // SetHRefName
17008>>>
17008>>>    Procedure SetCustomer_Name String sStart String sStop
#REM SEND REGISTERINTERFACE |CI5637 "msg_SetCustomer_Name" "String sStart String sStop" "Sets the reports selection criteria"
17012>>>        Set psStartName of oCustomer_DD to sStart
17013>>>        Set psStopName  of oCustomer_DD to sStop
17014>>>    End_Procedure // SetCustomer_Name
17015>>>
17015>>>    Procedure SetProject_ID String sStart String sStop
#REM SEND REGISTERINTERFACE |CI5682 "msg_SetProject_ID" "String sStart String sStop" "Sets the reports selection criteria"
17019>>>        Set psStartID of oProject_DD to (Uppercase (sStart))
17020>>>        Set psStopID  of oProject_DD to (Uppercase (sStop))
17021>>>    End_Procedure // SetProject_Name
17022>>>
17022>>>    Procedure SetUser_LoginID String sStart String sStop
#REM SEND REGISTERINTERFACE |CI5683 "msg_SetUser_LoginID" "String sStart String sStop" "Sets the reports selection criteria"
17026>>>        Set psStartLoginID of oUser_DD to sStart
17027>>>        Set psStopLoginID  of oUser_DD to sStop
17028>>>    End_Procedure // SetUser_Loginname
17029>>>
17029>>>    Procedure SetTimereg_Start_Date String sStart String sStop
#REM SEND REGISTERINTERFACE |CI5684 "msg_SetTimereg_Start_Date" "String sStart String sStop" "Sets the reports selection criteria"
17033>>>        Set pdStartstart_date of oTimereg_DD To sStart
17034>>>        Set pdStopstart_date  of oTimereg_DD To sStop
17035>>>    End_Procedure // SetTimereg_Start_Date
17036>>>
17036>>>    Procedure SetTimereg_Start_Time String sStart String sStop
#REM SEND REGISTERINTERFACE |CI5685 "msg_SetTimereg_Start_Time" "String sStart String sStop" "Sets the reports selection criteria"
17040>>>        Set psStartstart_time of oTimereg_DD To (Uppercase (sStart))
17041>>>        Set psStopstart_time  of oTimereg_DD To (Uppercase (sStop))
17042>>>    End_Procedure // SetTimereg_Start_Time
17043>>>
17043>>>    Procedure SetTimereg_End_Date String sStart String sStop
#REM SEND REGISTERINTERFACE |CI5686 "msg_SetTimereg_End_Date" "String sStart String sStop" "Sets the reports selection criteria"
17047>>>        Set pdStartend_date of oTimereg_DD To sStart
17048>>>        Set pdStopend_date  of oTimereg_DD To sStop
17049>>>    End_Procedure // SetTimereg_End_Date
17050>>>
17050>>>    Procedure SetTimereg_End_Time String sStart String sStop
#REM SEND REGISTERINTERFACE |CI5687 "msg_SetTimereg_End_Time" "String sStart String sStop" "Sets the reports selection criteria"
17054>>>        Set psStartend_time of oTimereg_DD To (Uppercase (sStart))
17055>>>        Set psStopend_time  of oTimereg_DD To (Uppercase (sStop))
17056>>>    End_Procedure // SetTimereg_End_Time
17057>>>
17057>>>    Function RunTimeReport Integer iIndex String sStartRowId Integer iMaxCount Returns String
#REM SEND REGISTERINTERFACE |CI5681 "get_RunTimeReport" "Integer iIndex String sStartRowId Integer iMaxCount Returns String" "Run Report"
17061>>>        RowId  riStartRowId riEndRowId
17061>>>        String sEndRowId
17061>>>
17061>>>        Move (DeserializeRowId(sStartRowId)) to riStartRowId
17062>>>        Get RunTimeReport of oReport iIndex riStartRowId iMaxCount To riEndRowId
17063>>>        Move (SerializeRowId(riEndRowId)) to sEndRowId
17064>>>
17064>>>        Function_Return sEndRowId
17065>>>    End_Function // RunTimeReport
17066>>>
17066>>>    Set pbAllowSaveNew To False
17067>>>    Set pbAllowSaveEdit To False
17068>>>    Set pbAllowDelete To False
17069>>>
17069>>>End_Object // oTimeReport
17070>    Use RegEditASP.wo
Including file: RegEditASP.wo    (C:\VDF programs\timer\AppSrc\RegEditASP.wo)
17070>>>// RegEditASP.wo
17070>>>// RegEditASP
17070>>>Use cWebBusinessProcess.pkg
17070>>>
17070>>>Use cCompanyDataDictionary.dd
17070>>>Use CUSTOMER.DD
17070>>>Use cProjectDataDictionary.dd
17070>>>Use User.DD
17070>>>Use cTimeregDataDictionary.dd
17070>>>
17070>>>Object oRegEditASP Is A cWebBusinessProcess
17072>>>    Set psDescription To "RegEditASP"
17073>>>    Set pbClearAfterSave To False
17074>>>
17074>>>
17074>>>    Object oCompany_DD Is A cCompanyDataDictionary
17076>>>        Send DefineAllExtendedFields
17077>>>    End_Object // oCompany_DD
17078>>>
17078>>>    Object oCustomer_DD Is A Customer_DataDictionary
17080>>>        Send DefineAllExtendedFields
17081>>>        Set DDO_Server to oCompany_DD
17082>>>        Procedure OnConstrain 
17085>>>            Constrain customer.CompanyId eq session.CompanyId
17087>>>        End_Procedure
17088>>>    End_Object // oCustomer_DD
17089>>>
17089>>>    Object oProject_DD Is A cProjectDataDictionary
17091>>>        Send DefineAllExtendedFields
17092>>>        Set DDO_Server To oCustomer_DD
17093>>>    End_Object // oProject_DD
17094>>>
17094>>>    Object oUser_DD Is A User_DataDictionary
17096>>>        Send DefineAllExtendedFields
17097>>>        Set DDO_Server To oCompany_DD
17098>>>        Procedure OnConstrain 
17101>>>            Constrain User.UserId eq session.UserId
17103>>>        End_Procedure
17104>>>    End_Object // oUser_DD
17105>>>
17105>>>    Object oTimereg_DD Is A cTimeregDataDictionary
17107>>>        Send DefineAllExtendedFields
17108>>>        Set DDO_Server To oUser_DD
17109>>>        Set DDO_Server To oProject_DD
17110>>>    End_Object // oTimereg_DD
17111>>>
17111>>>    Set Main_DD To oTimereg_DD
17112>>>
17112>>>
17112>>>    Send RegisterStandardInterface
17113>>>    // Send RegisterDebugInterface
17113>>>    // Send RegisterFullErrorInterface
17113>>>    // Send RegisterAutoEntryInterface
17113>>>
17113>>>    Set pbAllowSaveNew To True
17114>>>    Set pbAllowSaveEdit To True
17115>>>    Set pbAllowDelete To True
17116>>>    Set pbAllowClear To True
17117>>>    Set pbAllowFind To True
17118>>>    Set pbAllowDDUpdate To True
17119>>>
17119>>>End_Object // oRegEditASP
17120>    Use ProjectsDetailsInterface.wo
Including file: ProjectsDetailsInterface.wo    (C:\VDF programs\timer\AppSrc\ProjectsDetailsInterface.wo)
17120>>>// C:\VDF-Programs\timer\AppSrc\ProjectsDetailsInterface.wo
17120>>>// ProjectsDetailsInterface
17120>>>//
17120>>>
17120>>>Use cAjaxWebBusinessProcess.pkg
17120>>>
17120>>>Use cCompanyDataDictionary.dd
17120>>>Use CUSTOMER.DD
17120>>>Use cProjectDataDictionary.dd
17120>>>Use User.DD
17120>>>Use cUserprojDataDictionary.dd
17120>>>
17120>>>Object oProjectsDetailsInterface Is A cAjaxWebBusinessProcess
17122>>>    Set psDescription to "Project Report"
17123>>>    Set pbClearAfterSave to False
17124>>>
17124>>>
17124>>>    Object oCompany_DD Is A cCompanyDataDictionary
17126>>>    End_Object // oCompany_DD
17127>>>
17127>>>    Object oCustomer_DD Is A Customer_DataDictionary
17129>>>        Set DDO_Server To oCompany_DD
17130>>>        Procedure OnConstrain
17133>>>            Constrain customer.CompanyId eq session.CompanyId
17135>>>        End_Procedure
17136>>>    End_Object // oCustomer_DD
17137>>>
17137>>>    Object oProject_DD Is A cProjectDataDictionary
17139>>>        Set DDO_Server to oCustomer_DD
17140>>>        Set Field_Option Field Project.name DD_REQUIRED to False
17141>>>        Set Constrain_File to CUSTOMER.File_Number 
17142>>>    End_Object // oProject_DD
17143>>>
17143>>>    Object oUser_DD Is A User_DataDictionary
17145>>>        Set DDO_Server to oCompany_DD
17146>>>//        Set Field_Option Field User.LoginName DD_REQUIRED to False
17146>>>        
17146>>>        Procedure OnConstrain
17149>>>            Constrain User.CompanyId eq session.CompanyId
17151>>>        End_Procedure
17152>>>    End_Object // oUser_DD
17153>>>
17153>>>    Object oUserproj_DD is a cUserprojDataDictionary
17155>>>        Set DDO_Server to oUser_DD
17156>>>        Set DDO_Server to oProject_DD
17157>>>//        Set Constrain_File to Project.File_Number
17157>>>    End_Object // oUserproj_DD
17158>>>
17158>>>    Set Main_DD To oUserproj_DD
17159>>>
17159>>>
17159>>>    Send RegisterStandardInterface
17160>>>    //Send RegisterDebugInterface
17160>>>    //Send RegisterFullErrorInterface
17160>>>    //Send RegisterAutoEntryInterface
17160>>>
17160>>>End_Object // oProjectsDetailsInterface
17161>    Use temp1.wo
Including file: temp1.wo    (C:\VDF programs\timer\AppSrc\temp1.wo)
17161>>>Use cWebBusinessProcess.pkg
17161>>>Use cWebReport.pkg
17161>>>
17161>>>Use cCompanyDataDictionary.dd
17161>>>Use CUSTOMER.DD
17161>>>Use cProjectDataDictionary.dd
17161>>>Use User.DD
17161>>>Use cTimeregDataDictionary.dd
17161>>>
17161>>>Object otemp1 Is A cWebBusinessProcess
17163>>>    Set psDescription To "temp1"
17164>>>
17164>>>
17164>>>    Object oCompany_DD Is A cCompanyDataDictionary
17166>>>        Send DefineAllExtendedFields
17167>>>    End_Object // oCompany_DD
17168>>>
17168>>>    Object oCustomer_DD Is A Customer_DataDictionary
17170>>>        Send DefineAllExtendedFields
17171>>>        Set DDO_Server To oCompany_DD
17172>>>    End_Object // oCustomer_DD
17173>>>
17173>>>    Object oProject_DD Is A cProjectDataDictionary
17175>>>        Send DefineAllExtendedFields
17176>>>        Set DDO_Server To oCustomer_DD
17177>>>    End_Object // oProject_DD
17178>>>
17178>>>    Object oUser_DD Is A User_DataDictionary
17180>>>        Send DefineAllExtendedFields
17181>>>        Set DDO_Server To oCompany_DD
17182>>>    End_Object // oUser_DD
17183>>>
17183>>>    Object oTimereg_DD Is A cTimeregDataDictionary
17185>>>        Send DefineAllExtendedFields
17186>>>        Set DDO_Server To oUser_DD
17187>>>        Set DDO_Server To oProject_DD
17188>>>    End_Object // oTimereg_DD
17189>>>
17189>>>    Set Main_DD To oTimereg_DD
17190>>>
17190>>>    Object oReport Is A cWebReport
17192>>>
17192>>>        Set piOrdering To 3
17193>>>        Set piConstrainFile To Project.File_Number
17194>>>        Set priConstrainRowId To (NullRowId()) //  We will set this elsewhere
17195>>>
17195>>>        Function Break1 Returns String
17198>>>            RowId  riRec
17198>>>            String sRec
17198>>>            Move (GetRowId(Project.File_number)) To riRec
17199>>>            Move (SerializeRowId(riRec)) to sRec
17200>>>            Function_Return sRec //  Break every time the parent record changes
17201>>>        End_Function // Break1
17202>>>
17202>>>        Procedure OnInitBreakpoints 
17205>>>            Send RegisterBreakpoint Get_Break1
17206>>>        End_Procedure // OnInitBreakpoints
17207>>>
17207>>>        Procedure OnPageTop
17210>>>            
17210>>>            String sCustomerCustomerid
17210>>>            String sProjectName
17210>>>            String sUserLoginname
17210>>>
17210>>>            Get ddValueEncode "Customer.Customerid" to sCustomerCustomerid
17211>>>            Get ddValueEncode "Project.Name" to sProjectName
17212>>>            Get ddValueEncode "User.Loginname" to sUserLoginname
17213>>>
17213>>>            Send WriteHtmlTableBegin 'border="0" width="50%" class="ReportHdr1Table"'
17214>>>
17214>>>            Send WriteHtmlRowBegin
17215>>>                Send WriteHtmlCellHeader 'Customer Number' 'class="Label"'
17216>>>                Send WriteHtmlCell (FormatNumber (sCustomerCustomerid,0)) 'class="Data"'
17217>>>            Send WriteHtmlRowEnd
17218>>>            Send WriteHtmlRowBegin
17219>>>                Send WriteHtmlCellHeader 'Name' 'class="Label"'
17220>>>                Send WriteHtmlCell sProjectName 'class="Data"'
17221>>>            Send WriteHtmlRowEnd
17222>>>            Send WriteHtmlRowBegin
17223>>>                Send WriteHtmlCellHeader 'Loginname' 'class="Label"'
17224>>>                Send WriteHtmlCell sUserLoginname 'class="Data"'
17225>>>            Send WriteHtmlRowEnd
17226>>>            Send WriteHtmlTableEnd
17227>>>        End_Procedure
17228>>>
17228>>>
17228>>>        Procedure OnSubHeader1 
17231>>>            String sCustomerCustomerid
17231>>>            String sProjectName
17231>>>            String sUserLoginname
17231>>>
17231>>>            Get ddValueEncode "Customer.Customerid" To sCustomerCustomerid
17232>>>            Get ddValueEncode "Project.Name" To sProjectName
17233>>>            Get ddValueEncode "User.Loginname" To sUserLoginname
17234>>>
17234>>>            Send WriteHtmlTableBegin 'border="0" width="50%" class="ReportHdr1Table"'
17235>>>
17235>>>            Send WriteHtmlRowBegin
17236>>>                Send WriteHtmlCellHeader 'Customer Number' 'class="Label"'
17237>>>                Send WriteHtmlCell (FormatNumber (sCustomerCustomerid,0)) 'class="Data"'
17238>>>            Send WriteHtmlRowEnd
17239>>>            Send WriteHtmlRowBegin
17240>>>                Send WriteHtmlCellHeader 'Name' 'class="Label"'
17241>>>                Send WriteHtmlCell sProjectName 'class="Data"'
17242>>>            Send WriteHtmlRowEnd
17243>>>            Send WriteHtmlRowBegin
17244>>>                Send WriteHtmlCellHeader 'Loginname' 'class="Label"'
17245>>>                Send WriteHtmlCell sUserLoginname 'class="Data"'
17246>>>            Send WriteHtmlRowEnd
17247>>>
17247>>>            Send WriteHtmlTableEnd
17248>>>
17248>>>            Send WriteHtmlTableBegin 'border="0" width="99%" class="ReportTable"'
17249>>>
17249>>>            Send WriteHtmlRowBegin
17250>>>                Send WriteHtmlCellHeader 'Projectid' 'class="Header" align="right"'
17251>>>                Send WriteHtmlCellHeader 'Start Date' 'class="Header" align="left"'
17252>>>                Send WriteHtmlCellHeader 'Start Time' 'class="Header" align="left"'
17253>>>                Send WriteHtmlCellHeader 'End Date' 'class="Header" align="left"'
17254>>>                Send WriteHtmlCellHeader 'End Time' 'class="Header" align="left"'
17255>>>            Send WriteHtmlRowEnd
17256>>>        End_Procedure // OnSubHeader1
17257>>>
17257>>>        Procedure OnBody 
17260>>>            String sText
17260>>>            String sProjectProjectid
17260>>>            String sTimeregStart_Date
17260>>>            String sTimeregStart_Time
17260>>>            String sTimeregEnd_Date
17260>>>            String sTimeregEnd_Time
17260>>>
17260>>>            Get ddValueEncode "Project.Projectid" To sProjectProjectid
17261>>>            Get ddValueEncode "Timereg.Start_Date" To sTimeregStart_Date
17262>>>            Get ddValueEncode "Timereg.Start_Time" To sTimeregStart_Time
17263>>>            Get ddValueEncode "Timereg.End_Date" To sTimeregEnd_Date
17264>>>            Get ddValueEncode "Timereg.End_Time" To sTimeregEnd_Time
17265>>>
17265>>>            Send WriteHtmlRowBegin
17266>>>                Get AddRowIdLink (FormatNumber (sProjectProjectid,0)) To sText
17267>>>                Send WriteHtmlCell sText 'class="Data" align="right"'
17268>>>                Send WriteHtmlCell sTimeregStart_Date 'class="Data" align="left"'
17269>>>                Send WriteHtmlCell sTimeregStart_Time 'class="Data" align="left"'
17270>>>                Send WriteHtmlCell sTimeregEnd_Date 'class="Data" align="left"'
17271>>>                Send WriteHtmlCell sTimeregEnd_Time 'class="Data" align="left"'
17272>>>            Send WriteHtmlRowEnd
17273>>>
17273>>>            Send AddSubTotal 1 sProjectProjectid // Subtotal of field
17274>>>        End_Procedure // OnBody
17275>>>
17275>>>        Procedure OnSubTotal1 
17278>>>            Number nTotal
17278>>>
17278>>>            Get SubTotal 1 To nTotal
17279>>>            Send WriteHtmlCell (FormatNumber (nTotal, 0)) 'class="Header" align="right" '
17280>>>
17280>>>            Send WriteHtmlCell "" 'Colspan="4" class="Header"'
17281>>>
17281>>>            Send WriteHtmlTableEnd
17282>>>        End_Procedure // OnSubTotal1
17283>>>
17283>>>        Function Runtemp1 RowId riHeaderRowId Returns RowId
17286>>>            Integer eStatus
17286>>>
17286>>>            Set piMaxCount To 0
17287>>>            Set priStartRowId To (NullRowId())
17288>>>            Set priConstrainRowId To riHeaderRowId
17289>>>
17289>>>            Get DoRunReport To eStatus
17290>>>
17290>>>            Function_Return (NullRowId())
17291>>>        End_Function // Runtemp1
17292>>>
17292>>>        Function RunAlltemp1 RowId riStartRowId Integer iMaxCount Returns RowId
17295>>>            RowId   riLastRowId
17295>>>            Integer eStatus
17295>>>
17295>>>            Set piMaxCount To iMaxCount
17296>>>            Set piMaxCountBreakLevel To 1
17297>>>            Set priStartRowId To riStartRowId
17298>>>            Set priConstrainRowId To (NullRowId())
17299>>>
17299>>>            Get DoRunReport To eStatus
17300>>>
17300>>>            Get priLastRowId To riLastRowId
17301>>>
17301>>>            Function_Return riLastRowId
17302>>>        End_Function // RunAlltemp1
17303>>>
17303>>>    End_Object // oReport
17304>>>
17304>>>    Procedure SetHRefName String sName
#REM SEND REGISTERINTERFACE |CI5626 "msg_SetHRefName" "String sName" "Name to link for drill down report"
17308>>>        Set psHRefname of oReport To sName
17309>>>    End_Procedure // SetHRefName
17310>>>
17310>>>    Function Runtemp1 String sHeaderRowId Returns String
#REM SEND REGISTERINTERFACE |CI5688 "get_Runtemp1" "String sHeaderRowId Returns String" "Run report selected record"
17314>>>        RowId   riHeaderRowId riLastRowId
17314>>>        String  sLastRowId
17314>>>
17314>>>        Move (DeserializeRowId(sHeaderRowId)) to riHeaderRowId
17315>>>        Get Runtemp1 of oReport riHeaderRowId To riLastRowId
17316>>>        Move (SerializeRowId(riLastRowId)) to sLastRowId
17317>>>
17317>>>        Function_Return sLastRowId
17318>>>    End_Function // Runtemp1
17319>>>
17319>>>    Function RunAlltemp1 String sStartRowId Integer iMaxCount Returns String
#REM SEND REGISTERINTERFACE |CI5689 "get_RunAlltemp1" "String sStartRowId Integer iMaxCount Returns String" "Run report for all records"
17323>>>        RowId   riStartRowId riLastRowId
17323>>>        String  sLastRowId
17323>>>
17323>>>        Move (DeserializeRowId(sStartRowId)) to riStartRowId
17324>>>        Get RunAlltemp1 of oReport riStartRowId iMaxCount To riLastRowId
17325>>>        Move (SerializeRowId(riLastRowId)) to sLastRowId
17326>>>
17326>>>        Function_Return sLastRowId
17327>>>    End_Function // RunAlltemp1
17328>>>
17328>>>    Set pbAllowSaveNew To False
17329>>>    Set pbAllowSaveEdit To False
17330>>>    Set pbAllowDelete To False
17331>>>
17331>>>End_Object // otemp1
17332>    Use HoursEdit.wo
Including file: HoursEdit.wo    (C:\VDF programs\timer\AppSrc\HoursEdit.wo)
17332>>>// C:\VDF-Programs\timer\AppSrc\HoursEdit.wo
17332>>>// HoursEdit
17332>>>//
17332>>>
17332>>>Use cAjaxWebBusinessProcess.pkg
17332>>>
17332>>>Use cCompanyDataDictionary.dd
17332>>>Use CUSTOMER.DD
17332>>>Use cProjectDataDictionary.dd
17332>>>Use User.DD
17332>>>Use cTimeregDataDictionary.dd
17332>>>
17332>>>Object oHoursEdit Is A cAjaxWebBusinessProcess
17334>>>    Set psDescription to "HoursEdit"
17335>>>    Set pbClearAfterSave to False
17336>>>
17336>>>
17336>>>    Object oCompany_DD Is A cCompanyDataDictionary
17338>>>    End_Object // oCompany_DD
17339>>>
17339>>>    Object oCustomer_DD Is A Customer_DataDictionary
17341>>>        Set DDO_Server To oCompany_DD
17342>>>        Procedure OnConstrain
17345>>>            Constrain customer.CompanyId eq session.CompanyId
17347>>>        End_Procedure
17348>>>    End_Object // oCustomer_DD
17349>>>
17349>>>    Object oProject_DD Is A cProjectDataDictionary
17351>>>        Set DDO_Server To oCustomer_DD
17352>>>    End_Object // oProject_DD
17353>>>
17353>>>    Object oUser_DD Is A User_DataDictionary
17355>>>        Set DDO_Server To oCompany_DD
17356>>>    End_Object // oUser_DD
17357>>>
17357>>>    Object oTimereg_DD Is A cTimeregDataDictionary
17359>>>        Send DefineAllExtendedFields
17360>>>        Set DDO_Server To oUser_DD
17361>>>        Set DDO_Server To oProject_DD
17362>>>    End_Object // oTimereg_DD
17363>>>
17363>>>    Set Main_DD To oTimereg_DD
17364>>>
17364>>>
17364>>>    Send RegisterStandardInterface
17365>>>    //Send RegisterDebugInterface
17365>>>    //Send RegisterFullErrorInterface
17365>>>    //Send RegisterAutoEntryInterface
17365>>>
17365>>>End_Object // oHoursEdit
17366>
17366>    //    Procedure OnattachProcess
17366>    //       // perform any initialization for the newly attached process.
17366>    //       Showln "attach"
17366>    //    End_Procedure
17366>
17366>    //    Procedure OnDetachProcess
17366>    //       // perform any de-initialization for the process that is being detached.
17366>    //       Showln "detach"
17366>    //    End_Procedure
17366>
17366>End_Object
17367>
17367>Send StartWebApp of oWebApp
17368>
Summary
Memory Available: 1908068352
Total Warnings : 0
Total Errors   : 0
Total Symbols  : 12882
Total Resources: 0
Total Commands : 17367
Total Windows  : 1
Total Pages    : 1
Static Data    : 176351
Message area   : 103049
Total Blocks   : 7706
